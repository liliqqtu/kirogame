var z=Object.defineProperty;var _=(n,e,t)=>e in n?z(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var i=(n,e,t)=>(_(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=t(a);fetch(a.href,l)}})();var w=(n=>(n.BASIC="basic",n.DIAGONAL="diagonal",n.LASER="laser",n.ELITE="elite",n.BOSS="boss",n))(w||{}),u=(n=>(n.NORMAL="normal",n.LASER="laser",n))(u||{}),p=(n=>(n.MENU="menu",n.PLAYING="playing",n.PAUSED="paused",n.GAME_OVER="game_over",n))(p||{}),I=(n=>(n.MISSILE="missile",n))(I||{});const y={canvas:{width:800,height:600},player:{speed:200,size:{x:48,y:48},shootCooldown:200,startPosition:{x:376,y:540}},enemy:{baseSpeed:50,size:{x:48,y:48},spawnRate:2e3,shootInterval:3e3},bullet:{speed:300,size:{x:4,y:8}},difficulty:{speedIncreaseRate:1.1,maxSpeed:100,enemySpawnIncreaseRate:.9,timeInterval:3e4},game:{initialLives:3,targetFPS:60}},c={BACKGROUND:"#000011",PLAYER:"#00ff00",ENEMY:"#ff0000",PLAYER_BULLET:"#ffff00",ENEMY_BULLET:"#ff8800",UI_TEXT:"#ffffff",UI_ACCENT:"#00ffff"},S={W:"KeyW",A:"KeyA",S:"KeyS",D:"KeyD",J:"KeyJ",SPACE:"Space",ESCAPE:"Escape",ENTER:"Enter",K:"KeyK"},O={ENEMY_KILL:100,BONUS_MULTIPLIER:1.5},g={BASIC:{id:"basic",size:{x:48,y:48},shootInterval:3e3,bulletType:"normal",shootPattern:"straight",spawnWeight:50,health:1,scoreValue:100,speedMultiplier:1,minScore:0},DIAGONAL:{id:"diagonal",size:{x:56,y:56},shootInterval:2500,bulletType:"normal",shootPattern:"diagonal",spawnWeight:30,health:1,scoreValue:100,speedMultiplier:1,minScore:0},LASER:{id:"laser",size:{x:64,y:64},shootInterval:8e3,bulletType:"laser",shootPattern:"straight",spawnWeight:20,health:1,scoreValue:100,speedMultiplier:1,minScore:0},ELITE:{id:"elite",size:{x:108,y:108},shootInterval:2e3,bulletType:"mixed",shootPattern:"mixed",spawnWeight:15,health:3,scoreValue:300,speedMultiplier:.7,minScore:1e3},BOSS:{id:"boss",size:{x:192,y:192},shootInterval:1e3,bulletType:"all",shootPattern:"all",spawnWeight:5,health:15,scoreValue:1e3,speedMultiplier:.3,minScore:5e3}},v={NORMAL:{size:{x:12,y:24},speed:200,color:"#ff8800"},LASER:{size:{x:18,y:96},speed:250,color:"#ff8800"}},L={MISSILE:{id:"missile",size:{x:32,y:32},scoreRequirement:1e3,duration:4e4}},E={speed:350,size:{x:6,y:12},angle:Math.PI/4,cooldown:300};class D{constructor(e){i(this,"ctx");i(this,"canvas");const t=e.getContext("2d");if(!t)throw new Error("Êó†Ê≥ïËé∑ÂèñCanvas 2D‰∏ä‰∏ãÊñá");this.canvas=e,this.ctx=t,this.setPixelPerfect(!0)}clear(){this.ctx.fillStyle=c.BACKGROUND,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}drawRect(e,t,s,a,l){this.ctx.fillStyle=l,this.ctx.fillRect(Math.floor(e),Math.floor(t),Math.floor(s),Math.floor(a))}drawText(e,t,s,a,l="16px Courier New"){this.ctx.fillStyle=a,this.ctx.font=l,this.ctx.textAlign="left",this.ctx.textBaseline="top",this.ctx.fillText(e,Math.floor(t),Math.floor(s))}setPixelPerfect(e){this.ctx.imageSmoothingEnabled=!e,e&&(this.canvas.style.imageRendering="pixelated",this.canvas.style.imageRendering="-moz-crisp-edges",this.canvas.style.imageRendering="crisp-edges")}drawRectOutline(e,t,s,a,l,o=1){this.ctx.strokeStyle=l,this.ctx.lineWidth=o,this.ctx.strokeRect(Math.floor(e),Math.floor(t),Math.floor(s),Math.floor(a))}drawCircle(e,t,s,a){this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.arc(Math.floor(e),Math.floor(t),s,0,2*Math.PI),this.ctx.fill()}drawLine(e,t,s,a,l,o=1){this.ctx.strokeStyle=l,this.ctx.lineWidth=o,this.ctx.beginPath(),this.ctx.moveTo(Math.floor(e),Math.floor(t)),this.ctx.lineTo(Math.floor(s),Math.floor(a)),this.ctx.stroke()}save(){this.ctx.save()}restore(){this.ctx.restore()}setAlpha(e){this.ctx.globalAlpha=Math.max(0,Math.min(1,e))}getSize(){return{width:this.canvas.width,height:this.canvas.height}}getCanvas(){return this.canvas}getContext(){return this.ctx}drawImage(e,t,s,a,l){const o=Math.floor(t),h=Math.floor(s);a!==void 0&&l!==void 0?this.ctx.drawImage(e,o,h,Math.floor(a),Math.floor(l)):this.ctx.drawImage(e,o,h)}drawImagePart(e,t,s,a,l,o,h,m,M){const x=Math.floor(o),N=Math.floor(h),F=m?Math.floor(m):a,U=M?Math.floor(M):l;this.ctx.drawImage(e,t,s,a,l,x,N,F,U)}drawRotatedImage(e,t,s,a,l,o){const h=t+a/2,m=s+l/2;this.ctx.save(),this.ctx.translate(Math.floor(h),Math.floor(m)),this.ctx.rotate(o),this.ctx.drawImage(e,Math.floor(-a/2),Math.floor(-l/2),Math.floor(a),Math.floor(l)),this.ctx.restore()}drawBackground(e,t="stretch"){if(t==="stretch")this.ctx.drawImage(e,0,0,this.canvas.width,this.canvas.height);else if(t==="tile"){const s=this.ctx.createPattern(e,"repeat");s&&(this.ctx.fillStyle=s,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))}}}class Y{constructor(){i(this,"inputState");i(this,"keyDownHandlers");i(this,"keyUpHandlers");i(this,"isListening",!1);this.inputState={up:!1,down:!1,left:!1,right:!1,shoot:!1},this.keyDownHandlers=new Map,this.keyUpHandlers=new Map,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this)}startListening(){this.isListening||(document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),this.isListening=!0)}stopListening(){this.isListening&&(document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.isListening=!1)}handleKeyDown(e){switch(this.isGameKey(e.code)&&e.preventDefault(),e.code){case S.W:this.inputState.up=!0;break;case S.S:this.inputState.down=!0;break;case S.A:this.inputState.left=!0;break;case S.D:this.inputState.right=!0;break;case S.J:this.inputState.shoot=!0;break}const t=this.keyDownHandlers.get(e.code);t&&t()}handleKeyUp(e){switch(this.isGameKey(e.code)&&e.preventDefault(),e.code){case S.W:this.inputState.up=!1;break;case S.S:this.inputState.down=!1;break;case S.A:this.inputState.left=!1;break;case S.D:this.inputState.right=!1;break;case S.J:this.inputState.shoot=!1;break}const t=this.keyUpHandlers.get(e.code);t&&t()}isGameKey(e){return Object.values(S).includes(e)}getInputState(){return{...this.inputState}}isDirectionPressed(e){return this.inputState[e]}isShootPressed(){return this.inputState.shoot}hasMovementInput(){return this.inputState.up||this.inputState.down||this.inputState.left||this.inputState.right}getMovementVector(){let e=0,t=0;return this.inputState.left&&(e-=1),this.inputState.right&&(e+=1),this.inputState.up&&(t-=1),this.inputState.down&&(t+=1),{x:e,y:t}}onKeyDown(e,t){this.keyDownHandlers.set(e,t)}onKeyUp(e,t){this.keyUpHandlers.set(e,t)}removeKeyHandler(e){this.keyDownHandlers.delete(e),this.keyUpHandlers.delete(e)}clearAllHandlers(){this.keyDownHandlers.clear(),this.keyUpHandlers.clear()}reset(){this.inputState={up:!1,down:!1,left:!1,right:!1,shoot:!1}}simulateKeyDown(e){const t=new KeyboardEvent("keydown",{code:e});this.handleKeyDown(t)}simulateKeyUp(e){const t=new KeyboardEvent("keyup",{code:e});this.handleKeyUp(t)}destroy(){this.stopListening(),this.clearAllHandlers(),this.reset()}}function k(n,e,t,s){return n.x<t.x+s.x&&n.x+e.x>t.x&&n.y<t.y+s.y&&n.y+e.y>t.y}function C(n,e){return{hasCollision:k(n.position,n.size,e.position,e.size),entity1:n,entity2:e}}function b(n,e,t){n.position.x=Math.max(0,Math.min(n.position.x,e-n.size.x)),n.position.y=Math.max(0,Math.min(n.position.y,t-n.size.y))}class H{checkPlayerEnemyCollisions(e,t){const s=[];if(!e.active)return s;for(const a of t){if(!a.active)continue;C(e,a).hasCollision&&s.push(a)}return s}checkPlayerBulletEnemyCollisions(e,t){const s=[],a=e.filter(l=>l.active&&l.owner==="player");for(const l of a)for(const o of t){if(!o.active)continue;C(l,o).hasCollision&&s.push({bullet:l,enemy:o})}return s}checkEnemyBulletPlayerCollisions(e,t){const s=[];if(!t.active)return s;const a=e.filter(l=>l.active&&l.owner==="enemy");for(const l of a)C(l,t).hasCollision&&s.push(l);return s}checkAllCollisions(e,t,s){return{playerEnemyCollisions:this.checkPlayerEnemyCollisions(e,t),bulletEnemyCollisions:this.checkPlayerBulletEnemyCollisions(s,t),bulletPlayerCollisions:this.checkEnemyBulletPlayerCollisions(s,e)}}}class K{constructor(){i(this,"lives");i(this,"maxLives");i(this,"gameOver");this.maxLives=y.game.initialLives,this.lives=this.maxLives,this.gameOver=!1}getLives(){return this.lives}getMaxLives(){return this.maxLives}loseLife(){return this.gameOver?!1:(this.lives=Math.max(0,this.lives-1),this.lives<=0&&(this.gameOver=!0),!0)}addLife(){this.gameOver||(this.lives=Math.min(this.maxLives,this.lives+1))}isGameOver(){return this.gameOver}reset(){this.lives=this.maxLives,this.gameOver=!1}hasLives(){return this.lives>0}}class G{constructor(){i(this,"score");i(this,"highScore");this.score=0,this.highScore=this.loadHighScore()}getScore(){return this.score}getHighScore(){return this.highScore}addScore(e){this.score+=Math.max(0,e),this.score>this.highScore&&(this.highScore=this.score,this.saveHighScore())}enemyDestroyed(){this.addScore(O.ENEMY_KILL)}reset(){this.score=0}loadHighScore(){try{const e=localStorage.getItem("pixelShooterHighScore");return e?parseInt(e,10):0}catch{return 0}}saveHighScore(){try{localStorage.setItem("pixelShooterHighScore",this.highScore.toString())}catch{}}}class W{constructor(){i(this,"gameTime");i(this,"currentLevel");i(this,"baseSpawnRate");i(this,"baseEnemySpeed");i(this,"baseBulletSpeed");i(this,"basePlayerSpeed");i(this,"currentSpawnRate");i(this,"currentEnemySpeed");i(this,"currentBulletSpeed");i(this,"currentPlayerSpeed");i(this,"config",y.difficulty);this.gameTime=0,this.currentLevel=1,this.baseSpawnRate=y.enemy.spawnRate,this.baseEnemySpeed=y.enemy.baseSpeed,this.baseBulletSpeed=y.bullet.speed,this.basePlayerSpeed=y.player.speed,this.currentSpawnRate=this.baseSpawnRate,this.currentEnemySpeed=this.baseEnemySpeed,this.currentBulletSpeed=this.baseBulletSpeed,this.currentPlayerSpeed=this.basePlayerSpeed}update(e){this.gameTime+=e;const t=Math.floor(this.gameTime/this.config.timeInterval)+1;t>this.currentLevel&&(this.currentLevel=t,this.updateDifficulty())}updateDifficulty(){const e=this.currentLevel-1;this.currentSpawnRate=Math.max(200,this.baseSpawnRate*Math.pow(this.config.enemySpawnIncreaseRate,e));const t=Math.pow(this.config.speedIncreaseRate,e);this.currentEnemySpeed=Math.min(this.config.maxSpeed,this.baseEnemySpeed*t),this.currentBulletSpeed=Math.min(this.config.maxSpeed,this.baseBulletSpeed*t),this.currentPlayerSpeed=Math.min(this.config.maxSpeed,this.basePlayerSpeed*t)}getCurrentSpawnRate(){return this.currentSpawnRate}getCurrentEnemySpeed(){return this.currentEnemySpeed}getCurrentBulletSpeed(){return this.currentBulletSpeed}getCurrentPlayerSpeed(){return this.currentPlayerSpeed}getCurrentLevel(){return this.currentLevel}getGameTime(){return this.gameTime}isMaxSpeedReached(){return this.currentEnemySpeed>=this.config.maxSpeed||this.currentBulletSpeed>=this.config.maxSpeed||this.currentPlayerSpeed>=this.config.maxSpeed}reset(){this.gameTime=0,this.currentLevel=1,this.currentSpawnRate=this.baseSpawnRate,this.currentEnemySpeed=this.baseEnemySpeed,this.currentBulletSpeed=this.baseBulletSpeed,this.currentPlayerSpeed=this.basePlayerSpeed}getDifficultyInfo(){return{level:this.currentLevel,gameTime:this.gameTime,spawnRate:this.currentSpawnRate,enemySpeed:this.currentEnemySpeed,bulletSpeed:this.currentBulletSpeed,playerSpeed:this.currentPlayerSpeed,maxSpeedReached:this.isMaxSpeedReached()}}}function d(n=0,e=0){return{x:n,y:e}}function T(n,e,t){return Math.min(Math.max(n,e),t)}const r={BLACK:"#000000",WHITE:"#ffffff",PLAYER_PRIMARY:"#00ff41",PLAYER_SECONDARY:"#00cc33",PLAYER_DARK:"#008822",ENEMY_PRIMARY:"#ff0041",ENEMY_SECONDARY:"#cc0033",ENEMY_DARK:"#880022",BULLET_PLAYER:"#ffff41",BULLET_ENEMY:"#ff8841",UI_PRIMARY:"#41ffff",UI_SECONDARY:"#33cccc",UI_TEXT:"#ffffff",UI_BACKGROUND:"#000011",SPACE_DARK:"#000011",SPACE_MEDIUM:"#001122",SPACE_LIGHT:"#002244",EXPLOSION_1:"#ffff41",EXPLOSION_2:"#ff8841",EXPLOSION_3:"#ff4141"};class X{constructor(){i(this,"images",new Map);i(this,"loadPromises",new Map)}async loadImage(e,t){if(this.images.has(e))return this.images.get(e);if(this.loadPromises.has(e))return this.loadPromises.get(e);const s=new Promise((a,l)=>{const o=new Image;o.onload=()=>{this.images.set(e,o),this.loadPromises.delete(e),a(o)},o.onerror=()=>{this.loadPromises.delete(e),l(new Error(`Failed to load image: ${t}`))},o.src=t});return this.loadPromises.set(e,s),s}getImage(e){return this.images.get(e)||null}hasImage(e){return this.images.has(e)}async loadImages(e){const t=Object.entries(e).map(([s,a])=>this.loadImage(s,a));await Promise.all(t)}createPixelArtImage(e,t,s,a){const l=document.createElement("canvas");l.width=t,l.height=s;const o=l.getContext("2d");o.imageSmoothingEnabled=!1,a(o);const h=new Image;return h.src=l.toDataURL(),this.images.set(e,h),h}clear(){this.images.clear(),this.loadPromises.clear()}}const f=new X;class V{static createAll(){this.createPlayerShip(),this.createEnemyShips(),this.createPlayerBullet(),this.createEnemyBullets(),this.createPowerUps(),this.createBackground(),this.createStars()}static createPlayerShip(){f.createPixelArtImage("player",64,64,e=>{e.fillStyle="#E8E8E8",e.fillRect(28,8,8,32),e.fillRect(26,12,12,24),e.fillRect(24,16,16,16),e.fillStyle="#F8F8F8",e.fillRect(30,4,4,8),e.fillRect(28,6,8,6),e.fillRect(26,8,12,4),e.fillStyle="#A0A0A0",e.fillRect(29,10,6,2),e.fillRect(27,14,10,2),e.fillRect(25,18,14,2),e.fillStyle="#FF3333",e.fillRect(20,20,6,16),e.fillRect(38,20,6,16),e.fillRect(29,16,6,2),e.fillRect(28,22,8,2),e.fillStyle="#3366FF",e.fillRect(22,32,4,8),e.fillRect(38,32,4,8),e.fillRect(28,34,8,6),e.fillStyle="#1144CC",e.fillRect(23,34,2,4),e.fillRect(39,34,2,4),e.fillRect(30,36,4,2),e.fillStyle="#FF8800",e.fillRect(23,40,2,6),e.fillRect(39,40,2,6),e.fillRect(29,40,6,8),e.fillStyle="#FFDD00",e.fillRect(24,42,1,3),e.fillRect(39,42,1,3),e.fillRect(30,42,4,4),e.fillStyle="#FFFFFF",e.fillRect(31,44,2,2),e.fillStyle="#222222",e.fillRect(30,12,4,6),e.fillStyle="#444444",e.fillRect(31,14,2,2),e.fillStyle="#BBBBBB",e.fillRect(18,24,4,8),e.fillRect(42,24,4,8),e.fillStyle="#888888",e.fillRect(19,26,2,4),e.fillRect(43,26,2,4),e.fillStyle="#000000",e.fillRect(29,3,6,1),e.fillRect(27,4,2,1),e.fillRect(35,4,2,1),e.fillStyle="#AAFFFF",e.fillRect(26,20,1,1),e.fillRect(37,20,1,1),e.fillRect(32,18,1,1)})}static createEnemyShips(){f.createPixelArtImage("enemy-basic",24,24,e=>{e.fillStyle=r.ENEMY_PRIMARY,e.fillRect(10,4,4,16),e.fillRect(8,16,8,6),e.fillStyle=r.ENEMY_SECONDARY,e.fillRect(10,20,4,4),e.fillStyle=r.ENEMY_DARK,e.fillRect(4,8,6,8),e.fillRect(14,8,6,8),e.fillStyle=r.ENEMY_SECONDARY,e.fillRect(6,12,2,4),e.fillRect(16,12,2,4),e.fillStyle=r.ENEMY_SECONDARY,e.fillRect(11,10,2,2)}),f.createPixelArtImage("enemy-diagonal",28,28,e=>{e.fillStyle="#FF6600",e.fillRect(12,4,4,18),e.fillRect(10,8,8,12),e.fillStyle="#FF8800",e.fillRect(8,18,12,6),e.fillRect(11,22,6,4),e.fillStyle="#CC4400",e.fillRect(4,10,6,6),e.fillRect(18,10,6,6),e.fillStyle="#AA3300",e.fillRect(2,12,4,2),e.fillRect(22,12,4,2),e.fillStyle="#FFAA00",e.fillRect(13,12,2,2)}),f.createPixelArtImage("enemy-laser",32,32,e=>{e.fillStyle="#8800FF",e.fillRect(14,4,4,20),e.fillRect(12,8,8,16),e.fillStyle="#AA44FF",e.fillRect(10,20,12,8),e.fillRect(13,26,6,4),e.fillStyle="#6600CC",e.fillRect(8,12,16,8),e.fillStyle="#4400AA",e.fillRect(10,14,12,4),e.fillStyle="#CCAAFF",e.fillRect(14,15,4,2),e.fillStyle="#5500BB",e.fillRect(6,16,4,4),e.fillRect(22,16,4,4)}),f.createPixelArtImage("enemy-elite",36,36,e=>{e.fillStyle="#FFD700",e.fillRect(16,4,4,24),e.fillRect(14,8,8,20),e.fillStyle="#FFA500",e.fillRect(12,24,12,8),e.fillRect(15,30,6,4),e.fillStyle="#B8860B",e.fillRect(8,12,8,8),e.fillRect(20,12,8,8),e.fillStyle="#FFFF00",e.fillRect(17,14,2,2),e.fillRect(15,16,6,2),e.fillStyle="#DAA520",e.fillRect(6,16,4,6),e.fillRect(26,16,4,6),e.fillStyle="#FFFFFF",e.fillRect(17,18,2,2)}),f.createPixelArtImage("enemy-boss",48,48,e=>{e.fillStyle="#8B0000",e.fillRect(20,4,8,32),e.fillRect(16,8,16,28),e.fillStyle="#DC143C",e.fillRect(14,32,20,12),e.fillRect(18,42,12,4),e.fillStyle="#4B0000",e.fillRect(8,16,8,12),e.fillRect(32,16,8,12),e.fillRect(12,20,24,8),e.fillStyle="#FF4500",e.fillRect(4,20,6,8),e.fillRect(38,20,6,8),e.fillStyle="#FF0000",e.fillRect(22,22,4,4),e.fillStyle="#00FFFF",e.fillRect(21,18,2,2),e.fillRect(25,18,2,2),e.fillRect(21,26,2,2),e.fillRect(25,26,2,2),e.fillStyle="#FFFF00",e.fillRect(23,24,2,1)})}static createPlayerBullet(){f.createPixelArtImage("playerBullet",4,8,e=>{e.fillStyle=r.BULLET_PLAYER,e.fillRect(1,0,2,6),e.fillStyle=r.PLAYER_SECONDARY,e.fillRect(0,0,4,2),e.fillStyle=r.PLAYER_SECONDARY,e.fillRect(1,6,2,2)})}static createEnemyBullets(){f.createPixelArtImage("enemyBullet",4,8,e=>{e.fillStyle=r.BULLET_ENEMY,e.fillRect(1,2,2,6),e.fillStyle=r.ENEMY_SECONDARY,e.fillRect(0,6,4,2),e.fillStyle=r.ENEMY_SECONDARY,e.fillRect(1,0,2,2)}),f.createPixelArtImage("enemyLaser",6,32,e=>{e.fillStyle=r.BULLET_ENEMY,e.fillRect(1,0,4,32),e.fillStyle="#FFAA44",e.fillRect(2,0,2,32),e.fillStyle="#FF6600",e.fillRect(0,0,1,32),e.fillRect(5,0,1,32)})}static createPowerUps(){f.createPixelArtImage("powerup-missile",32,32,e=>{e.fillStyle="#00AA00",e.fillRect(0,0,32,32),e.fillStyle="#00FF00",e.fillRect(0,0,32,2),e.fillRect(0,30,32,2),e.fillRect(0,0,2,32),e.fillRect(30,0,2,32),e.fillStyle="#FFFF00",e.fillRect(8,6,16,4),e.fillRect(12,10,8,16),e.fillStyle="#FF4444",e.fillRect(14,4,4,4),e.fillStyle="#CCCCCC",e.fillRect(10,24,4,4),e.fillRect(18,24,4,4)})}static createBackground(){f.createPixelArtImage("background",800,600,e=>{const t=e.createLinearGradient(0,0,0,600);t.addColorStop(0,r.SPACE_DARK),t.addColorStop(.5,r.SPACE_MEDIUM),t.addColorStop(1,r.SPACE_LIGHT),e.fillStyle=t,e.fillRect(0,0,800,600),e.fillStyle=r.WHITE;for(let s=0;s<100;s++){const a=Math.random()*800,l=Math.random()*600,o=Math.random()<.7?1:2;e.fillRect(a,l,o,o)}e.fillStyle=r.UI_PRIMARY;for(let s=0;s<20;s++){const a=Math.random()*800,l=Math.random()*600;e.fillRect(a,l,1,1)}})}static createStars(){f.createPixelArtImage("star",2,2,e=>{e.fillStyle=r.WHITE,e.fillRect(0,0,2,2)}),f.createPixelArtImage("brightStar",3,3,e=>{e.fillStyle=r.UI_PRIMARY,e.fillRect(1,0,1,3),e.fillRect(0,1,3,1)})}}const $={player:"/assets/player.png","enemy-basic":"/assets/enemy-basic.png","enemy-diagonal":"/assets/enemy-diagonal.png","enemy-laser":"/assets/enemy-laser.png","enemy-elite":"/assets/enemy-elite.png","enemy-boss":"/assets/enemy-boss.png",playerBullet:"/assets/player-bullet.png",enemyBullet:"/assets/enemy-bullet.png",enemyLaser:"/assets/enemy-laser-bullet.png","powerup-missile":"/assets/powerup-missile.png",background:"/assets/background.png",star:"/assets/star.png",brightStar:"/assets/bright-star.png"};async function j(){console.log("Ê≠£Âú®Âä†ËΩΩÊ∏∏ÊàèËµÑÊ∫ê..."),V.createAll();const n=Object.entries($).map(async([e,t])=>{try{await f.loadImage(`custom_${e}`,t),console.log(`‚úì Âä†ËΩΩËá™ÂÆö‰πâÂõæÁâá: ${e} ‰ªé ${t}`)}catch(s){console.log(`‚ùå Âä†ËΩΩÂ§±Ë¥•: ${e} ‰ªé ${t}, ÈîôËØØ:`,s),console.log(`‰ΩøÁî®ÈªòËÆ§ÂÉèÁ¥†Ëâ∫ÊúØ: ${e}`)}});await Promise.allSettled(n),console.log("Ê∏∏ÊàèËµÑÊ∫êÂä†ËΩΩÂÆåÊàê!")}function R(n){const e=f.getImage(`custom_${n}`),t=f.getImage(n);return!e&&!t&&console.log(`ËµÑÊ∫êÊú™ÊâæÂà∞: ${n}, Â∞ùËØï‰∫Ü custom_${n} Âíå ${n}`),e||t}class q{constructor(e,t){i(this,"position");i(this,"velocity");i(this,"size");i(this,"active");i(this,"speed");i(this,"shootCooldown");i(this,"lastShotTime");i(this,"canvasWidth");i(this,"canvasHeight");i(this,"startPosition");i(this,"hasMissiles",!1);i(this,"missileEndTime",0);i(this,"lastMissileTime",0);this.canvasWidth=e,this.canvasHeight=t;const s=y.player;this.size={...s.size},this.speed=s.speed,this.shootCooldown=s.shootCooldown,this.startPosition={x:(e-this.size.x)/2,y:t-this.size.y-20},this.position={...this.startPosition},this.velocity=d(0,0),this.active=!0,this.lastShotTime=0}update(e){this.active&&(this.position.x+=this.velocity.x*(e/1e3),this.position.y+=this.velocity.y*(e/1e3),b(this,this.canvasWidth,this.canvasHeight),this.lastShotTime+=e,this.updateMissiles())}render(e){if(!this.active)return;const t=R("player");if(t)e.drawImage(t,this.position.x,this.position.y,this.size.x,this.size.y);else{e.drawRect(this.position.x,this.position.y,this.size.x,this.size.y,r.PLAYER_PRIMARY);const s=this.position.x+this.size.x/2,a=this.position.y;e.drawRect(s-2,a-4,4,4,r.PLAYER_SECONDARY),e.drawRect(this.position.x-2,this.position.y+this.size.y-8,4,8,r.PLAYER_DARK),e.drawRect(this.position.x+this.size.x-2,this.position.y+this.size.y-8,4,8,r.PLAYER_DARK)}}setVelocity(e,t){this.velocity.x=T(e,-this.speed,this.speed),this.velocity.y=T(t,-this.speed,this.speed)}updateMovement(e,t){const s=this.speed;this.velocity.x=e.x*s,this.velocity.y=e.y*s}canShoot(){return this.active&&this.lastShotTime>=this.shootCooldown}shoot(){return this.canShoot()?(this.lastShotTime=0,{position:{x:this.position.x+this.size.x/2-2,y:this.position.y-8},velocity:d(0,-y.bullet.speed),size:{...y.bullet.size},owner:"player",damage:1,bulletType:u.NORMAL,active:!0,update:()=>{},render:()=>{}}):null}takeDamage(){}respawn(){this.position={...this.startPosition},this.velocity=d(0,0),this.active=!0,this.lastShotTime=0}getCenterPosition(){return{x:this.position.x+this.size.x/2,y:this.position.y+this.size.y/2}}setPosition(e,t){this.position.x=e,this.position.y=t,b(this,this.canvasWidth,this.canvasHeight)}isInBounds(){return this.position.x>=0&&this.position.y>=0&&this.position.x+this.size.x<=this.canvasWidth&&this.position.y+this.size.y<=this.canvasHeight}destroy(){this.active=!1}gainMissiles(){this.hasMissiles=!0,this.missileEndTime=Date.now()+L.MISSILE.duration}canShootMissile(){const e=Date.now();return this.active&&this.hasMissiles&&e<this.missileEndTime&&e-this.lastMissileTime>=E.cooldown}shootMissile(){if(!this.canShootMissile())return null;this.lastMissileTime=Date.now();const e=[],t=this.position.x+this.size.x/2,s=this.position.y,a=Math.PI/4,l=E.speed*Math.cos(a),o=l,h=l,m={position:{x:t-E.size.x/2-10,y:s-8},velocity:d(-o,-h),size:{...E.size},owner:"player",damage:1,bulletType:u.NORMAL,active:!0,update:()=>{},render:()=>{}},M={position:{x:t-E.size.x/2+10,y:s-8},velocity:d(o,-h),size:{...E.size},owner:"player",damage:1,bulletType:u.NORMAL,active:!0,update:()=>{},render:()=>{}};return e.push(m,M),e}updateMissiles(){const e=Date.now();this.hasMissiles&&e>=this.missileEndTime&&(this.hasMissiles=!1)}hasMissileAbility(){return this.hasMissiles&&Date.now()<this.missileEndTime}getMissileTimeLeft(){if(!this.hasMissiles)return 0;const e=Math.max(0,this.missileEndTime-Date.now());return Math.ceil(e/1e3)}}class A{constructor(e,t,s,a,l,o=1,h=u.NORMAL){i(this,"position");i(this,"velocity");i(this,"size");i(this,"active");i(this,"owner");i(this,"damage");i(this,"bulletType");i(this,"canvasWidth");i(this,"canvasHeight");this.position={...e},this.velocity={...t},this.owner=s,this.damage=o,this.bulletType=h,this.active=!0,this.canvasWidth=a,this.canvasHeight=l,h===u.LASER?this.size={...v.LASER.size}:this.size={...v.NORMAL.size}}update(e){this.active&&(this.position.x+=this.velocity.x*(e/1e3),this.position.y+=this.velocity.y*(e/1e3),this.checkBounds())}render(e){if(!this.active)return;let t;this.owner==="player"?t="playerBullet":t=this.bulletType===u.LASER?"enemyLaser":"enemyBullet";const s=R(t);if(s)e.drawImage(s,this.position.x,this.position.y,this.size.x,this.size.y);else if(this.bulletType===u.LASER)e.drawRect(this.position.x,this.position.y,this.size.x,this.size.y,r.BULLET_ENEMY),e.drawRect(this.position.x+1,this.position.y,this.size.x-2,this.size.y,"#FFAA44");else{const a=this.owner==="player"?r.BULLET_PLAYER:r.BULLET_ENEMY;e.drawRect(this.position.x,this.position.y,this.size.x,this.size.y,a),this.owner==="player"?e.drawRect(this.position.x+1,this.position.y+this.size.y,this.size.x-2,2,r.PLAYER_SECONDARY):e.drawRect(this.position.x+1,this.position.y-2,this.size.x-2,2,r.ENEMY_SECONDARY)}}checkBounds(){(this.position.x+this.size.x<0||this.position.x>this.canvasWidth||this.position.y+this.size.y<0||this.position.y>this.canvasHeight)&&this.destroy()}getCenterPosition(){return{x:this.position.x+this.size.x/2,y:this.position.y+this.size.y/2}}isInBounds(){return this.position.x+this.size.x>=0&&this.position.x<=this.canvasWidth&&this.position.y+this.size.y>=0&&this.position.y<=this.canvasHeight}destroy(){this.active=!1}setVelocity(e,t){this.velocity.x=e,this.velocity.y=t}getBounds(){return{x:this.position.x,y:this.position.y,width:this.size.x,height:this.size.y}}}class J{constructor(e,t){i(this,"canvasWidth");i(this,"canvasHeight");this.canvasWidth=e,this.canvasHeight=t}createPlayerBullet(e){const t=d(0,-y.bullet.speed);return new A(e,t,"player",this.canvasWidth,this.canvasHeight,1)}createPlayerMissile(e,t){return new A(e,t,"player",this.canvasWidth,this.canvasHeight,1)}createEnemyBullet(e,t,s=u.NORMAL){return new A(e,t,"enemy",this.canvasWidth,this.canvasHeight,1,s)}createCustomBullet(e,t,s,a=1){return new A(e,t,s,this.canvasWidth,this.canvasHeight,a)}}class Q{constructor(e,t,s=100){i(this,"bullets",[]);i(this,"factory");i(this,"maxBullets");this.factory=new J(e,t),this.maxBullets=s}addBullet(e){this.bullets.length>=this.maxBullets&&this.bullets.shift(),this.bullets.push(e)}createPlayerBullet(e){const t=this.factory.createPlayerBullet(e);return this.addBullet(t),t}createPlayerMissile(e,t){const s=this.factory.createPlayerMissile(e,t);return this.addBullet(s),s}createEnemyBullet(e,t,s=u.NORMAL){const a=this.factory.createEnemyBullet(e,t,s);return this.addBullet(a),a}update(e){for(const t of this.bullets)t.update(e);this.bullets=this.bullets.filter(t=>t.active)}render(e){for(const t of this.bullets)t.render(e)}getActiveBullets(){return this.bullets.filter(e=>e.active)}getPlayerBullets(){return this.bullets.filter(e=>e.active&&e.owner==="player")}getEnemyBullets(){return this.bullets.filter(e=>e.active&&e.owner==="enemy")}clear(){this.bullets=[]}getCount(){return this.bullets.length}getActiveCount(){return this.bullets.filter(e=>e.active).length}}class B{constructor(e,t,s,a=w.BASIC,l){i(this,"position");i(this,"velocity");i(this,"size");i(this,"active");i(this,"speed");i(this,"shootTimer");i(this,"shootInterval");i(this,"enemyType");i(this,"health");i(this,"maxHealth");i(this,"canvasWidth");i(this,"canvasHeight");i(this,"movementTimer",0);this.position={...e},this.canvasWidth=t,this.canvasHeight=s,this.enemyType=a;const o=Object.values(g).find(h=>h.id===a)||g.BASIC;if(this.size={...o.size},this.speed=(l||y.enemy.baseSpeed)*o.speedMultiplier,this.shootInterval=o.shootInterval,this.health=o.health,this.maxHealth=o.health,a===w.BOSS){const h=(Math.random()-.5)*this.speed*.5;this.velocity=d(h,this.speed)}else this.velocity=d(0,this.speed);this.active=!0,this.shootTimer=Math.random()*this.shootInterval}update(e){this.active&&(this.enemyType===w.BOSS&&this.updateBossMovement(e),this.position.x+=this.velocity.x*(e/1e3),this.position.y+=this.velocity.y*(e/1e3),this.shootTimer+=e,this.checkBounds())}updateBossMovement(e){if(this.movementTimer+=e,this.movementTimer>=3e3){this.movementTimer=0;const t=Math.random();t<.4?this.velocity.x=0:t<.7?this.velocity.x=-this.speed*.3:this.velocity.x=this.speed*.3}this.position.x<=0&&this.velocity.x<0?this.velocity.x=Math.abs(this.velocity.x):this.position.x+this.size.x>=this.canvasWidth&&this.velocity.x>0&&(this.velocity.x=-Math.abs(this.velocity.x))}render(e){if(!this.active)return;const t=`enemy-${this.enemyType}`,s=R(t);if(s||console.log(`Êïå‰∫∫ÂõæÁâáÊú™ÊâæÂà∞: ${t}, Á±ªÂûã: ${this.enemyType}`),s)e.drawImage(s,this.position.x,this.position.y,this.size.x,this.size.y);else{e.drawRect(this.position.x,this.position.y,this.size.x,this.size.y,r.ENEMY_PRIMARY);const a=this.position.x+this.size.x/2,l=this.position.y+this.size.y;e.drawRect(a-2,l,4,4,r.ENEMY_SECONDARY),e.drawRect(this.position.x-2,this.position.y+4,4,8,r.ENEMY_DARK),e.drawRect(this.position.x+this.size.x-2,this.position.y+4,4,8,r.ENEMY_DARK),e.drawRect(a-1,this.position.y+this.size.y/2-1,2,2,r.ENEMY_SECONDARY)}this.maxHealth>1&&this.renderHealthBar(e)}renderHealthBar(e){const t=this.size.x,s=4,a=this.position.x,l=this.position.y-8;e.drawRect(a,l,t,s,"#333333");const o=this.health/this.maxHealth,h=t*o;let m="#00FF00";o<.3?m="#FF0000":o<.6&&(m="#FFFF00"),e.drawRect(a,l,h,s,m),e.drawRectOutline(a,l,t,s,"#FFFFFF",1)}takeDamage(e){return this.health-=e,this.health<=0?(this.destroy(),!0):!1}shouldShoot(){return this.active&&this.shootTimer>=this.shootInterval}shoot(){if(!this.shouldShoot())return null;this.shootTimer=0;const e=Object.values(g).find(l=>l.id===this.enemyType)||g.BASIC;let t=u.NORMAL;(e.bulletType==="laser"||e.bulletType==="all"&&Math.random()<.2)&&(t=u.LASER);const s=t===u.LASER?v.LASER:v.NORMAL;return{position:{x:this.position.x+this.size.x/2-s.size.x/2,y:this.position.y+this.size.y+4},velocity:this.getShootVelocity(),size:{...s.size},owner:"enemy",damage:1,bulletType:t,active:!0,update:()=>{},render:()=>{}}}getShootVelocity(){const e=Object.values(g).find(s=>s.id===this.enemyType)||g.BASIC,t=e.bulletType==="laser"?v.LASER:v.NORMAL;switch(e.shootPattern){case"diagonal":const s=Math.random()<.5?-.5:.5;return d(t.speed*s,t.speed);case"mixed":if(Math.random()<.5)return d(0,t.speed);{const l=Math.random()<.5?-.5:.5;return d(t.speed*l,t.speed)}case"all":const a=Math.random();if(a<.4)return d(0,t.speed);if(a<.8){const l=Math.random()<.5?-.6:.6;return d(t.speed*l,t.speed)}else return d(0,v.LASER.speed);case"straight":default:return d(0,t.speed)}}checkBounds(){this.position.y>this.canvasHeight&&this.destroy(),(this.position.x+this.size.x<0||this.position.x>this.canvasWidth)&&this.destroy()}getCenterPosition(){return{x:this.position.x+this.size.x/2,y:this.position.y+this.size.y/2}}setSpeed(e){this.speed=e,this.velocity.y=e}setShootInterval(e){this.shootInterval=e}isInBounds(){return this.position.x+this.size.x>=0&&this.position.x<=this.canvasWidth&&this.position.y+this.size.y>=0&&this.position.y<=this.canvasHeight}hasReachedBottom(){return this.position.y>=this.canvasHeight}destroy(){this.active=!1}resetShootTimer(){this.shootTimer=0}getBounds(){return{x:this.position.x,y:this.position.y,width:this.size.x,height:this.size.y}}}class Z{constructor(e,t){i(this,"canvasWidth");i(this,"canvasHeight");i(this,"baseSpeed");i(this,"spawnRate");i(this,"lastSpawnTime");this.canvasWidth=e,this.canvasHeight=t,this.spawnRate=y.enemy.spawnRate,this.lastSpawnTime=0,this.baseSpeed=y.enemy.baseSpeed}update(e,t=0,s=!1){return this.lastSpawnTime+=e,this.lastSpawnTime>=this.spawnRate?(this.lastSpawnTime=0,this.spawnEnemy(t,s)):null}spawnEnemy(e=0,t=!1){const s=this.getRandomEnemyType(e,t),a=Object.values(g).find(m=>m.id===s)||g.BASIC,l=Math.random()*(this.canvasWidth-a.size.x),o=-a.size.y,h=d(l,o);return new B(h,this.canvasWidth,this.canvasHeight,s,this.baseSpeed)}setSpawnRate(e){this.spawnRate=Math.max(100,e)}setEnemySpeed(e){this.baseSpeed=e}forceSpawn(){return this.spawnEnemy()}reset(){this.lastSpawnTime=0}getRandomEnemyType(e=0,t=!1){let s=Object.values(g).filter(o=>e>=o.minScore);if(t&&(s=s.filter(o=>o.id!=="boss")),s.length===0)return w.BASIC;const a=s.reduce((o,h)=>o+h.spawnWeight,0);let l=Math.random()*a;for(const o of s)if(l-=o.spawnWeight,l<=0)return o.id;return w.BASIC}}class ee{constructor(e,t,s=20){i(this,"enemies",[]);i(this,"spawner");i(this,"maxEnemies");i(this,"currentScore",0);i(this,"lastBossScore",0);this.spawner=new Z(e,t),this.maxEnemies=s}update(e){for(const t of this.enemies)t.update(e);if(this.enemies=this.enemies.filter(t=>t.active),this.checkBossSpawn(),this.enemies.length<this.maxEnemies){const t=this.spawner.update(e,this.currentScore,this.hasBoss());t&&this.enemies.push(t)}}render(e){for(const t of this.enemies)t.render(e)}getActiveEnemies(){return this.enemies.filter(e=>e.active)}getShootingEnemies(){return this.enemies.filter(e=>e.active&&e.shouldShoot())}getEnemiesAtBottom(){return this.enemies.filter(e=>e.active&&e.hasReachedBottom())}removeEnemy(e){e.destroy()}clear(){this.enemies=[]}getCount(){return this.enemies.length}getActiveCount(){return this.enemies.filter(e=>e.active).length}setDifficulty(e,t){this.spawner.setSpawnRate(e),this.spawner.setEnemySpeed(t)}setCurrentScore(e){this.currentScore=e}getEnemyScoreValue(e){return(Object.values(g).find(s=>s.id===e.enemyType)||g.BASIC).scoreValue}hasBoss(){return this.enemies.some(e=>e.enemyType===w.BOSS&&e.active)}checkBossSpawn(){const e=Math.floor(this.currentScore/5e3)*5e3;e>this.lastBossScore&&e>=5e3&&!this.hasBoss()&&(this.spawnBoss(),this.lastBossScore=e)}spawnBoss(){const e=g.BOSS,t=Math.random()*(this.spawner.canvasWidth-e.size.x),s=-e.size.y,a=d(t,s),l=new B(a,this.spawner.canvasWidth,this.spawner.canvasHeight,w.BOSS,this.spawner.baseSpeed);this.enemies.push(l),console.log("BossÂ∑≤ÁîüÊàêÔºÅ")}resetBossSpawn(){this.lastBossScore=0}}class te{constructor(e,t,s,a){i(this,"position");i(this,"velocity");i(this,"size");i(this,"active");i(this,"powerUpType");i(this,"collected");i(this,"canvasHeight");i(this,"floatTimer",0);this.position={...e},this.powerUpType=t,this.canvasHeight=a,this.collected=!1,this.active=!0;const l=Object.values(L).find(o=>o.id===t)||L.MISSILE;this.size={...l.size},this.velocity=d(0,30)}update(e){if(!this.active||this.collected)return;this.position.x+=this.velocity.x*(e/1e3),this.position.y+=this.velocity.y*(e/1e3),this.floatTimer+=e;const t=Math.sin(this.floatTimer/500)*2;this.position.y+=t*(e/1e3),this.position.y>this.canvasHeight+this.size.y&&(this.active=!1)}render(e){if(!this.active||this.collected)return;const t=`powerup-${this.powerUpType}`,s=R(t);s?e.drawImage(s,this.position.x,this.position.y,this.size.x,this.size.y):this.renderFallback(e),this.renderGlowEffect(e)}renderFallback(e){this.powerUpType===I.MISSILE&&(e.drawRect(this.position.x,this.position.y,this.size.x,this.size.y,"#00FF00"),e.drawRect(this.position.x+8,this.position.y+4,16,4,"#FFFF00"),e.drawRect(this.position.x+12,this.position.y+8,8,16,"#FFFF00"),e.drawRectOutline(this.position.x,this.position.y,this.size.x,this.size.y,"#FFFFFF",2))}renderGlowEffect(e){const t=(Math.sin(this.floatTimer/200)+1)/2,s=4+t*2;e.setAlpha(.3*t),e.drawRect(this.position.x-s,this.position.y-s,this.size.x+s*2,this.size.y+s*2,"#00FFFF"),e.setAlpha(1)}collect(){this.collected=!0,this.active=!1}checkCollision(e,t){return this.position.x<e.x+t.x&&this.position.x+this.size.x>e.x&&this.position.y<e.y+t.y&&this.position.y+this.size.y>e.y}}class se{constructor(e,t){i(this,"powerUps",[]);i(this,"canvasWidth");i(this,"canvasHeight");i(this,"spawnedMissilePackages",new Set);this.canvasWidth=e,this.canvasHeight=t}update(e,t){this.checkMissilePackageSpawn(t);for(const s of this.powerUps)s.update(e);this.powerUps=this.powerUps.filter(s=>s.active)}checkMissilePackageSpawn(e){if(e>=1e3&&!this.spawnedMissilePackages.has(1e3)){this.spawnMissilePackage(),this.spawnedMissilePackages.add(1e3);return}for(let t=1;t<=20;t++){const s=5e3*t-500;if(e>=s&&!this.spawnedMissilePackages.has(s)){this.spawnMissilePackage(),this.spawnedMissilePackages.add(s),console.log(`Âú®${s}ÂàÜÁîüÊàêÂØºÂºπÂåÖÔºÅ`);break}}}render(e){for(const t of this.powerUps)t.render(e)}spawnMissilePackage(){const e=this.canvasWidth/2-16,t=this.canvasHeight/2-16,s=d(e,t),a=new te(s,I.MISSILE,this.canvasWidth,this.canvasHeight);this.powerUps.push(a)}checkCollisions(e,t){const s=[];for(const a of this.powerUps)!a.collected&&a.checkCollision(e,t)&&(a.collect(),s.push(a));return s}getActivePowerUps(){return this.powerUps.filter(e=>e.active)}clear(){this.powerUps=[],this.spawnedMissilePackages.clear()}resetMissilePackage(){this.spawnedMissilePackages.clear()}}class ie{constructor(e){i(this,"canvas");i(this,"renderer");i(this,"inputManager");i(this,"collisionSystem");i(this,"lifeSystem");i(this,"scoreSystem");i(this,"difficultySystem");i(this,"player");i(this,"bulletManager");i(this,"enemyManager");i(this,"powerUpManager");i(this,"gameState");i(this,"isRunning");i(this,"lastTime");i(this,"scoreElement");i(this,"livesElement");i(this,"assetsLoaded",!1);if(this.canvas=document.getElementById(e),!this.canvas)throw new Error(`CanvasÂÖÉÁ¥† '${e}' Êú™ÊâæÂà∞`);this.renderer=new D(this.canvas),this.inputManager=new Y,this.collisionSystem=new H,this.lifeSystem=new K,this.scoreSystem=new G,this.difficultySystem=new W,this.player=new q(this.canvas.width,this.canvas.height),this.bulletManager=new Q(this.canvas.width,this.canvas.height),this.enemyManager=new ee(this.canvas.width,this.canvas.height),this.powerUpManager=new se(this.canvas.width,this.canvas.height),this.gameState=p.MENU,this.isRunning=!1,this.lastTime=0,this.scoreElement=document.getElementById("score"),this.livesElement=document.getElementById("lives"),this.gameLoop=this.gameLoop.bind(this),this.menuLoop=this.menuLoop.bind(this),this.setupInput(),this.initializeAssets()}setupInput(){this.inputManager.onKeyDown("Enter",()=>{(this.gameState===p.MENU||this.gameState===p.GAME_OVER)&&this.startGame()}),this.inputManager.onKeyDown("Escape",()=>{this.gameState===p.PLAYING?this.pauseGame():this.gameState===p.PAUSED&&this.resumeGame()}),this.inputManager.onKeyDown("KeyQ",()=>{(this.gameState===p.PLAYING||this.gameState===p.PAUSED||this.gameState===p.GAME_OVER)&&this.quitToMenu()}),this.inputManager.onKeyDown("KeyK",()=>{this.gameState===p.PLAYING&&this.handleMissileShoot()})}async initializeAssets(){try{await j(),this.assetsLoaded=!0,this.startMenuLoop()}catch(e){console.error("ËµÑÊ∫êÂä†ËΩΩÂ§±Ë¥•:",e),this.assetsLoaded=!0,this.startMenuLoop()}}startMenuLoop(){this.inputManager.startListening(),requestAnimationFrame(this.menuLoop)}menuLoop(){this.render(),(this.gameState===p.MENU||this.gameState===p.GAME_OVER)&&requestAnimationFrame(this.menuLoop)}startGame(){this.gameState=p.PLAYING,this.isRunning=!0,this.lifeSystem.reset(),this.scoreSystem.reset(),this.difficultySystem.reset(),this.player.respawn(),this.bulletManager.clear(),this.enemyManager.clear(),this.powerUpManager.clear(),this.enemyManager.resetBossSpawn(),this.lastTime=performance.now(),requestAnimationFrame(this.gameLoop)}pauseGame(){this.gameState=p.PAUSED}resumeGame(){this.gameState=p.PLAYING,this.lastTime=performance.now()}endGame(){this.gameState=p.GAME_OVER}quitToMenu(){this.gameState=p.MENU,this.isRunning=!1,this.lifeSystem.reset(),this.scoreSystem.reset(),this.difficultySystem.reset(),this.bulletManager.clear(),this.enemyManager.clear(),this.powerUpManager.clear(),this.enemyManager.resetBossSpawn(),this.startMenuLoop()}gameLoop(e){if(!this.isRunning)return;const t=e-this.lastTime;this.lastTime=e,this.gameState===p.PLAYING&&this.update(t),this.render(),this.isRunning&&requestAnimationFrame(this.gameLoop)}update(e){this.difficultySystem.update(e),this.updateDifficulty(),this.updatePlayer(e),this.bulletManager.update(e),this.enemyManager.setCurrentScore(this.scoreSystem.getScore()),this.enemyManager.update(e),this.powerUpManager.update(e,this.scoreSystem.getScore()),this.handleEnemyShooting(),this.handleCollisions(),this.handlePowerUpCollection(),this.checkGameOver(),this.updateUI()}updateDifficulty(){const e=this.difficultySystem.getDifficultyInfo();this.enemyManager.setDifficulty(e.spawnRate,e.enemySpeed),this.player.speed=e.playerSpeed}updatePlayer(e){const t=this.inputManager.getInputState(),s=this.inputManager.getMovementVector();if(this.player.updateMovement(s,e),this.player.update(e),t.shoot&&this.player.canShoot()){const a=this.player.shoot();a&&this.bulletManager.createPlayerBullet(a.position)}}handleEnemyShooting(){const e=this.enemyManager.getShootingEnemies();for(const t of e){const s=t.shoot();s&&this.bulletManager.createEnemyBullet(s.position,s.velocity,s.bulletType)}}handleCollisions(){const e=this.enemyManager.getActiveEnemies(),t=this.bulletManager.getActiveBullets(),s=this.collisionSystem.checkAllCollisions(this.player,e,t);for(const l of s.playerEnemyCollisions)l.destroy(),this.lifeSystem.loseLife(),this.player.respawn();for(const l of s.bulletEnemyCollisions)if(l.bullet.destroy(),l.enemy.takeDamage(1)){const o=this.enemyManager.getEnemyScoreValue(l.enemy);this.scoreSystem.addScore(o)}for(const l of s.bulletPlayerCollisions)l.destroy(),this.lifeSystem.loseLife(),this.player.respawn();const a=this.enemyManager.getEnemiesAtBottom();for(const l of a)l.destroy(),this.lifeSystem.loseLife()}checkGameOver(){this.lifeSystem.isGameOver()&&this.endGame()}updateUI(){this.scoreElement&&(this.scoreElement.textContent=this.scoreSystem.getScore().toString()),this.livesElement&&(this.livesElement.textContent=this.lifeSystem.getLives().toString())}renderGameUI(){if(this.player.hasMissileAbility()){const e=this.player.getMissileTimeLeft();this.renderer.drawText(`ÂØºÂºπ: ${e}s`,10,this.canvas.height-60,c.UI_ACCENT,"16px Courier New"),this.renderer.drawText("K - ÂèëÂ∞ÑÂØºÂºπ",10,this.canvas.height-40,c.UI_TEXT,"14px Courier New")}}render(){if(this.renderer.clear(),!this.assetsLoaded){this.renderLoading();return}switch(this.gameState){case p.MENU:this.renderMenu();break;case p.PLAYING:this.renderGame(),this.renderGameUI();break;case p.PAUSED:this.renderGame(),this.renderGameUI(),this.renderPauseOverlay();break;case p.GAME_OVER:this.renderGame(),this.renderGameOverOverlay();break}}renderLoading(){const e=this.canvas.width/2,t=this.canvas.height/2;this.renderer.drawText("Âä†ËΩΩÊ∏∏ÊàèËµÑÊ∫ê‰∏≠...",e-80,t,c.UI_TEXT,"18px Courier New")}renderMenu(){const e=this.canvas.width/2,t=this.canvas.height/2;this.renderer.drawText("ÂÉèÁ¥†Â∞ÑÂáªÊ∏∏Êàè",e-80,t-100,c.UI_ACCENT,"28px Courier New"),this.renderer.drawText("PIXEL SHOOTER",e-70,t-70,c.UI_TEXT,"16px Courier New"),this.renderer.drawRectOutline(e-100,t-20,200,40,c.UI_ACCENT,2),this.renderer.drawText("PLAY",e-20,t-5,c.UI_ACCENT,"20px Courier New"),this.renderer.drawText("Êåâ Enter ÂºÄÂßãÊ∏∏Êàè",e-80,t+40,c.UI_TEXT,"14px Courier New"),this.renderer.drawText("Ê∏∏ÊàèÊéßÂà∂:",e-50,t+80,c.UI_TEXT,"16px Courier New"),this.renderer.drawText("WSAD - ÁßªÂä®È£ûËàπ",e-70,t+105,c.UI_TEXT,"14px Courier New"),this.renderer.drawText("J - Â∞ÑÂáª",e-30,t+125,c.UI_TEXT,"14px Courier New"),this.renderer.drawText("Esc - ÊöÇÂÅúÊ∏∏Êàè",e-50,t+145,c.UI_TEXT,"14px Courier New"),this.renderer.drawText("K - ÂØºÂºπÂèëÂ∞Ñ (ÈúÄÈÅìÂÖ∑)",e-80,t+165,c.UI_TEXT,"14px Courier New"),this.renderer.drawText("Q - ÈÄÄÂá∫Âà∞ËèúÂçï",e-60,t+185,c.UI_TEXT,"14px Courier New"),this.scoreSystem.getHighScore()>0&&this.renderer.drawText(`ÊúÄÈ´òÂàÜ: ${this.scoreSystem.getHighScore()}`,e-60,t+200,c.UI_ACCENT,"16px Courier New")}renderGame(){this.renderBackground(),this.player.render(this.renderer),this.bulletManager.render(this.renderer),this.enemyManager.render(this.renderer),this.powerUpManager.render(this.renderer)}renderBackground(){const e=R("background");e&&this.renderer.drawBackground(e,"stretch")}renderPauseOverlay(){const e=this.canvas.width/2,t=this.canvas.height/2;this.renderer.setAlpha(.8),this.renderer.drawRect(0,0,this.canvas.width,this.canvas.height,"#000000"),this.renderer.setAlpha(1),this.renderer.drawRectOutline(e-120,t-60,240,120,c.UI_ACCENT,2),this.renderer.drawText("Ê∏∏ÊàèÊöÇÂÅú",e-40,t-30,c.UI_TEXT,"20px Courier New"),this.renderer.drawText("Esc - ÁªßÁª≠Ê∏∏Êàè",e-60,t+5,c.UI_ACCENT,"16px Courier New"),this.renderer.drawText("Q - ÈÄÄÂá∫Âà∞ËèúÂçï",e-70,t+30,c.UI_TEXT,"16px Courier New")}renderGameOverOverlay(){const e=this.canvas.width/2,t=this.canvas.height/2;this.renderer.setAlpha(.9),this.renderer.drawRect(0,0,this.canvas.width,this.canvas.height,"#000000"),this.renderer.setAlpha(1),this.renderer.drawRectOutline(e-150,t-80,300,160,c.UI_ACCENT,3),this.renderer.drawText("GAME OVER",e-60,t-60,c.UI_ACCENT,"24px Courier New"),this.renderer.drawText(`ÊúÄÁªàÂæóÂàÜ: ${this.scoreSystem.getScore()}`,e-80,t-20,c.UI_TEXT,"18px Courier New"),this.scoreSystem.getScore()===this.scoreSystem.getHighScore()&&this.scoreSystem.getScore()>0?this.renderer.drawText("üéâ Êñ∞Á∫™ÂΩï! üéâ",e-60,t+5,c.UI_ACCENT,"16px Courier New"):this.renderer.drawText(`ÊúÄÈ´òÂæóÂàÜ: ${this.scoreSystem.getHighScore()}`,e-80,t+5,c.UI_TEXT,"16px Courier New"),this.renderer.drawText("Enter - ÈáçÊñ∞ÂºÄÂßã",e-80,t+40,c.UI_ACCENT,"16px Courier New"),this.renderer.drawText("Q - ËøîÂõûËèúÂçï",e-60,t+60,c.UI_TEXT,"16px Courier New")}handleMissileShoot(){const e=this.player.shootMissile();if(e)for(const t of e)this.bulletManager.createPlayerMissile(t.position,t.velocity)}handlePowerUpCollection(){const e=this.powerUpManager.checkCollisions(this.player.position,this.player.size);for(const t of e)t.powerUpType===I.MISSILE&&(this.player.gainMissiles(),console.log("Ëé∑ÂæóÂØºÂºπËÉΩÂäõÔºÅ"))}destroy(){this.isRunning=!1,this.inputManager.destroy()}}console.log("ÂÉèÁ¥†Â∞ÑÂáªÊ∏∏ÊàèÂàùÂßãÂåñ‰∏≠...");let P;try{P=new ie("gameCanvas"),console.log("Ê∏∏ÊàèÂàùÂßãÂåñÂÆåÊàê! Ê≠£Âú®Âä†ËΩΩËµÑÊ∫ê..."),console.log(""),console.log("üéÆ ÊéßÂà∂ËØ¥Êòé:"),console.log("- Enter: ÂºÄÂßãÊ∏∏Êàè"),console.log("- WSAD: ÁßªÂä®È£ûËàπ"),console.log("- Á©∫Ê†º: Â∞ÑÂáª"),console.log("- Esc: ÊöÇÂÅú/ÁªßÁª≠"),console.log("- Q: ÈÄÄÂá∫Âà∞ËèúÂçï"),console.log(""),console.log("üé® Ëá™ÂÆö‰πâÂõæÁâá:"),console.log("Â∞ÜÂõæÁâáÊîæÂú® public/assets/ Êñá‰ª∂Â§π‰∏≠:"),console.log("- player.png (Áé©ÂÆ∂È£ûËàπ)"),console.log("- enemy.png (Êïå‰∫∫È£ûËàπ)"),console.log("- player-bullet.png (Áé©ÂÆ∂Â≠êÂºπ)"),console.log("- enemy-bullet.png (Êïå‰∫∫Â≠êÂºπ)"),console.log("- background.png (Ê∏∏ÊàèËÉåÊôØ)"),console.log("Â¶ÇÊûúÊ≤°ÊúâÂõæÁâáÔºå‰ºö‰ΩøÁî®ÈªòËÆ§ÁöÑÂÉèÁ¥†Ëâ∫ÊúØÈ£éÊ†º„ÄÇ")}catch(n){console.error("Ê∏∏ÊàèÂàùÂßãÂåñÂ§±Ë¥•:",n);const e=document.getElementById("gameCanvas");if(e){const t=e.getContext("2d");t&&(t.fillStyle="#ff0000",t.font="16px Courier New",t.fillText("Ê∏∏ÊàèÂàùÂßãÂåñÂ§±Ë¥•!",50,50),t.fillText("ËØ∑Ê£ÄÊü•ÊéßÂà∂Âè∞ÈîôËØØ‰ø°ÊÅØ",50,80))}}window.addEventListener("beforeunload",()=>{P&&P.destroy()});
//# sourceMappingURL=index-af9be3c7.js.map
