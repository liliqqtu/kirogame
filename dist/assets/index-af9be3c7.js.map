{"version":3,"file":"index-af9be3c7.js","sources":["../../src/types/index.ts","../../src/utils/constants.ts","../../src/systems/renderer.ts","../../src/systems/inputManager.ts","../../src/utils/collision.ts","../../src/systems/collisionSystem.ts","../../src/systems/lifeSystem.ts","../../src/systems/scoreSystem.ts","../../src/systems/difficultySystem.ts","../../src/utils/math.ts","../../src/systems/colorSystem.ts","../../src/systems/assetManager.ts","../../src/systems/defaultAssets.ts","../../src/entities/playerShip.ts","../../src/entities/bullet.ts","../../src/entities/enemyShip.ts","../../src/entities/powerUp.ts","../../src/game.ts","../../src/main.ts"],"sourcesContent":["// 核心类型定义文件\r\n\r\n/**\r\n * 2D向量接口\r\n */\r\nexport interface Vector2D {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\n/**\r\n * 游戏实体基础接口\r\n */\r\nexport interface GameEntity {\r\n  position: Vector2D;\r\n  velocity: Vector2D;\r\n  size: Vector2D;\r\n  active: boolean;\r\n  update(deltaTime: number): void;\r\n  render(renderer: Renderer): void;\r\n}\r\n\r\n/**\r\n * 渲染器接口\r\n */\r\nexport interface Renderer {\r\n  clear(): void;\r\n  drawRect(x: number, y: number, width: number, height: number, color: string): void;\r\n  drawText(text: string, x: number, y: number, color: string, font?: string): void;\r\n  setPixelPerfect(enabled: boolean): void;\r\n  drawRectOutline(x: number, y: number, width: number, height: number, color: string, lineWidth?: number): void;\r\n  drawCircle(x: number, y: number, radius: number, color: string): void;\r\n  drawLine(x1: number, y1: number, x2: number, y2: number, color: string, lineWidth?: number): void;\r\n  save(): void;\r\n  restore(): void;\r\n  setAlpha(alpha: number): void;\r\n  drawImage(image: HTMLImageElement, x: number, y: number, width?: number, height?: number): void;\r\n  drawImagePart(image: HTMLImageElement, sourceX: number, sourceY: number, sourceWidth: number, sourceHeight: number, destX: number, destY: number, destWidth?: number, destHeight?: number): void;\r\n  drawRotatedImage(image: HTMLImageElement, x: number, y: number, width: number, height: number, rotation: number): void;\r\n  drawBackground(image: HTMLImageElement, mode?: 'stretch' | 'tile'): void;\r\n}\r\n\r\n/**\r\n * 游戏状态接口\r\n */\r\nexport interface GameState {\r\n  player: PlayerShip;\r\n  enemies: EnemyShip[];\r\n  bullets: Bullet[];\r\n  score: number;\r\n  lives: number;\r\n  gameTime: number;\r\n  isGameOver: boolean;\r\n  isPaused: boolean;\r\n}\r\n\r\n/**\r\n * 游戏配置接口\r\n */\r\nexport interface GameConfig {\r\n  canvas: {\r\n    width: number;\r\n    height: number;\r\n  };\r\n  player: {\r\n    speed: number;\r\n    size: Vector2D;\r\n    shootCooldown: number;\r\n    startPosition: Vector2D;\r\n  };\r\n  enemy: {\r\n    baseSpeed: number;\r\n    size: Vector2D;\r\n    spawnRate: number;\r\n    shootInterval: number;\r\n  };\r\n  bullet: {\r\n    speed: number;\r\n    size: Vector2D;\r\n  };\r\n  difficulty: {\r\n    speedIncreaseRate: number;\r\n    maxSpeed: number;\r\n    enemySpawnIncreaseRate: number;\r\n    timeInterval: number;\r\n  };\r\n  game: {\r\n    initialLives: number;\r\n    targetFPS: number;\r\n  };\r\n}\r\n\r\n/**\r\n * 输入状态接口\r\n */\r\nexport interface InputState {\r\n  up: boolean;\r\n  down: boolean;\r\n  left: boolean;\r\n  right: boolean;\r\n  shoot: boolean;\r\n}\r\n\r\n/**\r\n * 玩家飞船接口\r\n */\r\nexport interface PlayerShip extends GameEntity {\r\n  speed: number;\r\n  shootCooldown: number;\r\n  lastShotTime: number;\r\n  canShoot(): boolean;\r\n  shoot(): Bullet | null;\r\n  takeDamage(): void;\r\n  respawn(): void;\r\n}\r\n\r\n/**\r\n * 敌人飞船接口\r\n */\r\nexport interface EnemyShip extends GameEntity {\r\n  speed: number;\r\n  shootTimer: number;\r\n  shootInterval: number;\r\n  enemyType: EnemyType;\r\n  health: number;\r\n  maxHealth: number;\r\n  shouldShoot(): boolean;\r\n  shoot(): Bullet | null;\r\n  takeDamage(damage: number): boolean; // 返回是否被摧毁\r\n}\r\n\r\n/**\r\n * 敌人类型枚举\r\n */\r\nexport enum EnemyType {\r\n  BASIC = 'basic',\r\n  DIAGONAL = 'diagonal',\r\n  LASER = 'laser',\r\n  ELITE = 'elite',\r\n  BOSS = 'boss',\r\n}\r\n\r\n/**\r\n * 子弹接口\r\n */\r\nexport interface Bullet extends GameEntity {\r\n  owner: 'player' | 'enemy';\r\n  damage: number;\r\n  bulletType: BulletType;\r\n}\r\n\r\n/**\r\n * 子弹类型枚举\r\n */\r\nexport enum BulletType {\r\n  NORMAL = 'normal',\r\n  LASER = 'laser',\r\n}\r\n\r\n/**\r\n * 碰撞检测结果\r\n */\r\nexport interface CollisionResult {\r\n  hasCollision: boolean;\r\n  entity1: GameEntity;\r\n  entity2: GameEntity;\r\n}\r\n\r\n/**\r\n * 游戏事件类型\r\n */\r\nexport type GameEvent = \r\n  | { type: 'ENEMY_DESTROYED'; enemy: EnemyShip; score: number }\r\n  | { type: 'PLAYER_HIT'; damage: number }\r\n  | { type: 'BULLET_FIRED'; bullet: Bullet }\r\n  | { type: 'GAME_OVER' }\r\n  | { type: 'LEVEL_UP'; newLevel: number };\r\n\r\n/**\r\n * 实体类型枚举\r\n */\r\nexport enum EntityType {\r\n  PLAYER = 'player',\r\n  ENEMY = 'enemy',\r\n  BULLET = 'bullet',\r\n}\r\n\r\n/**\r\n * 游戏状态枚举\r\n */\r\nexport enum GameStateType {\r\n  MENU = 'menu',\r\n  PLAYING = 'playing',\r\n  PAUSED = 'paused',\r\n  GAME_OVER = 'game_over',\r\n}\r\n\r\n/**\r\n * 道具类型枚举\r\n */\r\nexport enum PowerUpType {\r\n  MISSILE = 'missile',\r\n}\r\n\r\n/**\r\n * 道具接口\r\n */\r\nexport interface PowerUp extends GameEntity {\r\n  powerUpType: PowerUpType;\r\n  collected: boolean;\r\n  collect(): void;\r\n}","import { GameConfig } from '@/types';\r\n\r\n/**\r\n * 默认游戏配置\r\n */\r\nexport const DEFAULT_GAME_CONFIG: GameConfig = {\r\n  canvas: {\r\n    width: 800,\r\n    height: 600,\r\n  },\r\n  player: {\r\n    speed: 200, // 像素/秒\r\n    size: { x: 48, y: 48 }, // 更新为新的飞船尺寸\r\n    shootCooldown: 200, // 毫秒\r\n    startPosition: { x: 376, y: 540 }, // 调整位置以适应新尺寸\r\n  },\r\n  enemy: {\r\n    baseSpeed: 50, // 像素/秒\r\n    size: { x: 48, y: 48 },\r\n    spawnRate: 2000, // 毫秒\r\n    shootInterval: 3000, // 毫秒\r\n  },\r\n  bullet: {\r\n    speed: 300, // 像素/秒\r\n    size: { x: 4, y: 8 },\r\n  },\r\n  difficulty: {\r\n    speedIncreaseRate: 1.1, // 每次增加10%\r\n    maxSpeed: 100, // 最大速度\r\n    enemySpawnIncreaseRate: 0.9, // 生成间隔减少10%\r\n    timeInterval: 30000, // 每30秒增加难度\r\n  },\r\n  game: {\r\n    initialLives: 3,\r\n    targetFPS: 60,\r\n  },\r\n};\r\n\r\n/**\r\n * 游戏颜色常量\r\n */\r\nexport const COLORS = {\r\n  BACKGROUND: '#000011',\r\n  PLAYER: '#00ff00',\r\n  ENEMY: '#ff0000',\r\n  PLAYER_BULLET: '#ffff00',\r\n  ENEMY_BULLET: '#ff8800',\r\n  UI_TEXT: '#ffffff',\r\n  UI_ACCENT: '#00ffff',\r\n} as const;\r\n\r\n/**\r\n * 键盘按键常量\r\n */\r\nexport const KEYS = {\r\n  W: 'KeyW',\r\n  A: 'KeyA',\r\n  S: 'KeyS',\r\n  D: 'KeyD',\r\n  J: 'KeyJ', // 普通射击键\r\n  SPACE: 'Space',\r\n  ESCAPE: 'Escape',\r\n  ENTER: 'Enter',\r\n  K: 'KeyK', // 导弹发射键\r\n} as const;\r\n\r\n/**\r\n * 游戏事件常量\r\n */\r\nexport const GAME_EVENTS = {\r\n  ENEMY_DESTROYED: 'ENEMY_DESTROYED',\r\n  PLAYER_HIT: 'PLAYER_HIT',\r\n  BULLET_FIRED: 'BULLET_FIRED',\r\n  GAME_OVER: 'GAME_OVER',\r\n  LEVEL_UP: 'LEVEL_UP',\r\n} as const;\r\n\r\n/**\r\n * 得分常量\r\n */\r\nexport const SCORING = {\r\n  ENEMY_KILL: 100,\r\n  BONUS_MULTIPLIER: 1.5,\r\n} as const;\r\n\r\n/**\r\n * 敌人类型配置\r\n */\r\nexport const ENEMY_TYPES = {\r\n  BASIC: {\r\n    id: 'basic',\r\n    size: { x: 48, y: 48 },\r\n    shootInterval: 3000,\r\n    bulletType: 'normal',\r\n    shootPattern: 'straight',\r\n    spawnWeight: 50, // 生成权重\r\n    health: 1,\r\n    scoreValue: 100,\r\n    speedMultiplier: 1.0,\r\n    minScore: 0, // 最低分数要求\r\n  },\r\n  DIAGONAL: {\r\n    id: 'diagonal',\r\n    size: { x: 56, y: 56 },\r\n    shootInterval: 2500,\r\n    bulletType: 'normal',\r\n    shootPattern: 'diagonal',\r\n    spawnWeight: 30,\r\n    health: 1,\r\n    scoreValue: 100,\r\n    speedMultiplier: 1.0,\r\n    minScore: 0,\r\n  },\r\n  LASER: {\r\n    id: 'laser',\r\n    size: { x: 64, y: 64 },\r\n    shootInterval: 8000, // 大幅增加发射间隔\r\n    bulletType: 'laser',\r\n    shootPattern: 'straight',\r\n    spawnWeight: 20,\r\n    health: 1,\r\n    scoreValue: 100,\r\n    speedMultiplier: 1.0,\r\n    minScore: 0,\r\n  },\r\n  ELITE: {\r\n    id: 'elite',\r\n    size: { x: 108, y: 108 },\r\n    shootInterval: 2000,\r\n    bulletType: 'mixed', // 混合攻击模式\r\n    shootPattern: 'mixed',\r\n    spawnWeight: 15,\r\n    health: 3,\r\n    scoreValue: 300,\r\n    speedMultiplier: 0.7, // 移动稍慢\r\n    minScore: 1000, // 1000分后出现\r\n  },\r\n  BOSS: {\r\n    id: 'boss',\r\n    size: { x: 192, y: 192 },\r\n    shootInterval: 1000, // 攻击间隔更短\r\n    bulletType: 'all', // 所有攻击模式\r\n    shootPattern: 'all',\r\n    spawnWeight: 5,\r\n    health: 15,\r\n    scoreValue: 1000,\r\n    speedMultiplier: 0.3, // 移动更慢\r\n    minScore: 5000, // 5000分后出现\r\n  },\r\n} as const;\r\n\r\n/**\r\n * 子弹类型配置\r\n */\r\nexport const BULLET_TYPES = {\r\n  NORMAL: {\r\n    size: { x: 12, y: 24 },\r\n    speed: 200,\r\n    color: '#ff8800',\r\n  },\r\n  LASER: {\r\n    size: { x: 18, y: 96 }, // 激光束更长\r\n    speed: 250,\r\n    color: '#ff8800',\r\n  },\r\n} as const;\r\n/**\r\n * 道具配置\r\n */\r\nexport const POWERUP_TYPES = {\r\n  MISSILE: {\r\n    id: 'missile',\r\n    size: { x: 32, y: 32 },\r\n    scoreRequirement: 1000, // 1000分时生成\r\n    duration: 40000, // 持续40秒\r\n  },\r\n} as const;\r\n\r\n/**\r\n * 导弹配置\r\n */\r\nexport const MISSILE_CONFIG = {\r\n  speed: 350,\r\n  size: { x: 6, y: 12 },\r\n  angle: Math.PI / 4, // 45度角\r\n  cooldown: 300, // 发射间隔300ms\r\n} as const;","import { Renderer } from '@/types';\r\nimport { COLORS } from '@/utils/constants';\r\n\r\n/**\r\n * Canvas渲染器实现\r\n */\r\nexport class CanvasRenderer implements Renderer {\r\n  private ctx: CanvasRenderingContext2D;\r\n  private canvas: HTMLCanvasElement;\r\n\r\n  constructor(canvas: HTMLCanvasElement) {\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) {\r\n      throw new Error('无法获取Canvas 2D上下文');\r\n    }\r\n    \r\n    this.canvas = canvas;\r\n    this.ctx = ctx;\r\n    \r\n    // 默认启用像素完美渲染\r\n    this.setPixelPerfect(true);\r\n  }\r\n\r\n  /**\r\n   * 清空画布\r\n   */\r\n  clear(): void {\r\n    this.ctx.fillStyle = COLORS.BACKGROUND;\r\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n  }\r\n\r\n  /**\r\n   * 绘制矩形\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number, color: string): void {\r\n    this.ctx.fillStyle = color;\r\n    this.ctx.fillRect(Math.floor(x), Math.floor(y), Math.floor(width), Math.floor(height));\r\n  }\r\n\r\n  /**\r\n   * 绘制文本\r\n   */\r\n  drawText(text: string, x: number, y: number, color: string, font: string = '16px Courier New'): void {\r\n    this.ctx.fillStyle = color;\r\n    this.ctx.font = font;\r\n    this.ctx.textAlign = 'left';\r\n    this.ctx.textBaseline = 'top';\r\n    this.ctx.fillText(text, Math.floor(x), Math.floor(y));\r\n  }\r\n\r\n  /**\r\n   * 设置像素完美渲染\r\n   */\r\n  setPixelPerfect(enabled: boolean): void {\r\n    this.ctx.imageSmoothingEnabled = !enabled;\r\n    \r\n    // 设置像素艺术风格的渲染属性\r\n    if (enabled) {\r\n      this.canvas.style.imageRendering = 'pixelated';\r\n      this.canvas.style.imageRendering = '-moz-crisp-edges';\r\n      this.canvas.style.imageRendering = 'crisp-edges';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 绘制边框矩形\r\n   */\r\n  drawRectOutline(x: number, y: number, width: number, height: number, color: string, lineWidth: number = 1): void {\r\n    this.ctx.strokeStyle = color;\r\n    this.ctx.lineWidth = lineWidth;\r\n    this.ctx.strokeRect(Math.floor(x), Math.floor(y), Math.floor(width), Math.floor(height));\r\n  }\r\n\r\n  /**\r\n   * 绘制圆形\r\n   */\r\n  drawCircle(x: number, y: number, radius: number, color: string): void {\r\n    this.ctx.fillStyle = color;\r\n    this.ctx.beginPath();\r\n    this.ctx.arc(Math.floor(x), Math.floor(y), radius, 0, 2 * Math.PI);\r\n    this.ctx.fill();\r\n  }\r\n\r\n  /**\r\n   * 绘制线条\r\n   */\r\n  drawLine(x1: number, y1: number, x2: number, y2: number, color: string, lineWidth: number = 1): void {\r\n    this.ctx.strokeStyle = color;\r\n    this.ctx.lineWidth = lineWidth;\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(Math.floor(x1), Math.floor(y1));\r\n    this.ctx.lineTo(Math.floor(x2), Math.floor(y2));\r\n    this.ctx.stroke();\r\n  }\r\n\r\n  /**\r\n   * 保存渲染状态\r\n   */\r\n  save(): void {\r\n    this.ctx.save();\r\n  }\r\n\r\n  /**\r\n   * 恢复渲染状态\r\n   */\r\n  restore(): void {\r\n    this.ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * 设置透明度\r\n   */\r\n  setAlpha(alpha: number): void {\r\n    this.ctx.globalAlpha = Math.max(0, Math.min(1, alpha));\r\n  }\r\n\r\n  /**\r\n   * 获取Canvas尺寸\r\n   */\r\n  getSize(): { width: number; height: number } {\r\n    return {\r\n      width: this.canvas.width,\r\n      height: this.canvas.height,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 获取Canvas元素\r\n   */\r\n  getCanvas(): HTMLCanvasElement {\r\n    return this.canvas;\r\n  }\r\n\r\n  /**\r\n   * 获取渲染上下文\r\n   */\r\n  getContext(): CanvasRenderingContext2D {\r\n    return this.ctx;\r\n  }\r\n\r\n  /**\r\n   * 绘制图片\r\n   */\r\n  drawImage(\r\n    image: HTMLImageElement,\r\n    x: number,\r\n    y: number,\r\n    width?: number,\r\n    height?: number\r\n  ): void {\r\n    const drawX = Math.floor(x);\r\n    const drawY = Math.floor(y);\r\n    \r\n    if (width !== undefined && height !== undefined) {\r\n      this.ctx.drawImage(\r\n        image,\r\n        drawX,\r\n        drawY,\r\n        Math.floor(width),\r\n        Math.floor(height)\r\n      );\r\n    } else {\r\n      this.ctx.drawImage(image, drawX, drawY);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 绘制图片的一部分（精灵表支持）\r\n   */\r\n  drawImagePart(\r\n    image: HTMLImageElement,\r\n    sourceX: number,\r\n    sourceY: number,\r\n    sourceWidth: number,\r\n    sourceHeight: number,\r\n    destX: number,\r\n    destY: number,\r\n    destWidth?: number,\r\n    destHeight?: number\r\n  ): void {\r\n    const drawDestX = Math.floor(destX);\r\n    const drawDestY = Math.floor(destY);\r\n    const drawDestWidth = destWidth ? Math.floor(destWidth) : sourceWidth;\r\n    const drawDestHeight = destHeight ? Math.floor(destHeight) : sourceHeight;\r\n    \r\n    this.ctx.drawImage(\r\n      image,\r\n      sourceX,\r\n      sourceY,\r\n      sourceWidth,\r\n      sourceHeight,\r\n      drawDestX,\r\n      drawDestY,\r\n      drawDestWidth,\r\n      drawDestHeight\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 绘制旋转的图片\r\n   */\r\n  drawRotatedImage(\r\n    image: HTMLImageElement,\r\n    x: number,\r\n    y: number,\r\n    width: number,\r\n    height: number,\r\n    rotation: number\r\n  ): void {\r\n    const centerX = x + width / 2;\r\n    const centerY = y + height / 2;\r\n    \r\n    this.ctx.save();\r\n    this.ctx.translate(Math.floor(centerX), Math.floor(centerY));\r\n    this.ctx.rotate(rotation);\r\n    this.ctx.drawImage(\r\n      image,\r\n      Math.floor(-width / 2),\r\n      Math.floor(-height / 2),\r\n      Math.floor(width),\r\n      Math.floor(height)\r\n    );\r\n    this.ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * 绘制背景图片（平铺或拉伸）\r\n   */\r\n  drawBackground(image: HTMLImageElement, mode: 'stretch' | 'tile' = 'stretch'): void {\r\n    if (mode === 'stretch') {\r\n      this.ctx.drawImage(image, 0, 0, this.canvas.width, this.canvas.height);\r\n    } else if (mode === 'tile') {\r\n      const pattern = this.ctx.createPattern(image, 'repeat');\r\n      if (pattern) {\r\n        this.ctx.fillStyle = pattern;\r\n        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n      }\r\n    }\r\n  }\r\n}","import { InputState } from '@/types';\r\nimport { KEYS } from '@/utils/constants';\r\n\r\n/**\r\n * 输入管理器\r\n * 处理键盘输入并维护当前输入状态\r\n */\r\nexport class InputManager {\r\n  private inputState: InputState;\r\n  private keyDownHandlers: Map<string, () => void>;\r\n  private keyUpHandlers: Map<string, () => void>;\r\n  private isListening: boolean = false;\r\n\r\n  constructor() {\r\n    this.inputState = {\r\n      up: false,\r\n      down: false,\r\n      left: false,\r\n      right: false,\r\n      shoot: false,\r\n    };\r\n\r\n    this.keyDownHandlers = new Map();\r\n    this.keyUpHandlers = new Map();\r\n\r\n    // 绑定事件处理器\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n    this.handleKeyUp = this.handleKeyUp.bind(this);\r\n  }\r\n\r\n  /**\r\n   * 开始监听键盘事件\r\n   */\r\n  startListening(): void {\r\n    if (this.isListening) return;\r\n\r\n    document.addEventListener('keydown', this.handleKeyDown);\r\n    document.addEventListener('keyup', this.handleKeyUp);\r\n    this.isListening = true;\r\n  }\r\n\r\n  /**\r\n   * 停止监听键盘事件\r\n   */\r\n  stopListening(): void {\r\n    if (!this.isListening) return;\r\n\r\n    document.removeEventListener('keydown', this.handleKeyDown);\r\n    document.removeEventListener('keyup', this.handleKeyUp);\r\n    this.isListening = false;\r\n  }\r\n\r\n  /**\r\n   * 处理按键按下事件\r\n   */\r\n  private handleKeyDown(event: KeyboardEvent): void {\r\n    // 阻止默认行为\r\n    if (this.isGameKey(event.code)) {\r\n      event.preventDefault();\r\n    }\r\n\r\n    switch (event.code) {\r\n      case KEYS.W:\r\n        this.inputState.up = true;\r\n        break;\r\n      case KEYS.S:\r\n        this.inputState.down = true;\r\n        break;\r\n      case KEYS.A:\r\n        this.inputState.left = true;\r\n        break;\r\n      case KEYS.D:\r\n        this.inputState.right = true;\r\n        break;\r\n      case KEYS.J:\r\n        this.inputState.shoot = true;\r\n        break;\r\n    }\r\n\r\n    // 调用自定义按键处理器\r\n    const handler = this.keyDownHandlers.get(event.code);\r\n    if (handler) {\r\n      handler();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 处理按键释放事件\r\n   */\r\n  private handleKeyUp(event: KeyboardEvent): void {\r\n    // 阻止默认行为\r\n    if (this.isGameKey(event.code)) {\r\n      event.preventDefault();\r\n    }\r\n\r\n    switch (event.code) {\r\n      case KEYS.W:\r\n        this.inputState.up = false;\r\n        break;\r\n      case KEYS.S:\r\n        this.inputState.down = false;\r\n        break;\r\n      case KEYS.A:\r\n        this.inputState.left = false;\r\n        break;\r\n      case KEYS.D:\r\n        this.inputState.right = false;\r\n        break;\r\n      case KEYS.J:\r\n        this.inputState.shoot = false;\r\n        break;\r\n    }\r\n\r\n    // 调用自定义按键处理器\r\n    const handler = this.keyUpHandlers.get(event.code);\r\n    if (handler) {\r\n      handler();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检查是否是游戏相关按键\r\n   */\r\n  private isGameKey(keyCode: string): boolean {\r\n    return Object.values(KEYS).includes(keyCode as any);\r\n  }\r\n\r\n  /**\r\n   * 获取当前输入状态\r\n   */\r\n  getInputState(): InputState {\r\n    return { ...this.inputState };\r\n  }\r\n\r\n  /**\r\n   * 检查特定方向是否被按下\r\n   */\r\n  isDirectionPressed(direction: 'up' | 'down' | 'left' | 'right'): boolean {\r\n    return this.inputState[direction];\r\n  }\r\n\r\n  /**\r\n   * 检查射击键是否被按下\r\n   */\r\n  isShootPressed(): boolean {\r\n    return this.inputState.shoot;\r\n  }\r\n\r\n  /**\r\n   * 检查是否有任何移动输入\r\n   */\r\n  hasMovementInput(): boolean {\r\n    return this.inputState.up || this.inputState.down || \r\n           this.inputState.left || this.inputState.right;\r\n  }\r\n\r\n  /**\r\n   * 获取移动向量 (-1 到 1)\r\n   */\r\n  getMovementVector(): { x: number; y: number } {\r\n    let x = 0;\r\n    let y = 0;\r\n\r\n    if (this.inputState.left) x -= 1;\r\n    if (this.inputState.right) x += 1;\r\n    if (this.inputState.up) y -= 1;\r\n    if (this.inputState.down) y += 1;\r\n\r\n    return { x, y };\r\n  }\r\n\r\n  /**\r\n   * 注册按键按下处理器\r\n   */\r\n  onKeyDown(keyCode: string, handler: () => void): void {\r\n    this.keyDownHandlers.set(keyCode, handler);\r\n  }\r\n\r\n  /**\r\n   * 注册按键释放处理器\r\n   */\r\n  onKeyUp(keyCode: string, handler: () => void): void {\r\n    this.keyUpHandlers.set(keyCode, handler);\r\n  }\r\n\r\n  /**\r\n   * 移除按键处理器\r\n   */\r\n  removeKeyHandler(keyCode: string): void {\r\n    this.keyDownHandlers.delete(keyCode);\r\n    this.keyUpHandlers.delete(keyCode);\r\n  }\r\n\r\n  /**\r\n   * 清空所有自定义处理器\r\n   */\r\n  clearAllHandlers(): void {\r\n    this.keyDownHandlers.clear();\r\n    this.keyUpHandlers.clear();\r\n  }\r\n\r\n  /**\r\n   * 重置输入状态\r\n   */\r\n  reset(): void {\r\n    this.inputState = {\r\n      up: false,\r\n      down: false,\r\n      left: false,\r\n      right: false,\r\n      shoot: false,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 模拟按键按下（用于测试）\r\n   */\r\n  simulateKeyDown(keyCode: string): void {\r\n    const event = new KeyboardEvent('keydown', { code: keyCode });\r\n    this.handleKeyDown(event);\r\n  }\r\n\r\n  /**\r\n   * 模拟按键释放（用于测试）\r\n   */\r\n  simulateKeyUp(keyCode: string): void {\r\n    const event = new KeyboardEvent('keyup', { code: keyCode });\r\n    this.handleKeyUp(event);\r\n  }\r\n\r\n  /**\r\n   * 销毁输入管理器\r\n   */\r\n  destroy(): void {\r\n    this.stopListening();\r\n    this.clearAllHandlers();\r\n    this.reset();\r\n  }\r\n}","import { Vector2D, GameEntity, CollisionResult } from '@/types';\r\n\r\n/**\r\n * 检查两个矩形是否碰撞 (AABB碰撞检测)\r\n */\r\nexport function checkAABBCollision(\r\n  pos1: Vector2D,\r\n  size1: Vector2D,\r\n  pos2: Vector2D,\r\n  size2: Vector2D\r\n): boolean {\r\n  return (\r\n    pos1.x < pos2.x + size2.x &&\r\n    pos1.x + size1.x > pos2.x &&\r\n    pos1.y < pos2.y + size2.y &&\r\n    pos1.y + size1.y > pos2.y\r\n  );\r\n}\r\n\r\n/**\r\n * 检查两个游戏实体是否碰撞\r\n */\r\nexport function checkEntityCollision(entity1: GameEntity, entity2: GameEntity): CollisionResult {\r\n  const hasCollision = checkAABBCollision(\r\n    entity1.position,\r\n    entity1.size,\r\n    entity2.position,\r\n    entity2.size\r\n  );\r\n\r\n  return {\r\n    hasCollision,\r\n    entity1,\r\n    entity2,\r\n  };\r\n}\r\n\r\n/**\r\n * 检查点是否在矩形内\r\n */\r\nexport function pointInRect(point: Vector2D, rectPos: Vector2D, rectSize: Vector2D): boolean {\r\n  return (\r\n    point.x >= rectPos.x &&\r\n    point.x <= rectPos.x + rectSize.x &&\r\n    point.y >= rectPos.y &&\r\n    point.y <= rectPos.y + rectSize.y\r\n  );\r\n}\r\n\r\n/**\r\n * 检查实体是否在边界内\r\n */\r\nexport function isEntityInBounds(\r\n  entity: GameEntity,\r\n  boundsWidth: number,\r\n  boundsHeight: number\r\n): boolean {\r\n  return (\r\n    entity.position.x >= 0 &&\r\n    entity.position.y >= 0 &&\r\n    entity.position.x + entity.size.x <= boundsWidth &&\r\n    entity.position.y + entity.size.y <= boundsHeight\r\n  );\r\n}\r\n\r\n/**\r\n * 将实体位置限制在边界内\r\n */\r\nexport function clampEntityToBounds(\r\n  entity: GameEntity,\r\n  boundsWidth: number,\r\n  boundsHeight: number\r\n): void {\r\n  entity.position.x = Math.max(0, Math.min(entity.position.x, boundsWidth - entity.size.x));\r\n  entity.position.y = Math.max(0, Math.min(entity.position.y, boundsHeight - entity.size.y));\r\n}","// 碰撞检测系统相关导入\r\nimport { checkEntityCollision } from '@/utils/collision';\r\nimport { PlayerShipImpl } from '@/entities/playerShip';\r\nimport { EnemyShipImpl } from '@/entities/enemyShip';\r\nimport { BulletImpl } from '@/entities/bullet';\r\n\r\n/**\r\n * 碰撞检测系统\r\n */\r\nexport class CollisionSystem {\r\n  /**\r\n   * 检测玩家与敌人的碰撞\r\n   */\r\n  checkPlayerEnemyCollisions(\r\n    player: PlayerShipImpl,\r\n    enemies: EnemyShipImpl[]\r\n  ): EnemyShipImpl[] {\r\n    const collisions: EnemyShipImpl[] = [];\r\n\r\n    if (!player.active) return collisions;\r\n\r\n    for (const enemy of enemies) {\r\n      if (!enemy.active) continue;\r\n\r\n      const collision = checkEntityCollision(player, enemy);\r\n      if (collision.hasCollision) {\r\n        collisions.push(enemy);\r\n      }\r\n    }\r\n\r\n    return collisions;\r\n  }\r\n\r\n  /**\r\n   * 检测玩家子弹与敌人的碰撞\r\n   */\r\n  checkPlayerBulletEnemyCollisions(\r\n    bullets: BulletImpl[],\r\n    enemies: EnemyShipImpl[]\r\n  ): Array<{ bullet: BulletImpl; enemy: EnemyShipImpl }> {\r\n    const collisions: Array<{ bullet: BulletImpl; enemy: EnemyShipImpl }> = [];\r\n\r\n    const playerBullets = bullets.filter(b => b.active && b.owner === 'player');\r\n\r\n    for (const bullet of playerBullets) {\r\n      for (const enemy of enemies) {\r\n        if (!enemy.active) continue;\r\n\r\n        const collision = checkEntityCollision(bullet, enemy);\r\n        if (collision.hasCollision) {\r\n          collisions.push({ bullet, enemy });\r\n        }\r\n      }\r\n    }\r\n\r\n    return collisions;\r\n  }\r\n\r\n  /**\r\n   * 检测敌人子弹与玩家的碰撞\r\n   */\r\n  checkEnemyBulletPlayerCollisions(\r\n    bullets: BulletImpl[],\r\n    player: PlayerShipImpl\r\n  ): BulletImpl[] {\r\n    const collisions: BulletImpl[] = [];\r\n\r\n    if (!player.active) return collisions;\r\n\r\n    const enemyBullets = bullets.filter(b => b.active && b.owner === 'enemy');\r\n\r\n    for (const bullet of enemyBullets) {\r\n      const collision = checkEntityCollision(bullet, player);\r\n      if (collision.hasCollision) {\r\n        collisions.push(bullet);\r\n      }\r\n    }\r\n\r\n    return collisions;\r\n  }\r\n\r\n  /**\r\n   * 处理所有碰撞检测\r\n   */\r\n  checkAllCollisions(\r\n    player: PlayerShipImpl,\r\n    enemies: EnemyShipImpl[],\r\n    bullets: BulletImpl[]\r\n  ): {\r\n    playerEnemyCollisions: EnemyShipImpl[];\r\n    bulletEnemyCollisions: Array<{ bullet: BulletImpl; enemy: EnemyShipImpl }>;\r\n    bulletPlayerCollisions: BulletImpl[];\r\n  } {\r\n    return {\r\n      playerEnemyCollisions: this.checkPlayerEnemyCollisions(player, enemies),\r\n      bulletEnemyCollisions: this.checkPlayerBulletEnemyCollisions(bullets, enemies),\r\n      bulletPlayerCollisions: this.checkEnemyBulletPlayerCollisions(bullets, player),\r\n    };\r\n  }\r\n}","import { DEFAULT_GAME_CONFIG } from '@/utils/constants';\r\n\r\n/**\r\n * 生命系统\r\n */\r\nexport class LifeSystem {\r\n  private lives: number;\r\n  private maxLives: number;\r\n  private gameOver: boolean;\r\n\r\n  constructor() {\r\n    this.maxLives = DEFAULT_GAME_CONFIG.game.initialLives;\r\n    this.lives = this.maxLives;\r\n    this.gameOver = false;\r\n  }\r\n\r\n  /**\r\n   * 获取当前生命数\r\n   */\r\n  getLives(): number {\r\n    return this.lives;\r\n  }\r\n\r\n  /**\r\n   * 获取最大生命数\r\n   */\r\n  getMaxLives(): number {\r\n    return this.maxLives;\r\n  }\r\n\r\n  /**\r\n   * 失去一条生命\r\n   */\r\n  loseLife(): boolean {\r\n    if (this.gameOver) return false;\r\n\r\n    this.lives = Math.max(0, this.lives - 1);\r\n    \r\n    if (this.lives <= 0) {\r\n      this.gameOver = true;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * 增加生命\r\n   */\r\n  addLife(): void {\r\n    if (!this.gameOver) {\r\n      this.lives = Math.min(this.maxLives, this.lives + 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检查游戏是否结束\r\n   */\r\n  isGameOver(): boolean {\r\n    return this.gameOver;\r\n  }\r\n\r\n  /**\r\n   * 重置生命系统\r\n   */\r\n  reset(): void {\r\n    this.lives = this.maxLives;\r\n    this.gameOver = false;\r\n  }\r\n\r\n  /**\r\n   * 检查是否还有生命\r\n   */\r\n  hasLives(): boolean {\r\n    return this.lives > 0;\r\n  }\r\n}","import { SCORING } from '@/utils/constants';\r\n\r\n/**\r\n * 得分系统\r\n */\r\nexport class ScoreSystem {\r\n  private score: number;\r\n  private highScore: number;\r\n\r\n  constructor() {\r\n    this.score = 0;\r\n    this.highScore = this.loadHighScore();\r\n  }\r\n\r\n  /**\r\n   * 获取当前分数\r\n   */\r\n  getScore(): number {\r\n    return this.score;\r\n  }\r\n\r\n  /**\r\n   * 获取最高分数\r\n   */\r\n  getHighScore(): number {\r\n    return this.highScore;\r\n  }\r\n\r\n  /**\r\n   * 增加分数\r\n   */\r\n  addScore(points: number): void {\r\n    this.score += Math.max(0, points);\r\n    \r\n    if (this.score > this.highScore) {\r\n      this.highScore = this.score;\r\n      this.saveHighScore();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 击毁敌人获得分数\r\n   */\r\n  enemyDestroyed(): void {\r\n    this.addScore(SCORING.ENEMY_KILL);\r\n  }\r\n\r\n  /**\r\n   * 重置分数\r\n   */\r\n  reset(): void {\r\n    this.score = 0;\r\n  }\r\n\r\n  /**\r\n   * 从本地存储加载最高分\r\n   */\r\n  private loadHighScore(): number {\r\n    try {\r\n      const saved = localStorage.getItem('pixelShooterHighScore');\r\n      return saved ? parseInt(saved, 10) : 0;\r\n    } catch {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 保存最高分到本地存储\r\n   */\r\n  private saveHighScore(): void {\r\n    try {\r\n      localStorage.setItem('pixelShooterHighScore', this.highScore.toString());\r\n    } catch {\r\n      // 忽略存储错误\r\n    }\r\n  }\r\n}","import { DEFAULT_GAME_CONFIG } from '@/utils/constants';\r\n\r\n/**\r\n * 难度系统\r\n */\r\nexport class DifficultySystem {\r\n  private gameTime: number;\r\n  private currentLevel: number;\r\n  private baseSpawnRate: number;\r\n  private baseEnemySpeed: number;\r\n  private baseBulletSpeed: number;\r\n  private basePlayerSpeed: number;\r\n  \r\n  private currentSpawnRate: number;\r\n  private currentEnemySpeed: number;\r\n  private currentBulletSpeed: number;\r\n  private currentPlayerSpeed: number;\r\n  \r\n  private readonly config = DEFAULT_GAME_CONFIG.difficulty;\r\n\r\n  constructor() {\r\n    this.gameTime = 0;\r\n    this.currentLevel = 1;\r\n    \r\n    // 保存基础值\r\n    this.baseSpawnRate = DEFAULT_GAME_CONFIG.enemy.spawnRate;\r\n    this.baseEnemySpeed = DEFAULT_GAME_CONFIG.enemy.baseSpeed;\r\n    this.baseBulletSpeed = DEFAULT_GAME_CONFIG.bullet.speed;\r\n    this.basePlayerSpeed = DEFAULT_GAME_CONFIG.player.speed;\r\n    \r\n    // 初始化当前值\r\n    this.currentSpawnRate = this.baseSpawnRate;\r\n    this.currentEnemySpeed = this.baseEnemySpeed;\r\n    this.currentBulletSpeed = this.baseBulletSpeed;\r\n    this.currentPlayerSpeed = this.basePlayerSpeed;\r\n  }\r\n\r\n  /**\r\n   * 更新难度系统\r\n   */\r\n  update(deltaTime: number): void {\r\n    this.gameTime += deltaTime;\r\n    \r\n    // 计算当前等级\r\n    const newLevel = Math.floor(this.gameTime / this.config.timeInterval) + 1;\r\n    \r\n    if (newLevel > this.currentLevel) {\r\n      this.currentLevel = newLevel;\r\n      this.updateDifficulty();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新难度参数\r\n   */\r\n  private updateDifficulty(): void {\r\n    const levelMultiplier = this.currentLevel - 1;\r\n    \r\n    // 更新敌人生成率（减少间隔 = 增加频率）\r\n    this.currentSpawnRate = Math.max(\r\n      200, // 最小间隔200ms\r\n      this.baseSpawnRate * Math.pow(this.config.enemySpawnIncreaseRate, levelMultiplier)\r\n    );\r\n    \r\n    // 更新速度（但不超过最大值）\r\n    const speedMultiplier = Math.pow(this.config.speedIncreaseRate, levelMultiplier);\r\n    \r\n    this.currentEnemySpeed = Math.min(\r\n      this.config.maxSpeed,\r\n      this.baseEnemySpeed * speedMultiplier\r\n    );\r\n    \r\n    this.currentBulletSpeed = Math.min(\r\n      this.config.maxSpeed,\r\n      this.baseBulletSpeed * speedMultiplier\r\n    );\r\n    \r\n    this.currentPlayerSpeed = Math.min(\r\n      this.config.maxSpeed,\r\n      this.basePlayerSpeed * speedMultiplier\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 获取当前敌人生成率\r\n   */\r\n  getCurrentSpawnRate(): number {\r\n    return this.currentSpawnRate;\r\n  }\r\n\r\n  /**\r\n   * 获取当前敌人速度\r\n   */\r\n  getCurrentEnemySpeed(): number {\r\n    return this.currentEnemySpeed;\r\n  }\r\n\r\n  /**\r\n   * 获取当前子弹速度\r\n   */\r\n  getCurrentBulletSpeed(): number {\r\n    return this.currentBulletSpeed;\r\n  }\r\n\r\n  /**\r\n   * 获取当前玩家速度\r\n   */\r\n  getCurrentPlayerSpeed(): number {\r\n    return this.currentPlayerSpeed;\r\n  }\r\n\r\n  /**\r\n   * 获取当前等级\r\n   */\r\n  getCurrentLevel(): number {\r\n    return this.currentLevel;\r\n  }\r\n\r\n  /**\r\n   * 获取游戏时间\r\n   */\r\n  getGameTime(): number {\r\n    return this.gameTime;\r\n  }\r\n\r\n  /**\r\n   * 检查速度是否已达到最大值\r\n   */\r\n  isMaxSpeedReached(): boolean {\r\n    return (\r\n      this.currentEnemySpeed >= this.config.maxSpeed ||\r\n      this.currentBulletSpeed >= this.config.maxSpeed ||\r\n      this.currentPlayerSpeed >= this.config.maxSpeed\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 重置难度系统\r\n   */\r\n  reset(): void {\r\n    this.gameTime = 0;\r\n    this.currentLevel = 1;\r\n    this.currentSpawnRate = this.baseSpawnRate;\r\n    this.currentEnemySpeed = this.baseEnemySpeed;\r\n    this.currentBulletSpeed = this.baseBulletSpeed;\r\n    this.currentPlayerSpeed = this.basePlayerSpeed;\r\n  }\r\n\r\n  /**\r\n   * 获取难度信息\r\n   */\r\n  getDifficultyInfo(): {\r\n    level: number;\r\n    gameTime: number;\r\n    spawnRate: number;\r\n    enemySpeed: number;\r\n    bulletSpeed: number;\r\n    playerSpeed: number;\r\n    maxSpeedReached: boolean;\r\n  } {\r\n    return {\r\n      level: this.currentLevel,\r\n      gameTime: this.gameTime,\r\n      spawnRate: this.currentSpawnRate,\r\n      enemySpeed: this.currentEnemySpeed,\r\n      bulletSpeed: this.currentBulletSpeed,\r\n      playerSpeed: this.currentPlayerSpeed,\r\n      maxSpeedReached: this.isMaxSpeedReached(),\r\n    };\r\n  }\r\n}","import { Vector2D } from '@/types';\r\n\r\n/**\r\n * 创建新的2D向量\r\n */\r\nexport function createVector2D(x: number = 0, y: number = 0): Vector2D {\r\n  return { x, y };\r\n}\r\n\r\n/**\r\n * 向量加法\r\n */\r\nexport function addVectors(a: Vector2D, b: Vector2D): Vector2D {\r\n  return {\r\n    x: a.x + b.x,\r\n    y: a.y + b.y,\r\n  };\r\n}\r\n\r\n/**\r\n * 向量减法\r\n */\r\nexport function subtractVectors(a: Vector2D, b: Vector2D): Vector2D {\r\n  return {\r\n    x: a.x - b.x,\r\n    y: a.y - b.y,\r\n  };\r\n}\r\n\r\n/**\r\n * 向量标量乘法\r\n */\r\nexport function multiplyVector(vector: Vector2D, scalar: number): Vector2D {\r\n  return {\r\n    x: vector.x * scalar,\r\n    y: vector.y * scalar,\r\n  };\r\n}\r\n\r\n/**\r\n * 计算向量长度\r\n */\r\nexport function vectorLength(vector: Vector2D): number {\r\n  return Math.sqrt(vector.x * vector.x + vector.y * vector.y);\r\n}\r\n\r\n/**\r\n * 向量归一化\r\n */\r\nexport function normalizeVector(vector: Vector2D): Vector2D {\r\n  const length = vectorLength(vector);\r\n  if (length === 0) {\r\n    return { x: 0, y: 0 };\r\n  }\r\n  return {\r\n    x: vector.x / length,\r\n    y: vector.y / length,\r\n  };\r\n}\r\n\r\n/**\r\n * 计算两点之间的距离\r\n */\r\nexport function distance(a: Vector2D, b: Vector2D): number {\r\n  const dx = a.x - b.x;\r\n  const dy = a.y - b.y;\r\n  return Math.sqrt(dx * dx + dy * dy);\r\n}\r\n\r\n/**\r\n * 限制数值在指定范围内\r\n */\r\nexport function clamp(value: number, min: number, max: number): number {\r\n  return Math.min(Math.max(value, min), max);\r\n}\r\n\r\n/**\r\n * 线性插值\r\n */\r\nexport function lerp(start: number, end: number, t: number): number {\r\n  return start + (end - start) * t;\r\n}\r\n\r\n/**\r\n * 检查数值是否在范围内\r\n */\r\nexport function inRange(value: number, min: number, max: number): boolean {\r\n  return value >= min && value <= max;\r\n}\r\n\r\n/**\r\n * 将角度转换为弧度\r\n */\r\nexport function degreesToRadians(degrees: number): number {\r\n  return degrees * (Math.PI / 180);\r\n}\r\n\r\n/**\r\n * 将弧度转换为角度\r\n */\r\nexport function radiansToDegrees(radians: number): number {\r\n  return radians * (180 / Math.PI);\r\n}","/**\r\n * 像素艺术颜色系统\r\n */\r\n\r\n/**\r\n * 像素艺术调色板\r\n */\r\nexport const PIXEL_PALETTE = {\r\n  // 主要颜色\r\n  BLACK: '#000000',\r\n  WHITE: '#ffffff',\r\n  \r\n  // 玩家颜色 (绿色系)\r\n  PLAYER_PRIMARY: '#00ff41',\r\n  PLAYER_SECONDARY: '#00cc33',\r\n  PLAYER_DARK: '#008822',\r\n  \r\n  // 敌人颜色 (红色系)\r\n  ENEMY_PRIMARY: '#ff0041',\r\n  ENEMY_SECONDARY: '#cc0033',\r\n  ENEMY_DARK: '#880022',\r\n  \r\n  // 子弹颜色\r\n  BULLET_PLAYER: '#ffff41',\r\n  BULLET_ENEMY: '#ff8841',\r\n  \r\n  // UI颜色\r\n  UI_PRIMARY: '#41ffff',\r\n  UI_SECONDARY: '#33cccc',\r\n  UI_TEXT: '#ffffff',\r\n  UI_BACKGROUND: '#000011',\r\n  \r\n  // 背景颜色\r\n  SPACE_DARK: '#000011',\r\n  SPACE_MEDIUM: '#001122',\r\n  SPACE_LIGHT: '#002244',\r\n  \r\n  // 特效颜色\r\n  EXPLOSION_1: '#ffff41',\r\n  EXPLOSION_2: '#ff8841',\r\n  EXPLOSION_3: '#ff4141',\r\n} as const;\r\n\r\n/**\r\n * 颜色工具函数\r\n */\r\nexport class ColorUtils {\r\n  /**\r\n   * 将十六进制颜色转换为RGB\r\n   */\r\n  static hexToRgb(hex: string): { r: number; g: number; b: number } | null {\r\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n    return result ? {\r\n      r: parseInt(result[1], 16),\r\n      g: parseInt(result[2], 16),\r\n      b: parseInt(result[3], 16),\r\n    } : null;\r\n  }\r\n\r\n  /**\r\n   * 将RGB转换为十六进制颜色\r\n   */\r\n  static rgbToHex(r: number, g: number, b: number): string {\r\n    return '#' + [r, g, b].map(x => {\r\n      const hex = Math.round(x).toString(16);\r\n      return hex.length === 1 ? '0' + hex : hex;\r\n    }).join('');\r\n  }\r\n\r\n  /**\r\n   * 创建带透明度的颜色\r\n   */\r\n  static withAlpha(color: string, alpha: number): string {\r\n    const rgb = this.hexToRgb(color);\r\n    if (!rgb) return color;\r\n    \r\n    return `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${alpha})`;\r\n  }\r\n\r\n  /**\r\n   * 混合两种颜色\r\n   */\r\n  static blendColors(color1: string, color2: string, ratio: number): string {\r\n    const rgb1 = this.hexToRgb(color1);\r\n    const rgb2 = this.hexToRgb(color2);\r\n    \r\n    if (!rgb1 || !rgb2) return color1;\r\n    \r\n    const r = Math.round(rgb1.r * (1 - ratio) + rgb2.r * ratio);\r\n    const g = Math.round(rgb1.g * (1 - ratio) + rgb2.g * ratio);\r\n    const b = Math.round(rgb1.b * (1 - ratio) + rgb2.b * ratio);\r\n    \r\n    return this.rgbToHex(r, g, b);\r\n  }\r\n\r\n  /**\r\n   * 使颜色变亮\r\n   */\r\n  static lighten(color: string, amount: number): string {\r\n    return this.blendColors(color, PIXEL_PALETTE.WHITE, amount);\r\n  }\r\n\r\n  /**\r\n   * 使颜色变暗\r\n   */\r\n  static darken(color: string, amount: number): string {\r\n    return this.blendColors(color, PIXEL_PALETTE.BLACK, amount);\r\n  }\r\n\r\n  /**\r\n   * 获取随机像素艺术颜色\r\n   */\r\n  static getRandomPixelColor(): string {\r\n    const colors = Object.values(PIXEL_PALETTE);\r\n    return colors[Math.floor(Math.random() * colors.length)];\r\n  }\r\n}\r\n\r\n/**\r\n * 动画颜色效果\r\n */\r\nexport class AnimatedColor {\r\n  private colors: string[];\r\n  private currentIndex: number = 0;\r\n  private timer: number = 0;\r\n  private interval: number;\r\n\r\n  constructor(colors: string[], interval: number = 200) {\r\n    this.colors = colors;\r\n    this.interval = interval;\r\n  }\r\n\r\n  /**\r\n   * 更新动画\r\n   */\r\n  update(deltaTime: number): void {\r\n    this.timer += deltaTime;\r\n    if (this.timer >= this.interval) {\r\n      this.timer = 0;\r\n      this.currentIndex = (this.currentIndex + 1) % this.colors.length;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取当前颜色\r\n   */\r\n  getCurrentColor(): string {\r\n    return this.colors[this.currentIndex];\r\n  }\r\n\r\n  /**\r\n   * 重置动画\r\n   */\r\n  reset(): void {\r\n    this.currentIndex = 0;\r\n    this.timer = 0;\r\n  }\r\n}","/**\r\n * 资源管理器 - 处理图片和其他资源的加载\r\n */\r\nexport class AssetManager {\r\n  private images: Map<string, HTMLImageElement> = new Map();\r\n  private loadPromises: Map<string, Promise<HTMLImageElement>> = new Map();\r\n\r\n  /**\r\n   * 加载图片\r\n   */\r\n  async loadImage(name: string, src: string): Promise<HTMLImageElement> {\r\n    // 如果已经加载过，直接返回\r\n    if (this.images.has(name)) {\r\n      return this.images.get(name)!;\r\n    }\r\n\r\n    // 如果正在加载，返回现有的Promise\r\n    if (this.loadPromises.has(name)) {\r\n      return this.loadPromises.get(name)!;\r\n    }\r\n\r\n    // 创建新的加载Promise\r\n    const loadPromise = new Promise<HTMLImageElement>((resolve, reject) => {\r\n      const img = new Image();\r\n      \r\n      img.onload = () => {\r\n        this.images.set(name, img);\r\n        this.loadPromises.delete(name);\r\n        resolve(img);\r\n      };\r\n      \r\n      img.onerror = () => {\r\n        this.loadPromises.delete(name);\r\n        reject(new Error(`Failed to load image: ${src}`));\r\n      };\r\n      \r\n      img.src = src;\r\n    });\r\n\r\n    this.loadPromises.set(name, loadPromise);\r\n    return loadPromise;\r\n  }\r\n\r\n  /**\r\n   * 获取已加载的图片\r\n   */\r\n  getImage(name: string): HTMLImageElement | null {\r\n    return this.images.get(name) || null;\r\n  }\r\n\r\n  /**\r\n   * 检查图片是否已加载\r\n   */\r\n  hasImage(name: string): boolean {\r\n    return this.images.has(name);\r\n  }\r\n\r\n  /**\r\n   * 批量加载图片\r\n   */\r\n  async loadImages(imageMap: Record<string, string>): Promise<void> {\r\n    const loadPromises = Object.entries(imageMap).map(([name, src]) => \r\n      this.loadImage(name, src)\r\n    );\r\n    \r\n    await Promise.all(loadPromises);\r\n  }\r\n\r\n  /**\r\n   * 创建像素艺术风格的图片（如果没有提供图片文件）\r\n   */\r\n  createPixelArtImage(name: string, width: number, height: number, drawFunction: (ctx: CanvasRenderingContext2D) => void): HTMLImageElement {\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n    \r\n    const ctx = canvas.getContext('2d')!;\r\n    ctx.imageSmoothingEnabled = false;\r\n    \r\n    drawFunction(ctx);\r\n    \r\n    const img = new Image();\r\n    img.src = canvas.toDataURL();\r\n    this.images.set(name, img);\r\n    \r\n    return img;\r\n  }\r\n\r\n  /**\r\n   * 清空所有资源\r\n   */\r\n  clear(): void {\r\n    this.images.clear();\r\n    this.loadPromises.clear();\r\n  }\r\n}\r\n\r\n// 全局资源管理器实例\r\nexport const assetManager = new AssetManager();","import { assetManager } from './assetManager';\r\nimport { PIXEL_PALETTE } from './colorSystem';\r\n\r\n/**\r\n * 创建默认的像素艺术资源\r\n */\r\nexport class DefaultAssets {\r\n  /**\r\n   * 创建所有默认资源\r\n   */\r\n  static createAll(): void {\r\n    this.createPlayerShip();\r\n    this.createEnemyShips();\r\n    this.createPlayerBullet();\r\n    this.createEnemyBullets();\r\n    this.createPowerUps();\r\n    this.createBackground();\r\n    this.createStars();\r\n  }\r\n\r\n  /**\r\n   * 创建玩家飞船图片 - 基于用户提供的像素艺术设计\r\n   */\r\n  private static createPlayerShip(): void {\r\n    assetManager.createPixelArtImage('player', 64, 64, (ctx) => {\r\n      // 飞船主体轮廓 - 浅灰色\r\n      ctx.fillStyle = '#E8E8E8';\r\n      // 中央主体\r\n      ctx.fillRect(28, 8, 8, 32);\r\n      ctx.fillRect(26, 12, 12, 24);\r\n      ctx.fillRect(24, 16, 16, 16);\r\n      \r\n      // 飞船头部尖端\r\n      ctx.fillStyle = '#F8F8F8';\r\n      ctx.fillRect(30, 4, 4, 8);\r\n      ctx.fillRect(28, 6, 8, 6);\r\n      ctx.fillRect(26, 8, 12, 4);\r\n      \r\n      // 深灰色阴影和细节\r\n      ctx.fillStyle = '#A0A0A0';\r\n      ctx.fillRect(29, 10, 6, 2);\r\n      ctx.fillRect(27, 14, 10, 2);\r\n      ctx.fillRect(25, 18, 14, 2);\r\n      \r\n      // 红色装饰条纹和细节\r\n      ctx.fillStyle = '#FF3333';\r\n      // 侧面红色条纹\r\n      ctx.fillRect(20, 20, 6, 16);\r\n      ctx.fillRect(38, 20, 6, 16);\r\n      // 中央红色装饰\r\n      ctx.fillRect(29, 16, 6, 2);\r\n      ctx.fillRect(28, 22, 8, 2);\r\n      \r\n      // 蓝色引擎舱\r\n      ctx.fillStyle = '#3366FF';\r\n      ctx.fillRect(22, 32, 4, 8);\r\n      ctx.fillRect(38, 32, 4, 8);\r\n      ctx.fillRect(28, 34, 8, 6);\r\n      \r\n      // 深蓝色引擎细节\r\n      ctx.fillStyle = '#1144CC';\r\n      ctx.fillRect(23, 34, 2, 4);\r\n      ctx.fillRect(39, 34, 2, 4);\r\n      ctx.fillRect(30, 36, 4, 2);\r\n      \r\n      // 橙色引擎火焰\r\n      ctx.fillStyle = '#FF8800';\r\n      ctx.fillRect(23, 40, 2, 6);\r\n      ctx.fillRect(39, 40, 2, 6);\r\n      ctx.fillRect(29, 40, 6, 8);\r\n      \r\n      // 黄色火焰核心\r\n      ctx.fillStyle = '#FFDD00';\r\n      ctx.fillRect(24, 42, 1, 3);\r\n      ctx.fillRect(39, 42, 1, 3);\r\n      ctx.fillRect(30, 42, 4, 4);\r\n      \r\n      // 白色火焰中心\r\n      ctx.fillStyle = '#FFFFFF';\r\n      ctx.fillRect(31, 44, 2, 2);\r\n      \r\n      // 驾驶舱窗口\r\n      ctx.fillStyle = '#222222';\r\n      ctx.fillRect(30, 12, 4, 6);\r\n      \r\n      // 驾驶舱内部细节\r\n      ctx.fillStyle = '#444444';\r\n      ctx.fillRect(31, 14, 2, 2);\r\n      \r\n      // 侧翼武器\r\n      ctx.fillStyle = '#BBBBBB';\r\n      ctx.fillRect(18, 24, 4, 8);\r\n      ctx.fillRect(42, 24, 4, 8);\r\n      \r\n      // 武器细节\r\n      ctx.fillStyle = '#888888';\r\n      ctx.fillRect(19, 26, 2, 4);\r\n      ctx.fillRect(43, 26, 2, 4);\r\n      \r\n      // 黑色轮廓线（像素艺术风格）\r\n      ctx.fillStyle = '#000000';\r\n      // 外轮廓点\r\n      ctx.fillRect(29, 3, 6, 1);\r\n      ctx.fillRect(27, 4, 2, 1);\r\n      ctx.fillRect(35, 4, 2, 1);\r\n      \r\n      // 添加一些发光效果点\r\n      ctx.fillStyle = '#AAFFFF';\r\n      ctx.fillRect(26, 20, 1, 1);\r\n      ctx.fillRect(37, 20, 1, 1);\r\n      ctx.fillRect(32, 18, 1, 1);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 创建3种敌人飞船图片\r\n   */\r\n  private static createEnemyShips(): void {\r\n    // 基础敌人 - 红色\r\n    assetManager.createPixelArtImage('enemy-basic', 24, 24, (ctx) => {\r\n      // 飞船主体\r\n      ctx.fillStyle = PIXEL_PALETTE.ENEMY_PRIMARY;\r\n      ctx.fillRect(10, 4, 4, 16);\r\n      \r\n      // 飞船头部（朝下）\r\n      ctx.fillRect(8, 16, 8, 6);\r\n      ctx.fillStyle = PIXEL_PALETTE.ENEMY_SECONDARY;\r\n      ctx.fillRect(10, 20, 4, 4);\r\n      \r\n      // 飞船翅膀\r\n      ctx.fillStyle = PIXEL_PALETTE.ENEMY_DARK;\r\n      ctx.fillRect(4, 8, 6, 8);\r\n      ctx.fillRect(14, 8, 6, 8);\r\n      \r\n      // 武器\r\n      ctx.fillStyle = PIXEL_PALETTE.ENEMY_SECONDARY;\r\n      ctx.fillRect(6, 12, 2, 4);\r\n      ctx.fillRect(16, 12, 2, 4);\r\n      \r\n      // 核心\r\n      ctx.fillStyle = PIXEL_PALETTE.ENEMY_SECONDARY;\r\n      ctx.fillRect(11, 10, 2, 2);\r\n    });\r\n\r\n    // 斜射敌人 - 橙色\r\n    assetManager.createPixelArtImage('enemy-diagonal', 28, 28, (ctx) => {\r\n      // 飞船主体\r\n      ctx.fillStyle = '#FF6600';\r\n      ctx.fillRect(12, 4, 4, 18);\r\n      ctx.fillRect(10, 8, 8, 12);\r\n      \r\n      // 飞船头部（朝下）\r\n      ctx.fillStyle = '#FF8800';\r\n      ctx.fillRect(8, 18, 12, 6);\r\n      ctx.fillRect(11, 22, 6, 4);\r\n      \r\n      // 斜向武器\r\n      ctx.fillStyle = '#CC4400';\r\n      ctx.fillRect(4, 10, 6, 6);\r\n      ctx.fillRect(18, 10, 6, 6);\r\n      \r\n      // 斜向炮管\r\n      ctx.fillStyle = '#AA3300';\r\n      ctx.fillRect(2, 12, 4, 2);\r\n      ctx.fillRect(22, 12, 4, 2);\r\n      \r\n      // 核心\r\n      ctx.fillStyle = '#FFAA00';\r\n      ctx.fillRect(13, 12, 2, 2);\r\n    });\r\n\r\n    // 激光敌人 - 紫色\r\n    assetManager.createPixelArtImage('enemy-laser', 32, 32, (ctx) => {\r\n      // 飞船主体\r\n      ctx.fillStyle = '#8800FF';\r\n      ctx.fillRect(14, 4, 4, 20);\r\n      ctx.fillRect(12, 8, 8, 16);\r\n      \r\n      // 飞船头部（朝下）\r\n      ctx.fillStyle = '#AA44FF';\r\n      ctx.fillRect(10, 20, 12, 8);\r\n      ctx.fillRect(13, 26, 6, 4);\r\n      \r\n      // 大型激光炮\r\n      ctx.fillStyle = '#6600CC';\r\n      ctx.fillRect(8, 12, 16, 8);\r\n      ctx.fillStyle = '#4400AA';\r\n      ctx.fillRect(10, 14, 12, 4);\r\n      \r\n      // 激光充能核心\r\n      ctx.fillStyle = '#CCAAFF';\r\n      ctx.fillRect(14, 15, 4, 2);\r\n      \r\n      // 侧翼稳定器\r\n      ctx.fillStyle = '#5500BB';\r\n      ctx.fillRect(6, 16, 4, 4);\r\n      ctx.fillRect(22, 16, 4, 4);\r\n    });\r\n\r\n    // 精英敌人 - 金色\r\n    assetManager.createPixelArtImage('enemy-elite', 36, 36, (ctx) => {\r\n      // 飞船主体\r\n      ctx.fillStyle = '#FFD700';\r\n      ctx.fillRect(16, 4, 4, 24);\r\n      ctx.fillRect(14, 8, 8, 20);\r\n      \r\n      // 飞船头部（朝下）\r\n      ctx.fillStyle = '#FFA500';\r\n      ctx.fillRect(12, 24, 12, 8);\r\n      ctx.fillRect(15, 30, 6, 4);\r\n      \r\n      // 双重武器系统\r\n      ctx.fillStyle = '#B8860B';\r\n      ctx.fillRect(8, 12, 8, 8);\r\n      ctx.fillRect(20, 12, 8, 8);\r\n      \r\n      // 精英标识\r\n      ctx.fillStyle = '#FFFF00';\r\n      ctx.fillRect(17, 14, 2, 2);\r\n      ctx.fillRect(15, 16, 6, 2);\r\n      \r\n      // 护甲板\r\n      ctx.fillStyle = '#DAA520';\r\n      ctx.fillRect(6, 16, 4, 6);\r\n      ctx.fillRect(26, 16, 4, 6);\r\n      \r\n      // 能量核心\r\n      ctx.fillStyle = '#FFFFFF';\r\n      ctx.fillRect(17, 18, 2, 2);\r\n    });\r\n\r\n    // Boss敌人 - 深红色\r\n    assetManager.createPixelArtImage('enemy-boss', 48, 48, (ctx) => {\r\n      // Boss主体\r\n      ctx.fillStyle = '#8B0000';\r\n      ctx.fillRect(20, 4, 8, 32);\r\n      ctx.fillRect(16, 8, 16, 28);\r\n      \r\n      // Boss头部（朝下）\r\n      ctx.fillStyle = '#DC143C';\r\n      ctx.fillRect(14, 32, 20, 12);\r\n      ctx.fillRect(18, 42, 12, 4);\r\n      \r\n      // 多重武器系统\r\n      ctx.fillStyle = '#4B0000';\r\n      ctx.fillRect(8, 16, 8, 12);\r\n      ctx.fillRect(32, 16, 8, 12);\r\n      ctx.fillRect(12, 20, 24, 8);\r\n      \r\n      // Boss标识装甲\r\n      ctx.fillStyle = '#FF4500';\r\n      ctx.fillRect(4, 20, 6, 8);\r\n      ctx.fillRect(38, 20, 6, 8);\r\n      \r\n      // 能量反应堆\r\n      ctx.fillStyle = '#FF0000';\r\n      ctx.fillRect(22, 22, 4, 4);\r\n      \r\n      // 护盾发生器\r\n      ctx.fillStyle = '#00FFFF';\r\n      ctx.fillRect(21, 18, 2, 2);\r\n      ctx.fillRect(25, 18, 2, 2);\r\n      ctx.fillRect(21, 26, 2, 2);\r\n      ctx.fillRect(25, 26, 2, 2);\r\n      \r\n      // Boss眼部\r\n      ctx.fillStyle = '#FFFF00';\r\n      ctx.fillRect(23, 24, 2, 1);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 创建玩家子弹图片\r\n   */\r\n  private static createPlayerBullet(): void {\r\n    assetManager.createPixelArtImage('playerBullet', 4, 8, (ctx) => {\r\n      // 子弹主体\r\n      ctx.fillStyle = PIXEL_PALETTE.BULLET_PLAYER;\r\n      ctx.fillRect(1, 0, 2, 6);\r\n      \r\n      // 子弹尖端\r\n      ctx.fillStyle = PIXEL_PALETTE.PLAYER_SECONDARY;\r\n      ctx.fillRect(0, 0, 4, 2);\r\n      \r\n      // 尾迹\r\n      ctx.fillStyle = PIXEL_PALETTE.PLAYER_SECONDARY;\r\n      ctx.fillRect(1, 6, 2, 2);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 创建敌人子弹图片\r\n   */\r\n  private static createEnemyBullets(): void {\r\n    // 普通敌人子弹\r\n    assetManager.createPixelArtImage('enemyBullet', 4, 8, (ctx) => {\r\n      // 子弹主体\r\n      ctx.fillStyle = PIXEL_PALETTE.BULLET_ENEMY;\r\n      ctx.fillRect(1, 2, 2, 6);\r\n      \r\n      // 子弹尖端\r\n      ctx.fillStyle = PIXEL_PALETTE.ENEMY_SECONDARY;\r\n      ctx.fillRect(0, 6, 4, 2);\r\n      \r\n      // 尾迹\r\n      ctx.fillStyle = PIXEL_PALETTE.ENEMY_SECONDARY;\r\n      ctx.fillRect(1, 0, 2, 2);\r\n    });\r\n\r\n    // 激光束\r\n    assetManager.createPixelArtImage('enemyLaser', 6, 32, (ctx) => {\r\n      // 激光束主体\r\n      ctx.fillStyle = PIXEL_PALETTE.BULLET_ENEMY;\r\n      ctx.fillRect(1, 0, 4, 32);\r\n      \r\n      // 激光束核心\r\n      ctx.fillStyle = '#FFAA44';\r\n      ctx.fillRect(2, 0, 2, 32);\r\n      \r\n      // 激光束边缘发光\r\n      ctx.fillStyle = '#FF6600';\r\n      ctx.fillRect(0, 0, 1, 32);\r\n      ctx.fillRect(5, 0, 1, 32);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 创建道具图片\r\n   */\r\n  private static createPowerUps(): void {\r\n    // 导弹包道具\r\n    assetManager.createPixelArtImage('powerup-missile', 32, 32, (ctx) => {\r\n      // 道具背景\r\n      ctx.fillStyle = '#00AA00';\r\n      ctx.fillRect(0, 0, 32, 32);\r\n      \r\n      // 边框\r\n      ctx.fillStyle = '#00FF00';\r\n      ctx.fillRect(0, 0, 32, 2);\r\n      ctx.fillRect(0, 30, 32, 2);\r\n      ctx.fillRect(0, 0, 2, 32);\r\n      ctx.fillRect(30, 0, 2, 32);\r\n      \r\n      // 导弹图标\r\n      ctx.fillStyle = '#FFFF00';\r\n      ctx.fillRect(8, 6, 16, 4);\r\n      ctx.fillRect(12, 10, 8, 16);\r\n      \r\n      // 导弹尖端\r\n      ctx.fillStyle = '#FF4444';\r\n      ctx.fillRect(14, 4, 4, 4);\r\n      \r\n      // 导弹尾翼\r\n      ctx.fillStyle = '#CCCCCC';\r\n      ctx.fillRect(10, 24, 4, 4);\r\n      ctx.fillRect(18, 24, 4, 4);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 创建背景图片\r\n   */\r\n  private static createBackground(): void {\r\n    assetManager.createPixelArtImage('background', 800, 600, (ctx) => {\r\n      // 深空渐变背景\r\n      const gradient = ctx.createLinearGradient(0, 0, 0, 600);\r\n      gradient.addColorStop(0, PIXEL_PALETTE.SPACE_DARK);\r\n      gradient.addColorStop(0.5, PIXEL_PALETTE.SPACE_MEDIUM);\r\n      gradient.addColorStop(1, PIXEL_PALETTE.SPACE_LIGHT);\r\n      \r\n      ctx.fillStyle = gradient;\r\n      ctx.fillRect(0, 0, 800, 600);\r\n      \r\n      // 添加一些星星\r\n      ctx.fillStyle = PIXEL_PALETTE.WHITE;\r\n      for (let i = 0; i < 100; i++) {\r\n        const x = Math.random() * 800;\r\n        const y = Math.random() * 600;\r\n        const size = Math.random() < 0.7 ? 1 : 2;\r\n        ctx.fillRect(x, y, size, size);\r\n      }\r\n      \r\n      // 添加一些更亮的星星\r\n      ctx.fillStyle = PIXEL_PALETTE.UI_PRIMARY;\r\n      for (let i = 0; i < 20; i++) {\r\n        const x = Math.random() * 800;\r\n        const y = Math.random() * 600;\r\n        ctx.fillRect(x, y, 1, 1);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 创建动态星星背景\r\n   */\r\n  private static createStars(): void {\r\n    assetManager.createPixelArtImage('star', 2, 2, (ctx) => {\r\n      ctx.fillStyle = PIXEL_PALETTE.WHITE;\r\n      ctx.fillRect(0, 0, 2, 2);\r\n    });\r\n    \r\n    assetManager.createPixelArtImage('brightStar', 3, 3, (ctx) => {\r\n      ctx.fillStyle = PIXEL_PALETTE.UI_PRIMARY;\r\n      ctx.fillRect(1, 0, 1, 3);\r\n      ctx.fillRect(0, 1, 3, 1);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * 资源路径配置\r\n * 用户可以将自己的图片放在public/assets/目录下\r\n */\r\nexport const ASSET_PATHS = {\r\n  player: '/assets/player.png',\r\n  'enemy-basic': '/assets/enemy-basic.png',\r\n  'enemy-diagonal': '/assets/enemy-diagonal.png',\r\n  'enemy-laser': '/assets/enemy-laser.png',\r\n  'enemy-elite': '/assets/enemy-elite.png',\r\n  'enemy-boss': '/assets/enemy-boss.png',\r\n  playerBullet: '/assets/player-bullet.png',\r\n  enemyBullet: '/assets/enemy-bullet.png',\r\n  enemyLaser: '/assets/enemy-laser-bullet.png',\r\n  'powerup-missile': '/assets/powerup-missile.png',\r\n  background: '/assets/background.png',\r\n  star: '/assets/star.png',\r\n  brightStar: '/assets/bright-star.png',\r\n};\r\n\r\n/**\r\n * 尝试加载用户提供的图片，如果失败则使用默认像素艺术\r\n */\r\nexport async function loadGameAssets(): Promise<void> {\r\n  console.log('正在加载游戏资源...');\r\n  \r\n  // 首先创建默认资源\r\n  DefaultAssets.createAll();\r\n  \r\n  // 尝试加载用户提供的图片\r\n  const loadPromises = Object.entries(ASSET_PATHS).map(async ([name, path]) => {\r\n    try {\r\n      await assetManager.loadImage(`custom_${name}`, path);\r\n      console.log(`✓ 加载自定义图片: ${name} 从 ${path}`);\r\n    } catch (error) {\r\n      console.log(`❌ 加载失败: ${name} 从 ${path}, 错误:`, error);\r\n      console.log(`使用默认像素艺术: ${name}`);\r\n    }\r\n  });\r\n  \r\n  await Promise.allSettled(loadPromises);\r\n  console.log('游戏资源加载完成!');\r\n}\r\n\r\n/**\r\n * 获取资源（优先使用自定义图片，否则使用默认图片）\r\n */\r\nexport function getAsset(name: string): HTMLImageElement | null {\r\n  const customAsset = assetManager.getImage(`custom_${name}`);\r\n  const defaultAsset = assetManager.getImage(name);\r\n  \r\n  // 调试信息\r\n  if (!customAsset && !defaultAsset) {\r\n    console.log(`资源未找到: ${name}, 尝试了 custom_${name} 和 ${name}`);\r\n  }\r\n  \r\n  return customAsset || defaultAsset;\r\n}","import { PlayerShip, Bullet, Renderer, Vector2D, BulletType } from '@/types';\r\nimport { createVector2D, clamp } from '@/utils/math';\r\nimport { clampEntityToBounds } from '@/utils/collision';\r\nimport { PIXEL_PALETTE } from '@/systems/colorSystem';\r\nimport { DEFAULT_GAME_CONFIG, MISSILE_CONFIG, POWERUP_TYPES } from '@/utils/constants';\r\nimport { getAsset } from '@/systems/defaultAssets';\r\n\r\n/**\r\n * 玩家飞船实现\r\n */\r\nexport class PlayerShipImpl implements PlayerShip {\r\n  position: Vector2D;\r\n  velocity: Vector2D;\r\n  size: Vector2D;\r\n  active: boolean;\r\n  speed: number;\r\n  shootCooldown: number;\r\n  lastShotTime: number;\r\n  \r\n  private canvasWidth: number;\r\n  private canvasHeight: number;\r\n  private startPosition: Vector2D;\r\n  \r\n  // 导弹系统\r\n  private hasMissiles: boolean = false;\r\n  private missileEndTime: number = 0;\r\n  private lastMissileTime: number = 0;\r\n\r\n  constructor(canvasWidth: number, canvasHeight: number) {\r\n    this.canvasWidth = canvasWidth;\r\n    this.canvasHeight = canvasHeight;\r\n    \r\n    // 从配置中获取初始值\r\n    const config = DEFAULT_GAME_CONFIG.player;\r\n    this.size = { ...config.size };\r\n    this.speed = config.speed;\r\n    this.shootCooldown = config.shootCooldown;\r\n    \r\n    // 计算起始位置（屏幕底部中央）\r\n    this.startPosition = {\r\n      x: (canvasWidth - this.size.x) / 2,\r\n      y: canvasHeight - this.size.y - 20,\r\n    };\r\n    \r\n    this.position = { ...this.startPosition };\r\n    this.velocity = createVector2D(0, 0);\r\n    this.active = true;\r\n    this.lastShotTime = 0;\r\n  }\r\n\r\n  /**\r\n   * 更新玩家飞船状态\r\n   */\r\n  update(deltaTime: number): void {\r\n    if (!this.active) return;\r\n\r\n    // 更新位置\r\n    this.position.x += this.velocity.x * (deltaTime / 1000);\r\n    this.position.y += this.velocity.y * (deltaTime / 1000);\r\n\r\n    // 限制在边界内\r\n    clampEntityToBounds(this, this.canvasWidth, this.canvasHeight);\r\n\r\n    // 更新射击冷却时间\r\n    this.lastShotTime += deltaTime;\r\n    \r\n    // 更新导弹状态\r\n    this.updateMissiles();\r\n  }\r\n\r\n  /**\r\n   * 渲染玩家飞船\r\n   */\r\n  render(renderer: Renderer): void {\r\n    if (!this.active) return;\r\n\r\n    const playerImage = getAsset('player');\r\n    \r\n    if (playerImage) {\r\n      // 使用图片渲染\r\n      renderer.drawImage(\r\n        playerImage,\r\n        this.position.x,\r\n        this.position.y,\r\n        this.size.x,\r\n        this.size.y\r\n      );\r\n    } else {\r\n      // 降级到矩形渲染\r\n      renderer.drawRect(\r\n        this.position.x,\r\n        this.position.y,\r\n        this.size.x,\r\n        this.size.y,\r\n        PIXEL_PALETTE.PLAYER_PRIMARY\r\n      );\r\n\r\n      // 绘制飞船细节\r\n      const centerX = this.position.x + this.size.x / 2;\r\n      const topY = this.position.y;\r\n      \r\n      // 飞船顶部\r\n      renderer.drawRect(\r\n        centerX - 2,\r\n        topY - 4,\r\n        4,\r\n        4,\r\n        PIXEL_PALETTE.PLAYER_SECONDARY\r\n      );\r\n\r\n      // 飞船侧翼\r\n      renderer.drawRect(\r\n        this.position.x - 2,\r\n        this.position.y + this.size.y - 8,\r\n        4,\r\n        8,\r\n        PIXEL_PALETTE.PLAYER_DARK\r\n      );\r\n      \r\n      renderer.drawRect(\r\n        this.position.x + this.size.x - 2,\r\n        this.position.y + this.size.y - 8,\r\n        4,\r\n        8,\r\n        PIXEL_PALETTE.PLAYER_DARK\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 设置移动速度\r\n   */\r\n  setVelocity(vx: number, vy: number): void {\r\n    this.velocity.x = clamp(vx, -this.speed, this.speed);\r\n    this.velocity.y = clamp(vy, -this.speed, this.speed);\r\n  }\r\n\r\n  /**\r\n   * 根据输入更新移动\r\n   */\r\n  updateMovement(movementVector: Vector2D, _deltaTime: number): void {\r\n    const normalizedSpeed = this.speed;\r\n    \r\n    this.velocity.x = movementVector.x * normalizedSpeed;\r\n    this.velocity.y = movementVector.y * normalizedSpeed;\r\n  }\r\n\r\n  /**\r\n   * 检查是否可以射击\r\n   */\r\n  canShoot(): boolean {\r\n    return this.active && this.lastShotTime >= this.shootCooldown;\r\n  }\r\n\r\n  /**\r\n   * 发射子弹\r\n   */\r\n  shoot(): Bullet | null {\r\n    if (!this.canShoot()) return null;\r\n\r\n    this.lastShotTime = 0;\r\n\r\n    // 创建子弹（这里返回子弹数据，实际创建由子弹系统处理）\r\n    const bulletData = {\r\n      position: {\r\n        x: this.position.x + this.size.x / 2 - 2,\r\n        y: this.position.y - 8,\r\n      },\r\n      velocity: createVector2D(0, -DEFAULT_GAME_CONFIG.bullet.speed),\r\n      size: { ...DEFAULT_GAME_CONFIG.bullet.size },\r\n      owner: 'player' as const,\r\n      damage: 1,\r\n      bulletType: BulletType.NORMAL,\r\n      active: true,\r\n      update: () => {},\r\n      render: () => {},\r\n    };\r\n\r\n    return bulletData;\r\n  }\r\n\r\n  /**\r\n   * 受到伤害\r\n   */\r\n  takeDamage(): void {\r\n    // 玩家飞船被击中的逻辑将由生命系统处理\r\n    // 这里可以添加受伤效果\r\n  }\r\n\r\n  /**\r\n   * 重生\r\n   */\r\n  respawn(): void {\r\n    this.position = { ...this.startPosition };\r\n    this.velocity = createVector2D(0, 0);\r\n    this.active = true;\r\n    this.lastShotTime = 0;\r\n  }\r\n\r\n  /**\r\n   * 获取中心位置\r\n   */\r\n  getCenterPosition(): Vector2D {\r\n    return {\r\n      x: this.position.x + this.size.x / 2,\r\n      y: this.position.y + this.size.y / 2,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 设置位置\r\n   */\r\n  setPosition(x: number, y: number): void {\r\n    this.position.x = x;\r\n    this.position.y = y;\r\n    clampEntityToBounds(this, this.canvasWidth, this.canvasHeight);\r\n  }\r\n\r\n  /**\r\n   * 检查是否在边界内\r\n   */\r\n  isInBounds(): boolean {\r\n    return (\r\n      this.position.x >= 0 &&\r\n      this.position.y >= 0 &&\r\n      this.position.x + this.size.x <= this.canvasWidth &&\r\n      this.position.y + this.size.y <= this.canvasHeight\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 销毁飞船\r\n   */\r\n  destroy(): void {\r\n    this.active = false;\r\n  }\r\n\r\n  /**\r\n   * 获得导弹能力\r\n   */\r\n  gainMissiles(): void {\r\n    this.hasMissiles = true;\r\n    this.missileEndTime = Date.now() + POWERUP_TYPES.MISSILE.duration;\r\n  }\r\n\r\n  /**\r\n   * 检查是否可以发射导弹\r\n   */\r\n  canShootMissile(): boolean {\r\n    const currentTime = Date.now();\r\n    return (\r\n      this.active &&\r\n      this.hasMissiles &&\r\n      currentTime < this.missileEndTime &&\r\n      currentTime - this.lastMissileTime >= MISSILE_CONFIG.cooldown\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 发射导弹\r\n   */\r\n  shootMissile(): Bullet[] | null {\r\n    if (!this.canShootMissile()) return null;\r\n\r\n    this.lastMissileTime = Date.now();\r\n\r\n    const missiles: Bullet[] = [];\r\n    const centerX = this.position.x + this.size.x / 2;\r\n    const centerY = this.position.y;\r\n\r\n    // 计算45度角的速度分量\r\n    const angle = Math.PI / 4; // 45度\r\n    const speedComponent = MISSILE_CONFIG.speed * Math.cos(angle); // 45度时sin和cos相等\r\n    const speedX = speedComponent; // 水平分量\r\n    const speedY = speedComponent; // 垂直分量\r\n\r\n    // 左斜导弹（向左上45度）\r\n    const leftMissile = {\r\n      position: {\r\n        x: centerX - MISSILE_CONFIG.size.x / 2 - 10,\r\n        y: centerY - 8,\r\n      },\r\n      velocity: createVector2D(-speedX, -speedY), // 左上45度\r\n      size: { ...MISSILE_CONFIG.size },\r\n      owner: 'player' as const,\r\n      damage: 1,\r\n      bulletType: BulletType.NORMAL,\r\n      active: true,\r\n      update: () => {},\r\n      render: () => {},\r\n    };\r\n\r\n    // 右斜导弹（向右上45度）\r\n    const rightMissile = {\r\n      position: {\r\n        x: centerX - MISSILE_CONFIG.size.x / 2 + 10,\r\n        y: centerY - 8,\r\n      },\r\n      velocity: createVector2D(speedX, -speedY), // 右上45度\r\n      size: { ...MISSILE_CONFIG.size },\r\n      owner: 'player' as const,\r\n      damage: 1,\r\n      bulletType: BulletType.NORMAL,\r\n      active: true,\r\n      update: () => {},\r\n      render: () => {},\r\n    };\r\n\r\n    missiles.push(leftMissile, rightMissile);\r\n    return missiles;\r\n  }\r\n\r\n  /**\r\n   * 更新导弹状态\r\n   */\r\n  updateMissiles(): void {\r\n    const currentTime = Date.now();\r\n    if (this.hasMissiles && currentTime >= this.missileEndTime) {\r\n      this.hasMissiles = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检查是否拥有导弹\r\n   */\r\n  hasMissileAbility(): boolean {\r\n    return this.hasMissiles && Date.now() < this.missileEndTime;\r\n  }\r\n\r\n  /**\r\n   * 获取导弹剩余时间（秒）\r\n   */\r\n  getMissileTimeLeft(): number {\r\n    if (!this.hasMissiles) return 0;\r\n    const timeLeft = Math.max(0, this.missileEndTime - Date.now());\r\n    return Math.ceil(timeLeft / 1000);\r\n  }\r\n}","import { Bullet, Renderer, Vector2D, BulletType } from '@/types';\r\nimport { createVector2D } from '@/utils/math';\r\nimport { PIXEL_PALETTE } from '@/systems/colorSystem';\r\nimport { DEFAULT_GAME_CONFIG, BULLET_TYPES } from '@/utils/constants';\r\nimport { getAsset } from '@/systems/defaultAssets';\r\n\r\n/**\r\n * 子弹实现\r\n */\r\nexport class BulletImpl implements Bullet {\r\n  position: Vector2D;\r\n  velocity: Vector2D;\r\n  size: Vector2D;\r\n  active: boolean;\r\n  owner: 'player' | 'enemy';\r\n  damage: number;\r\n  bulletType: BulletType;\r\n\r\n  private canvasWidth: number;\r\n  private canvasHeight: number;\r\n\r\n  constructor(\r\n    position: Vector2D,\r\n    velocity: Vector2D,\r\n    owner: 'player' | 'enemy',\r\n    canvasWidth: number,\r\n    canvasHeight: number,\r\n    damage: number = 1,\r\n    bulletType: BulletType = BulletType.NORMAL\r\n  ) {\r\n    this.position = { ...position };\r\n    this.velocity = { ...velocity };\r\n    this.owner = owner;\r\n    this.damage = damage;\r\n    this.bulletType = bulletType;\r\n    this.active = true;\r\n    this.canvasWidth = canvasWidth;\r\n    this.canvasHeight = canvasHeight;\r\n    \r\n    // 根据子弹类型设置尺寸\r\n    if (bulletType === BulletType.LASER) {\r\n      this.size = { ...BULLET_TYPES.LASER.size };\r\n    } else {\r\n      this.size = { ...BULLET_TYPES.NORMAL.size };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新子弹状态\r\n   */\r\n  update(deltaTime: number): void {\r\n    if (!this.active) return;\r\n\r\n    // 更新位置\r\n    this.position.x += this.velocity.x * (deltaTime / 1000);\r\n    this.position.y += this.velocity.y * (deltaTime / 1000);\r\n\r\n    // 检查是否超出边界\r\n    this.checkBounds();\r\n  }\r\n\r\n  /**\r\n   * 渲染子弹\r\n   */\r\n  render(renderer: Renderer): void {\r\n    if (!this.active) return;\r\n\r\n    let bulletImageName: string;\r\n    if (this.owner === 'player') {\r\n      bulletImageName = 'playerBullet';\r\n    } else {\r\n      bulletImageName = this.bulletType === BulletType.LASER ? 'enemyLaser' : 'enemyBullet';\r\n    }\r\n    \r\n    const bulletImage = getAsset(bulletImageName);\r\n    \r\n    if (bulletImage) {\r\n      // 使用图片渲染\r\n      renderer.drawImage(\r\n        bulletImage,\r\n        this.position.x,\r\n        this.position.y,\r\n        this.size.x,\r\n        this.size.y\r\n      );\r\n    } else {\r\n      // 降级到矩形渲染\r\n      if (this.bulletType === BulletType.LASER) {\r\n        // 激光束渲染\r\n        renderer.drawRect(\r\n          this.position.x,\r\n          this.position.y,\r\n          this.size.x,\r\n          this.size.y,\r\n          PIXEL_PALETTE.BULLET_ENEMY\r\n        );\r\n        \r\n        // 激光束核心\r\n        renderer.drawRect(\r\n          this.position.x + 1,\r\n          this.position.y,\r\n          this.size.x - 2,\r\n          this.size.y,\r\n          '#FFAA44'\r\n        );\r\n      } else {\r\n        // 普通子弹渲染\r\n        const color = this.owner === 'player' \r\n          ? PIXEL_PALETTE.BULLET_PLAYER \r\n          : PIXEL_PALETTE.BULLET_ENEMY;\r\n\r\n        // 绘制子弹主体\r\n        renderer.drawRect(\r\n          this.position.x,\r\n          this.position.y,\r\n          this.size.x,\r\n          this.size.y,\r\n          color\r\n        );\r\n\r\n        // 添加子弹尾迹效果\r\n        if (this.owner === 'player') {\r\n          // 玩家子弹向上，在底部添加尾迹\r\n          renderer.drawRect(\r\n            this.position.x + 1,\r\n            this.position.y + this.size.y,\r\n            this.size.x - 2,\r\n            2,\r\n            PIXEL_PALETTE.PLAYER_SECONDARY\r\n          );\r\n        } else {\r\n          // 敌人子弹向下，在顶部添加尾迹\r\n          renderer.drawRect(\r\n            this.position.x + 1,\r\n            this.position.y - 2,\r\n            this.size.x - 2,\r\n            2,\r\n            PIXEL_PALETTE.ENEMY_SECONDARY\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检查边界并在超出时销毁子弹\r\n   */\r\n  private checkBounds(): void {\r\n    if (\r\n      this.position.x + this.size.x < 0 ||\r\n      this.position.x > this.canvasWidth ||\r\n      this.position.y + this.size.y < 0 ||\r\n      this.position.y > this.canvasHeight\r\n    ) {\r\n      this.destroy();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取中心位置\r\n   */\r\n  getCenterPosition(): Vector2D {\r\n    return {\r\n      x: this.position.x + this.size.x / 2,\r\n      y: this.position.y + this.size.y / 2,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 检查是否在屏幕内\r\n   */\r\n  isInBounds(): boolean {\r\n    return (\r\n      this.position.x + this.size.x >= 0 &&\r\n      this.position.x <= this.canvasWidth &&\r\n      this.position.y + this.size.y >= 0 &&\r\n      this.position.y <= this.canvasHeight\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 销毁子弹\r\n   */\r\n  destroy(): void {\r\n    this.active = false;\r\n  }\r\n\r\n  /**\r\n   * 设置速度\r\n   */\r\n  setVelocity(vx: number, vy: number): void {\r\n    this.velocity.x = vx;\r\n    this.velocity.y = vy;\r\n  }\r\n\r\n  /**\r\n   * 获取边界框\r\n   */\r\n  getBounds(): { x: number; y: number; width: number; height: number } {\r\n    return {\r\n      x: this.position.x,\r\n      y: this.position.y,\r\n      width: this.size.x,\r\n      height: this.size.y,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * 子弹工厂类\r\n */\r\nexport class BulletFactory {\r\n  private canvasWidth: number;\r\n  private canvasHeight: number;\r\n\r\n  constructor(canvasWidth: number, canvasHeight: number) {\r\n    this.canvasWidth = canvasWidth;\r\n    this.canvasHeight = canvasHeight;\r\n  }\r\n\r\n  /**\r\n   * 创建玩家子弹\r\n   */\r\n  createPlayerBullet(position: Vector2D): BulletImpl {\r\n    const velocity = createVector2D(0, -DEFAULT_GAME_CONFIG.bullet.speed);\r\n    return new BulletImpl(\r\n      position,\r\n      velocity,\r\n      'player',\r\n      this.canvasWidth,\r\n      this.canvasHeight,\r\n      1\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建玩家导弹（支持自定义速度）\r\n   */\r\n  createPlayerMissile(position: Vector2D, velocity: Vector2D): BulletImpl {\r\n    return new BulletImpl(\r\n      position,\r\n      velocity,\r\n      'player',\r\n      this.canvasWidth,\r\n      this.canvasHeight,\r\n      1\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建敌人子弹\r\n   */\r\n  createEnemyBullet(position: Vector2D, velocity: Vector2D, bulletType: BulletType = BulletType.NORMAL): BulletImpl {\r\n    return new BulletImpl(\r\n      position,\r\n      velocity,\r\n      'enemy',\r\n      this.canvasWidth,\r\n      this.canvasHeight,\r\n      1,\r\n      bulletType\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 创建自定义子弹\r\n   */\r\n  createCustomBullet(\r\n    position: Vector2D,\r\n    velocity: Vector2D,\r\n    owner: 'player' | 'enemy',\r\n    damage: number = 1\r\n  ): BulletImpl {\r\n    return new BulletImpl(\r\n      position,\r\n      velocity,\r\n      owner,\r\n      this.canvasWidth,\r\n      this.canvasHeight,\r\n      damage\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * 子弹管理器\r\n */\r\nexport class BulletManager {\r\n  private bullets: BulletImpl[] = [];\r\n  private factory: BulletFactory;\r\n  private maxBullets: number;\r\n\r\n  constructor(canvasWidth: number, canvasHeight: number, maxBullets: number = 100) {\r\n    this.factory = new BulletFactory(canvasWidth, canvasHeight);\r\n    this.maxBullets = maxBullets;\r\n  }\r\n\r\n  /**\r\n   * 添加子弹\r\n   */\r\n  addBullet(bullet: BulletImpl): void {\r\n    if (this.bullets.length >= this.maxBullets) {\r\n      // 移除最老的子弹\r\n      this.bullets.shift();\r\n    }\r\n    this.bullets.push(bullet);\r\n  }\r\n\r\n  /**\r\n   * 创建并添加玩家子弹\r\n   */\r\n  createPlayerBullet(position: Vector2D): BulletImpl {\r\n    const bullet = this.factory.createPlayerBullet(position);\r\n    this.addBullet(bullet);\r\n    return bullet;\r\n  }\r\n\r\n  /**\r\n   * 创建并添加玩家导弹\r\n   */\r\n  createPlayerMissile(position: Vector2D, velocity: Vector2D): BulletImpl {\r\n    const bullet = this.factory.createPlayerMissile(position, velocity);\r\n    this.addBullet(bullet);\r\n    return bullet;\r\n  }\r\n\r\n  /**\r\n   * 创建并添加敌人子弹\r\n   */\r\n  createEnemyBullet(position: Vector2D, velocity: Vector2D, bulletType: BulletType = BulletType.NORMAL): BulletImpl {\r\n    const bullet = this.factory.createEnemyBullet(position, velocity, bulletType);\r\n    this.addBullet(bullet);\r\n    return bullet;\r\n  }\r\n\r\n  /**\r\n   * 更新所有子弹\r\n   */\r\n  update(deltaTime: number): void {\r\n    for (const bullet of this.bullets) {\r\n      bullet.update(deltaTime);\r\n    }\r\n\r\n    // 移除非活跃的子弹\r\n    this.bullets = this.bullets.filter(bullet => bullet.active);\r\n  }\r\n\r\n  /**\r\n   * 渲染所有子弹\r\n   */\r\n  render(renderer: Renderer): void {\r\n    for (const bullet of this.bullets) {\r\n      bullet.render(renderer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取所有活跃的子弹\r\n   */\r\n  getActiveBullets(): BulletImpl[] {\r\n    return this.bullets.filter(bullet => bullet.active);\r\n  }\r\n\r\n  /**\r\n   * 获取玩家子弹\r\n   */\r\n  getPlayerBullets(): BulletImpl[] {\r\n    return this.bullets.filter(bullet => bullet.active && bullet.owner === 'player');\r\n  }\r\n\r\n  /**\r\n   * 获取敌人子弹\r\n   */\r\n  getEnemyBullets(): BulletImpl[] {\r\n    return this.bullets.filter(bullet => bullet.active && bullet.owner === 'enemy');\r\n  }\r\n\r\n  /**\r\n   * 清空所有子弹\r\n   */\r\n  clear(): void {\r\n    this.bullets = [];\r\n  }\r\n\r\n  /**\r\n   * 获取子弹数量\r\n   */\r\n  getCount(): number {\r\n    return this.bullets.length;\r\n  }\r\n\r\n  /**\r\n   * 获取活跃子弹数量\r\n   */\r\n  getActiveCount(): number {\r\n    return this.bullets.filter(bullet => bullet.active).length;\r\n  }\r\n}","import { EnemyShip, Bullet, Renderer, Vector2D, EnemyType, BulletType } from '@/types';\r\nimport { createVector2D } from '@/utils/math';\r\nimport { PIXEL_PALETTE } from '@/systems/colorSystem';\r\nimport { DEFAULT_GAME_CONFIG, ENEMY_TYPES, BULLET_TYPES } from '@/utils/constants';\r\nimport { getAsset } from '@/systems/defaultAssets';\r\n\r\n/**\r\n * 敌人飞船实现\r\n */\r\nexport class EnemyShipImpl implements EnemyShip {\r\n  position: Vector2D;\r\n  velocity: Vector2D;\r\n  size: Vector2D;\r\n  active: boolean;\r\n  speed: number;\r\n  shootTimer: number;\r\n  shootInterval: number;\r\n  enemyType: EnemyType;\r\n  health: number;\r\n  maxHealth: number;\r\n\r\n  private canvasWidth: number;\r\n  private canvasHeight: number;\r\n  private movementTimer: number = 0; // 用于Boss的移动模式\r\n\r\n  constructor(\r\n    position: Vector2D,\r\n    canvasWidth: number,\r\n    canvasHeight: number,\r\n    enemyType: EnemyType = EnemyType.BASIC,\r\n    speed?: number\r\n  ) {\r\n    this.position = { ...position };\r\n    this.canvasWidth = canvasWidth;\r\n    this.canvasHeight = canvasHeight;\r\n    this.enemyType = enemyType;\r\n    \r\n    // 根据敌人类型获取配置\r\n    const typeConfig = Object.values(ENEMY_TYPES).find(t => t.id === enemyType) || ENEMY_TYPES.BASIC;\r\n    this.size = { ...typeConfig.size };\r\n    this.speed = (speed || DEFAULT_GAME_CONFIG.enemy.baseSpeed) * typeConfig.speedMultiplier;\r\n    this.shootInterval = typeConfig.shootInterval;\r\n    this.health = typeConfig.health;\r\n    this.maxHealth = typeConfig.health;\r\n    \r\n    // 设置移动速度\r\n    if (enemyType === EnemyType.BOSS) {\r\n      // Boss随机选择初始移动方向\r\n      const horizontal = (Math.random() - 0.5) * this.speed * 0.5; // 横向移动较慢\r\n      this.velocity = createVector2D(horizontal, this.speed);\r\n    } else {\r\n      // 其他敌人向下移动\r\n      this.velocity = createVector2D(0, this.speed);\r\n    }\r\n    \r\n    this.active = true;\r\n    this.shootTimer = Math.random() * this.shootInterval; // 随机初始射击时间\r\n  }\r\n\r\n  /**\r\n   * 更新敌人飞船状态\r\n   */\r\n  update(deltaTime: number): void {\r\n    if (!this.active) return;\r\n\r\n    // Boss特殊移动逻辑\r\n    if (this.enemyType === EnemyType.BOSS) {\r\n      this.updateBossMovement(deltaTime);\r\n    }\r\n\r\n    // 更新位置\r\n    this.position.x += this.velocity.x * (deltaTime / 1000);\r\n    this.position.y += this.velocity.y * (deltaTime / 1000);\r\n\r\n    // 更新射击计时器\r\n    this.shootTimer += deltaTime;\r\n\r\n    // 检查是否超出边界\r\n    this.checkBounds();\r\n  }\r\n\r\n  /**\r\n   * Boss特殊移动逻辑\r\n   */\r\n  private updateBossMovement(deltaTime: number): void {\r\n    this.movementTimer += deltaTime;\r\n    \r\n    // 每3秒改变一次移动方向\r\n    if (this.movementTimer >= 3000) {\r\n      this.movementTimer = 0;\r\n      \r\n      // 随机选择移动模式：纯向下、左下、右下\r\n      const movePattern = Math.random();\r\n      if (movePattern < 0.4) {\r\n        // 纯向下\r\n        this.velocity.x = 0;\r\n      } else if (movePattern < 0.7) {\r\n        // 左下移动\r\n        this.velocity.x = -this.speed * 0.3;\r\n      } else {\r\n        // 右下移动\r\n        this.velocity.x = this.speed * 0.3;\r\n      }\r\n    }\r\n    \r\n    // 边界检查，防止Boss移出屏幕\r\n    if (this.position.x <= 0 && this.velocity.x < 0) {\r\n      this.velocity.x = Math.abs(this.velocity.x);\r\n    } else if (this.position.x + this.size.x >= this.canvasWidth && this.velocity.x > 0) {\r\n      this.velocity.x = -Math.abs(this.velocity.x);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 渲染敌人飞船\r\n   */\r\n  render(renderer: Renderer): void {\r\n    if (!this.active) return;\r\n\r\n    const assetName = `enemy-${this.enemyType}`;\r\n    const enemyImage = getAsset(assetName);\r\n    \r\n    // 调试信息\r\n    if (!enemyImage) {\r\n      console.log(`敌人图片未找到: ${assetName}, 类型: ${this.enemyType}`);\r\n    }\r\n    \r\n    if (enemyImage) {\r\n      // 使用图片渲染\r\n      renderer.drawImage(\r\n        enemyImage,\r\n        this.position.x,\r\n        this.position.y,\r\n        this.size.x,\r\n        this.size.y\r\n      );\r\n    } else {\r\n      // 降级到矩形渲染\r\n      renderer.drawRect(\r\n        this.position.x,\r\n        this.position.y,\r\n        this.size.x,\r\n        this.size.y,\r\n        PIXEL_PALETTE.ENEMY_PRIMARY\r\n      );\r\n\r\n      // 绘制飞船细节\r\n      const centerX = this.position.x + this.size.x / 2;\r\n      const bottomY = this.position.y + this.size.y;\r\n      \r\n      // 飞船底部（朝下的尖端）\r\n      renderer.drawRect(\r\n        centerX - 2,\r\n        bottomY,\r\n        4,\r\n        4,\r\n        PIXEL_PALETTE.ENEMY_SECONDARY\r\n      );\r\n\r\n      // 飞船侧翼\r\n      renderer.drawRect(\r\n        this.position.x - 2,\r\n        this.position.y + 4,\r\n        4,\r\n        8,\r\n        PIXEL_PALETTE.ENEMY_DARK\r\n      );\r\n      \r\n      renderer.drawRect(\r\n        this.position.x + this.size.x - 2,\r\n        this.position.y + 4,\r\n        4,\r\n        8,\r\n        PIXEL_PALETTE.ENEMY_DARK\r\n      );\r\n\r\n      // 飞船核心（发光效果）\r\n      renderer.drawRect(\r\n        centerX - 1,\r\n        this.position.y + this.size.y / 2 - 1,\r\n        2,\r\n        2,\r\n        PIXEL_PALETTE.ENEMY_SECONDARY\r\n      );\r\n    }\r\n\r\n    // 渲染血条（只有血量大于1的敌人才显示）\r\n    if (this.maxHealth > 1) {\r\n      this.renderHealthBar(renderer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 渲染血条\r\n   */\r\n  private renderHealthBar(renderer: Renderer): void {\r\n    const barWidth = this.size.x;\r\n    const barHeight = 4;\r\n    const barX = this.position.x;\r\n    const barY = this.position.y - 8;\r\n\r\n    // 血条背景\r\n    renderer.drawRect(barX, barY, barWidth, barHeight, '#333333');\r\n\r\n    // 血条\r\n    const healthRatio = this.health / this.maxHealth;\r\n    const healthWidth = barWidth * healthRatio;\r\n    \r\n    // 根据血量比例选择颜色\r\n    let healthColor = '#00FF00'; // 绿色\r\n    if (healthRatio < 0.3) {\r\n      healthColor = '#FF0000'; // 红色\r\n    } else if (healthRatio < 0.6) {\r\n      healthColor = '#FFFF00'; // 黄色\r\n    }\r\n\r\n    renderer.drawRect(barX, barY, healthWidth, barHeight, healthColor);\r\n\r\n    // 血条边框\r\n    renderer.drawRectOutline(barX, barY, barWidth, barHeight, '#FFFFFF', 1);\r\n  }\r\n\r\n  /**\r\n   * 受到伤害\r\n   */\r\n  takeDamage(damage: number): boolean {\r\n    this.health -= damage;\r\n    if (this.health <= 0) {\r\n      this.destroy();\r\n      return true; // 敌人被摧毁\r\n    }\r\n    return false; // 敌人还活着\r\n  }\r\n\r\n  /**\r\n   * 检查是否应该射击\r\n   */\r\n  shouldShoot(): boolean {\r\n    return this.active && this.shootTimer >= this.shootInterval;\r\n  }\r\n\r\n  /**\r\n   * 发射子弹\r\n   */\r\n  shoot(): Bullet | null {\r\n    if (!this.shouldShoot()) return null;\r\n\r\n    this.shootTimer = 0;\r\n\r\n    const typeConfig = Object.values(ENEMY_TYPES).find(t => t.id === this.enemyType) || ENEMY_TYPES.BASIC;\r\n    \r\n    // 根据敌人类型和射击模式确定子弹类型\r\n    let bulletType = BulletType.NORMAL;\r\n    if (typeConfig.bulletType === 'laser') {\r\n      bulletType = BulletType.LASER;\r\n    } else if (typeConfig.bulletType === 'all' && Math.random() < 0.2) {\r\n      // Boss有20%概率发射激光\r\n      bulletType = BulletType.LASER;\r\n    }\r\n    \r\n    const bulletConfig = bulletType === BulletType.LASER ? BULLET_TYPES.LASER : BULLET_TYPES.NORMAL;\r\n    \r\n    // 创建子弹数据\r\n    const bulletData = {\r\n      position: {\r\n        x: this.position.x + this.size.x / 2 - bulletConfig.size.x / 2,\r\n        y: this.position.y + this.size.y + 4,\r\n      },\r\n      velocity: this.getShootVelocity(),\r\n      size: { ...bulletConfig.size },\r\n      owner: 'enemy' as const,\r\n      damage: 1,\r\n      bulletType: bulletType,\r\n      active: true,\r\n      update: () => {},\r\n      render: () => {},\r\n    };\r\n\r\n    return bulletData;\r\n  }\r\n\r\n  /**\r\n   * 根据敌人类型获取射击速度向量\r\n   */\r\n  private getShootVelocity(): Vector2D {\r\n    const typeConfig = Object.values(ENEMY_TYPES).find(t => t.id === this.enemyType) || ENEMY_TYPES.BASIC;\r\n    const bulletConfig = typeConfig.bulletType === 'laser' ? BULLET_TYPES.LASER : BULLET_TYPES.NORMAL;\r\n    \r\n    switch (typeConfig.shootPattern) {\r\n      case 'diagonal':\r\n        // 斜射敌人：随机选择左斜或右斜\r\n        const angle = Math.random() < 0.5 ? -0.5 : 0.5; // 左斜或右斜\r\n        return createVector2D(bulletConfig.speed * angle, bulletConfig.speed);\r\n        \r\n      case 'mixed':\r\n        // 精英怪：随机选择直射或斜射\r\n        if (Math.random() < 0.5) {\r\n          // 直射\r\n          return createVector2D(0, bulletConfig.speed);\r\n        } else {\r\n          // 斜射\r\n          const diagonalAngle = Math.random() < 0.5 ? -0.5 : 0.5;\r\n          return createVector2D(bulletConfig.speed * diagonalAngle, bulletConfig.speed);\r\n        }\r\n        \r\n      case 'all':\r\n        // Boss：随机选择所有攻击模式\r\n        const pattern = Math.random();\r\n        if (pattern < 0.4) {\r\n          // 直射\r\n          return createVector2D(0, bulletConfig.speed);\r\n        } else if (pattern < 0.8) {\r\n          // 斜射\r\n          const bossAngle = Math.random() < 0.5 ? -0.6 : 0.6;\r\n          return createVector2D(bulletConfig.speed * bossAngle, bulletConfig.speed);\r\n        } else {\r\n          // 激光（Boss可以发射激光）\r\n          return createVector2D(0, BULLET_TYPES.LASER.speed);\r\n        }\r\n        \r\n      case 'straight':\r\n      default:\r\n        // 直射\r\n        return createVector2D(0, bulletConfig.speed);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检查边界并处理超出情况\r\n   */\r\n  private checkBounds(): void {\r\n    // 如果敌人到达屏幕底部，标记为非活跃（这将触发玩家失去生命）\r\n    if (this.position.y > this.canvasHeight) {\r\n      this.destroy();\r\n    }\r\n\r\n    // 水平边界检查（如果需要左右移动的敌人）\r\n    if (this.position.x + this.size.x < 0 || this.position.x > this.canvasWidth) {\r\n      this.destroy();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取中心位置\r\n   */\r\n  getCenterPosition(): Vector2D {\r\n    return {\r\n      x: this.position.x + this.size.x / 2,\r\n      y: this.position.y + this.size.y / 2,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 设置移动速度\r\n   */\r\n  setSpeed(speed: number): void {\r\n    this.speed = speed;\r\n    this.velocity.y = speed;\r\n  }\r\n\r\n  /**\r\n   * 设置射击间隔\r\n   */\r\n  setShootInterval(interval: number): void {\r\n    this.shootInterval = interval;\r\n  }\r\n\r\n  /**\r\n   * 检查是否在屏幕内\r\n   */\r\n  isInBounds(): boolean {\r\n    return (\r\n      this.position.x + this.size.x >= 0 &&\r\n      this.position.x <= this.canvasWidth &&\r\n      this.position.y + this.size.y >= 0 &&\r\n      this.position.y <= this.canvasHeight\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 检查是否到达屏幕底部\r\n   */\r\n  hasReachedBottom(): boolean {\r\n    return this.position.y >= this.canvasHeight;\r\n  }\r\n\r\n  /**\r\n   * 销毁敌人飞船\r\n   */\r\n  destroy(): void {\r\n    this.active = false;\r\n  }\r\n\r\n  /**\r\n   * 重置射击计时器\r\n   */\r\n  resetShootTimer(): void {\r\n    this.shootTimer = 0;\r\n  }\r\n\r\n  /**\r\n   * 获取边界框\r\n   */\r\n  getBounds(): { x: number; y: number; width: number; height: number } {\r\n    return {\r\n      x: this.position.x,\r\n      y: this.position.y,\r\n      width: this.size.x,\r\n      height: this.size.y,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * 敌人生成器\r\n */\r\nexport class EnemySpawner {\r\n  public canvasWidth: number;\r\n  public canvasHeight: number;\r\n  public baseSpeed: number;\r\n  private spawnRate: number;\r\n  private lastSpawnTime: number;\r\n\r\n  constructor(canvasWidth: number, canvasHeight: number) {\r\n    this.canvasWidth = canvasWidth;\r\n    this.canvasHeight = canvasHeight;\r\n    this.spawnRate = DEFAULT_GAME_CONFIG.enemy.spawnRate;\r\n    this.lastSpawnTime = 0;\r\n    this.baseSpeed = DEFAULT_GAME_CONFIG.enemy.baseSpeed;\r\n  }\r\n\r\n  /**\r\n   * 更新生成器\r\n   */\r\n  update(deltaTime: number, currentScore: number = 0, hasBoss: boolean = false): EnemyShipImpl | null {\r\n    this.lastSpawnTime += deltaTime;\r\n\r\n    if (this.lastSpawnTime >= this.spawnRate) {\r\n      this.lastSpawnTime = 0;\r\n      return this.spawnEnemy(currentScore, hasBoss);\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * 生成敌人\r\n   */\r\n  private spawnEnemy(currentScore: number = 0, hasBoss: boolean = false): EnemyShipImpl {\r\n    // 随机选择敌人类型（基于权重和分数，排除Boss）\r\n    const enemyType = this.getRandomEnemyType(currentScore, hasBoss);\r\n    const typeConfig = Object.values(ENEMY_TYPES).find(t => t.id === enemyType) || ENEMY_TYPES.BASIC;\r\n    \r\n    // 在屏幕顶部随机位置生成\r\n    const x = Math.random() * (this.canvasWidth - typeConfig.size.x);\r\n    const y = -typeConfig.size.y;\r\n\r\n    const position = createVector2D(x, y);\r\n    return new EnemyShipImpl(position, this.canvasWidth, this.canvasHeight, enemyType, this.baseSpeed);\r\n  }\r\n\r\n  /**\r\n   * 设置生成率\r\n   */\r\n  setSpawnRate(rate: number): void {\r\n    this.spawnRate = Math.max(100, rate); // 最小100ms间隔\r\n  }\r\n\r\n  /**\r\n   * 设置敌人速度\r\n   */\r\n  setEnemySpeed(speed: number): void {\r\n    this.baseSpeed = speed;\r\n  }\r\n\r\n  /**\r\n   * 强制生成敌人\r\n   */\r\n  forceSpawn(): EnemyShipImpl {\r\n    return this.spawnEnemy();\r\n  }\r\n\r\n  /**\r\n   * 重置生成计时器\r\n   */\r\n  reset(): void {\r\n    this.lastSpawnTime = 0;\r\n  }\r\n\r\n  /**\r\n   * 根据权重和分数要求随机选择敌人类型\r\n   */\r\n  private getRandomEnemyType(currentScore: number = 0, hasBoss: boolean = false): EnemyType {\r\n    // 过滤出符合分数要求的敌人类型，如果已有Boss则排除Boss\r\n    let availableTypes = Object.values(ENEMY_TYPES).filter(type => currentScore >= type.minScore);\r\n    \r\n    // 如果场上已有Boss，则不生成新的Boss\r\n    if (hasBoss) {\r\n      availableTypes = availableTypes.filter(type => type.id !== 'boss');\r\n    }\r\n    \r\n    if (availableTypes.length === 0) {\r\n      return EnemyType.BASIC;\r\n    }\r\n    \r\n    const totalWeight = availableTypes.reduce((sum, type) => sum + type.spawnWeight, 0);\r\n    let random = Math.random() * totalWeight;\r\n    \r\n    for (const type of availableTypes) {\r\n      random -= type.spawnWeight;\r\n      if (random <= 0) {\r\n        return type.id as EnemyType;\r\n      }\r\n    }\r\n    \r\n    return EnemyType.BASIC; // 默认返回基础类型\r\n  }\r\n}\r\n\r\n/**\r\n * 敌人管理器\r\n */\r\nexport class EnemyManager {\r\n  private enemies: EnemyShipImpl[] = [];\r\n  private spawner: EnemySpawner;\r\n  private maxEnemies: number;\r\n  private currentScore: number = 0;\r\n  private lastBossScore: number = 0; // 上次生成Boss时的分数\r\n\r\n  constructor(canvasWidth: number, canvasHeight: number, maxEnemies: number = 20) {\r\n    this.spawner = new EnemySpawner(canvasWidth, canvasHeight);\r\n    this.maxEnemies = maxEnemies;\r\n  }\r\n\r\n  /**\r\n   * 更新所有敌人\r\n   */\r\n  update(deltaTime: number): void {\r\n    // 更新现有敌人\r\n    for (const enemy of this.enemies) {\r\n      enemy.update(deltaTime);\r\n    }\r\n\r\n    // 移除非活跃的敌人\r\n    this.enemies = this.enemies.filter(enemy => enemy.active);\r\n\r\n    // 检查是否需要强制生成Boss\r\n    this.checkBossSpawn();\r\n\r\n    // 尝试生成新敌人\r\n    if (this.enemies.length < this.maxEnemies) {\r\n      const newEnemy = this.spawner.update(deltaTime, this.currentScore, this.hasBoss());\r\n      if (newEnemy) {\r\n        this.enemies.push(newEnemy);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 渲染所有敌人\r\n   */\r\n  render(renderer: Renderer): void {\r\n    for (const enemy of this.enemies) {\r\n      enemy.render(renderer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取所有活跃的敌人\r\n   */\r\n  getActiveEnemies(): EnemyShipImpl[] {\r\n    return this.enemies.filter(enemy => enemy.active);\r\n  }\r\n\r\n  /**\r\n   * 获取应该射击的敌人\r\n   */\r\n  getShootingEnemies(): EnemyShipImpl[] {\r\n    return this.enemies.filter(enemy => enemy.active && enemy.shouldShoot());\r\n  }\r\n\r\n  /**\r\n   * 获取到达底部的敌人\r\n   */\r\n  getEnemiesAtBottom(): EnemyShipImpl[] {\r\n    return this.enemies.filter(enemy => enemy.active && enemy.hasReachedBottom());\r\n  }\r\n\r\n  /**\r\n   * 移除敌人\r\n   */\r\n  removeEnemy(enemy: EnemyShipImpl): void {\r\n    enemy.destroy();\r\n  }\r\n\r\n  /**\r\n   * 清空所有敌人\r\n   */\r\n  clear(): void {\r\n    this.enemies = [];\r\n  }\r\n\r\n  /**\r\n   * 获取敌人数量\r\n   */\r\n  getCount(): number {\r\n    return this.enemies.length;\r\n  }\r\n\r\n  /**\r\n   * 获取活跃敌人数量\r\n   */\r\n  getActiveCount(): number {\r\n    return this.enemies.filter(enemy => enemy.active).length;\r\n  }\r\n\r\n  /**\r\n   * 设置难度参数\r\n   */\r\n  setDifficulty(spawnRate: number, enemySpeed: number): void {\r\n    this.spawner.setSpawnRate(spawnRate);\r\n    this.spawner.setEnemySpeed(enemySpeed);\r\n  }\r\n\r\n  /**\r\n   * 设置当前分数\r\n   */\r\n  setCurrentScore(score: number): void {\r\n    this.currentScore = score;\r\n  }\r\n\r\n  /**\r\n   * 获取敌人的分数值\r\n   */\r\n  getEnemyScoreValue(enemy: EnemyShipImpl): number {\r\n    const typeConfig = Object.values(ENEMY_TYPES).find(t => t.id === enemy.enemyType) || ENEMY_TYPES.BASIC;\r\n    return typeConfig.scoreValue;\r\n  }\r\n\r\n  /**\r\n   * 检查是否有Boss在场\r\n   */\r\n  hasBoss(): boolean {\r\n    return this.enemies.some(enemy => enemy.enemyType === EnemyType.BOSS && enemy.active);\r\n  }\r\n\r\n  /**\r\n   * 检查Boss生成条件\r\n   */\r\n  private checkBossSpawn(): void {\r\n    // 每5000分必定生成一个Boss，且场上没有Boss时\r\n    const bossThreshold = Math.floor(this.currentScore / 5000) * 5000;\r\n    \r\n    if (bossThreshold > this.lastBossScore && bossThreshold >= 5000 && !this.hasBoss()) {\r\n      this.spawnBoss();\r\n      this.lastBossScore = bossThreshold;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 强制生成Boss\r\n   */\r\n  private spawnBoss(): void {\r\n    const typeConfig = ENEMY_TYPES.BOSS;\r\n    const x = Math.random() * (this.spawner.canvasWidth - typeConfig.size.x);\r\n    const y = -typeConfig.size.y;\r\n    const position = createVector2D(x, y);\r\n    \r\n    const boss = new EnemyShipImpl(\r\n      position,\r\n      this.spawner.canvasWidth,\r\n      this.spawner.canvasHeight,\r\n      EnemyType.BOSS,\r\n      this.spawner.baseSpeed\r\n    );\r\n    \r\n    this.enemies.push(boss);\r\n    console.log('Boss已生成！');\r\n  }\r\n\r\n  /**\r\n   * 重置Boss生成状态\r\n   */\r\n  resetBossSpawn(): void {\r\n    this.lastBossScore = 0;\r\n  }\r\n}","import { PowerUp, PowerUpType, Renderer, Vector2D } from '@/types';\r\nimport { createVector2D } from '@/utils/math';\r\nimport { POWERUP_TYPES } from '@/utils/constants';\r\nimport { getAsset } from '@/systems/defaultAssets';\r\n\r\n/**\r\n * 道具实现\r\n */\r\nexport class PowerUpImpl implements PowerUp {\r\n  position: Vector2D;\r\n  velocity: Vector2D;\r\n  size: Vector2D;\r\n  active: boolean;\r\n  powerUpType: PowerUpType;\r\n  collected: boolean;\r\n\r\n  private canvasHeight: number;\r\n  private floatTimer: number = 0; // 用于浮动动画\r\n\r\n  constructor(\r\n    position: Vector2D,\r\n    powerUpType: PowerUpType,\r\n    _canvasWidth: number,\r\n    canvasHeight: number\r\n  ) {\r\n    this.position = { ...position };\r\n    this.powerUpType = powerUpType;\r\n    this.canvasHeight = canvasHeight;\r\n    this.collected = false;\r\n    this.active = true;\r\n\r\n    // 根据道具类型设置属性\r\n    const config = Object.values(POWERUP_TYPES).find(p => p.id === powerUpType) || POWERUP_TYPES.MISSILE;\r\n    this.size = { ...config.size };\r\n    \r\n    // 道具缓慢下降\r\n    this.velocity = createVector2D(0, 30);\r\n  }\r\n\r\n  /**\r\n   * 更新道具状态\r\n   */\r\n  update(deltaTime: number): void {\r\n    if (!this.active || this.collected) return;\r\n\r\n    // 更新位置\r\n    this.position.x += this.velocity.x * (deltaTime / 1000);\r\n    this.position.y += this.velocity.y * (deltaTime / 1000);\r\n\r\n    // 浮动动画\r\n    this.floatTimer += deltaTime;\r\n    const floatOffset = Math.sin(this.floatTimer / 500) * 2;\r\n    this.position.y += floatOffset * (deltaTime / 1000);\r\n\r\n    // 检查是否超出边界\r\n    if (this.position.y > this.canvasHeight + this.size.y) {\r\n      this.active = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 渲染道具\r\n   */\r\n  render(renderer: Renderer): void {\r\n    if (!this.active || this.collected) return;\r\n\r\n    const assetName = `powerup-${this.powerUpType}`;\r\n    const powerUpImage = getAsset(assetName);\r\n    \r\n    if (powerUpImage) {\r\n      // 使用图片渲染\r\n      renderer.drawImage(\r\n        powerUpImage,\r\n        this.position.x,\r\n        this.position.y,\r\n        this.size.x,\r\n        this.size.y\r\n      );\r\n    } else {\r\n      // 降级到矩形渲染\r\n      this.renderFallback(renderer);\r\n    }\r\n\r\n    // 添加发光效果\r\n    this.renderGlowEffect(renderer);\r\n  }\r\n\r\n  /**\r\n   * 降级渲染\r\n   */\r\n  private renderFallback(renderer: Renderer): void {\r\n    if (this.powerUpType === PowerUpType.MISSILE) {\r\n      // 导弹包 - 绿色\r\n      renderer.drawRect(\r\n        this.position.x,\r\n        this.position.y,\r\n        this.size.x,\r\n        this.size.y,\r\n        '#00FF00'\r\n      );\r\n      \r\n      // 导弹图标\r\n      renderer.drawRect(\r\n        this.position.x + 8,\r\n        this.position.y + 4,\r\n        16,\r\n        4,\r\n        '#FFFF00'\r\n      );\r\n      \r\n      renderer.drawRect(\r\n        this.position.x + 12,\r\n        this.position.y + 8,\r\n        8,\r\n        16,\r\n        '#FFFF00'\r\n      );\r\n      \r\n      // 边框\r\n      renderer.drawRectOutline(\r\n        this.position.x,\r\n        this.position.y,\r\n        this.size.x,\r\n        this.size.y,\r\n        '#FFFFFF',\r\n        2\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 渲染发光效果\r\n   */\r\n  private renderGlowEffect(renderer: Renderer): void {\r\n    const glowIntensity = (Math.sin(this.floatTimer / 200) + 1) / 2; // 0-1之间\r\n    const glowSize = 4 + glowIntensity * 2;\r\n    \r\n    renderer.setAlpha(0.3 * glowIntensity);\r\n    renderer.drawRect(\r\n      this.position.x - glowSize,\r\n      this.position.y - glowSize,\r\n      this.size.x + glowSize * 2,\r\n      this.size.y + glowSize * 2,\r\n      '#00FFFF'\r\n    );\r\n    renderer.setAlpha(1);\r\n  }\r\n\r\n  /**\r\n   * 收集道具\r\n   */\r\n  collect(): void {\r\n    this.collected = true;\r\n    this.active = false;\r\n  }\r\n\r\n  /**\r\n   * 检查是否与玩家碰撞\r\n   */\r\n  checkCollision(playerPosition: Vector2D, playerSize: Vector2D): boolean {\r\n    return (\r\n      this.position.x < playerPosition.x + playerSize.x &&\r\n      this.position.x + this.size.x > playerPosition.x &&\r\n      this.position.y < playerPosition.y + playerSize.y &&\r\n      this.position.y + this.size.y > playerPosition.y\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * 道具管理器\r\n */\r\nexport class PowerUpManager {\r\n  private powerUps: PowerUpImpl[] = [];\r\n  private canvasWidth: number;\r\n  private canvasHeight: number;\r\n  private spawnedMissilePackages: Set<number> = new Set(); // 追踪已生成导弹包的分数点\r\n\r\n  constructor(canvasWidth: number, canvasHeight: number) {\r\n    this.canvasWidth = canvasWidth;\r\n    this.canvasHeight = canvasHeight;\r\n  }\r\n\r\n  /**\r\n   * 更新所有道具\r\n   */\r\n  update(deltaTime: number, currentScore: number): void {\r\n    // 检查是否需要生成导弹包\r\n    this.checkMissilePackageSpawn(currentScore);\r\n\r\n    // 更新现有道具\r\n    for (const powerUp of this.powerUps) {\r\n      powerUp.update(deltaTime);\r\n    }\r\n\r\n    // 移除非活跃的道具\r\n    this.powerUps = this.powerUps.filter(powerUp => powerUp.active);\r\n  }\r\n\r\n  /**\r\n   * 检查导弹包生成条件\r\n   */\r\n  private checkMissilePackageSpawn(currentScore: number): void {\r\n    // 1000分必定生成一个\r\n    if (currentScore >= 1000 && !this.spawnedMissilePackages.has(1000)) {\r\n      this.spawnMissilePackage();\r\n      this.spawnedMissilePackages.add(1000);\r\n      return;\r\n    }\r\n\r\n    // 之后每5000*n-500分生成（即4500, 9500, 14500, 19500...）\r\n    for (let n = 1; n <= 20; n++) { // 限制检查范围避免无限循环\r\n      const spawnScore = 5000 * n - 500; // 4500, 9500, 14500...\r\n      if (currentScore >= spawnScore && !this.spawnedMissilePackages.has(spawnScore)) {\r\n        this.spawnMissilePackage();\r\n        this.spawnedMissilePackages.add(spawnScore);\r\n        console.log(`在${spawnScore}分生成导弹包！`);\r\n        break; // 一次只生成一个\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 渲染所有道具\r\n   */\r\n  render(renderer: Renderer): void {\r\n    for (const powerUp of this.powerUps) {\r\n      powerUp.render(renderer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 生成导弹包\r\n   */\r\n  private spawnMissilePackage(): void {\r\n    const x = this.canvasWidth / 2 - 16; // 屏幕中间\r\n    const y = this.canvasHeight / 2 - 16;\r\n    const position = createVector2D(x, y);\r\n    \r\n    const missilePackage = new PowerUpImpl(\r\n      position,\r\n      PowerUpType.MISSILE,\r\n      this.canvasWidth,\r\n      this.canvasHeight\r\n    );\r\n    \r\n    this.powerUps.push(missilePackage);\r\n  }\r\n\r\n  /**\r\n   * 检查道具收集\r\n   */\r\n  checkCollisions(playerPosition: Vector2D, playerSize: Vector2D): PowerUpImpl[] {\r\n    const collectedPowerUps: PowerUpImpl[] = [];\r\n    \r\n    for (const powerUp of this.powerUps) {\r\n      if (!powerUp.collected && powerUp.checkCollision(playerPosition, playerSize)) {\r\n        powerUp.collect();\r\n        collectedPowerUps.push(powerUp);\r\n      }\r\n    }\r\n    \r\n    return collectedPowerUps;\r\n  }\r\n\r\n  /**\r\n   * 获取所有活跃道具\r\n   */\r\n  getActivePowerUps(): PowerUpImpl[] {\r\n    return this.powerUps.filter(powerUp => powerUp.active);\r\n  }\r\n\r\n  /**\r\n   * 清空所有道具\r\n   */\r\n  clear(): void {\r\n    this.powerUps = [];\r\n    this.spawnedMissilePackages.clear();\r\n  }\r\n\r\n  /**\r\n   * 重置导弹包生成状态（用于新游戏）\r\n   */\r\n  resetMissilePackage(): void {\r\n    this.spawnedMissilePackages.clear();\r\n  }\r\n}","import { GameStateType, PowerUpType } from '@/types';\r\nimport { CanvasRenderer } from '@/systems/renderer';\r\nimport { InputManager } from '@/systems/inputManager';\r\nimport { CollisionSystem } from '@/systems/collisionSystem';\r\nimport { LifeSystem } from '@/systems/lifeSystem';\r\nimport { ScoreSystem } from '@/systems/scoreSystem';\r\nimport { DifficultySystem } from '@/systems/difficultySystem';\r\nimport { PlayerShipImpl } from '@/entities/playerShip';\r\nimport { BulletManager } from '@/entities/bullet';\r\nimport { EnemyManager } from '@/entities/enemyShip';\r\nimport { PowerUpManager } from '@/entities/powerUp';\r\nimport { COLORS } from '@/utils/constants';\r\nimport { loadGameAssets, getAsset } from '@/systems/defaultAssets';\r\n\r\n/**\r\n * 主游戏类\r\n */\r\nexport class Game {\r\n  private canvas: HTMLCanvasElement;\r\n  private renderer: CanvasRenderer;\r\n  private inputManager: InputManager;\r\n  private collisionSystem: CollisionSystem;\r\n  private lifeSystem: LifeSystem;\r\n  private scoreSystem: ScoreSystem;\r\n  private difficultySystem: DifficultySystem;\r\n  \r\n  private player: PlayerShipImpl;\r\n  private bulletManager: BulletManager;\r\n  private enemyManager: EnemyManager;\r\n  private powerUpManager: PowerUpManager;\r\n  \r\n  private gameState: GameStateType;\r\n  private isRunning: boolean;\r\n  private lastTime: number;\r\n  \r\n  private scoreElement: HTMLElement | null;\r\n  private livesElement: HTMLElement | null;\r\n  private assetsLoaded: boolean = false;\r\n  \r\n\r\n\r\n  constructor(canvasId: string) {\r\n    // 获取Canvas元素\r\n    this.canvas = document.getElementById(canvasId) as HTMLCanvasElement;\r\n    if (!this.canvas) {\r\n      throw new Error(`Canvas元素 '${canvasId}' 未找到`);\r\n    }\r\n\r\n    // 初始化系统\r\n    this.renderer = new CanvasRenderer(this.canvas);\r\n    this.inputManager = new InputManager();\r\n    this.collisionSystem = new CollisionSystem();\r\n    this.lifeSystem = new LifeSystem();\r\n    this.scoreSystem = new ScoreSystem();\r\n    this.difficultySystem = new DifficultySystem();\r\n\r\n    // 初始化游戏实体\r\n    this.player = new PlayerShipImpl(this.canvas.width, this.canvas.height);\r\n    this.bulletManager = new BulletManager(this.canvas.width, this.canvas.height);\r\n    this.enemyManager = new EnemyManager(this.canvas.width, this.canvas.height);\r\n    this.powerUpManager = new PowerUpManager(this.canvas.width, this.canvas.height);\r\n\r\n    // 初始化游戏状态\r\n    this.gameState = GameStateType.MENU;\r\n    this.isRunning = false;\r\n    this.lastTime = 0;\r\n\r\n    // 获取UI元素\r\n    this.scoreElement = document.getElementById('score');\r\n    this.livesElement = document.getElementById('lives');\r\n\r\n    // 绑定方法\r\n    this.gameLoop = this.gameLoop.bind(this);\r\n    this.menuLoop = this.menuLoop.bind(this);\r\n    \r\n    // 设置输入处理\r\n    this.setupInput();\r\n    \r\n    // 加载资源然后开始菜单循环\r\n    this.initializeAssets();\r\n  }\r\n\r\n  /**\r\n   * 设置输入处理\r\n   */\r\n  private setupInput(): void {\r\n    this.inputManager.onKeyDown('Enter', () => {\r\n      if (this.gameState === GameStateType.MENU || this.gameState === GameStateType.GAME_OVER) {\r\n        this.startGame();\r\n      }\r\n    });\r\n\r\n    this.inputManager.onKeyDown('Escape', () => {\r\n      if (this.gameState === GameStateType.PLAYING) {\r\n        this.pauseGame();\r\n      } else if (this.gameState === GameStateType.PAUSED) {\r\n        this.resumeGame();\r\n      }\r\n    });\r\n\r\n    // 添加Q键退出游戏功能\r\n    this.inputManager.onKeyDown('KeyQ', () => {\r\n      if (this.gameState === GameStateType.PLAYING || \r\n          this.gameState === GameStateType.PAUSED || \r\n          this.gameState === GameStateType.GAME_OVER) {\r\n        this.quitToMenu();\r\n      }\r\n    });\r\n\r\n    // 添加K键导弹发射功能\r\n    this.inputManager.onKeyDown('KeyK', () => {\r\n      if (this.gameState === GameStateType.PLAYING) {\r\n        this.handleMissileShoot();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 初始化资源\r\n   */\r\n  private async initializeAssets(): Promise<void> {\r\n    try {\r\n      await loadGameAssets();\r\n      this.assetsLoaded = true;\r\n      this.startMenuLoop();\r\n    } catch (error) {\r\n      console.error('资源加载失败:', error);\r\n      this.assetsLoaded = true; // 即使失败也继续，使用默认渲染\r\n      this.startMenuLoop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 开始菜单循环\r\n   */\r\n  startMenuLoop(): void {\r\n    this.inputManager.startListening();\r\n    requestAnimationFrame(this.menuLoop);\r\n  }\r\n\r\n  /**\r\n   * 菜单循环\r\n   */\r\n  private menuLoop(): void {\r\n    this.render();\r\n    \r\n    // 如果还在菜单状态或游戏结束状态，继续循环\r\n    if (this.gameState === GameStateType.MENU || this.gameState === GameStateType.GAME_OVER) {\r\n      requestAnimationFrame(this.menuLoop);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 开始游戏\r\n   */\r\n  startGame(): void {\r\n    this.gameState = GameStateType.PLAYING;\r\n    this.isRunning = true;\r\n    \r\n    // 重置游戏状态\r\n    this.lifeSystem.reset();\r\n    this.scoreSystem.reset();\r\n    this.difficultySystem.reset();\r\n    this.player.respawn();\r\n    this.bulletManager.clear();\r\n    this.enemyManager.clear();\r\n    this.powerUpManager.clear();\r\n    this.enemyManager.resetBossSpawn();\r\n    \r\n    // 开始游戏循环\r\n    this.lastTime = performance.now();\r\n    requestAnimationFrame(this.gameLoop);\r\n  }\r\n\r\n  /**\r\n   * 暂停游戏\r\n   */\r\n  pauseGame(): void {\r\n    this.gameState = GameStateType.PAUSED;\r\n  }\r\n\r\n  /**\r\n   * 恢复游戏\r\n   */\r\n  resumeGame(): void {\r\n    this.gameState = GameStateType.PLAYING;\r\n    this.lastTime = performance.now();\r\n  }\r\n\r\n  /**\r\n   * 结束游戏\r\n   */\r\n  endGame(): void {\r\n    this.gameState = GameStateType.GAME_OVER;\r\n  }\r\n\r\n  /**\r\n   * 退出到菜单\r\n   */\r\n  quitToMenu(): void {\r\n    this.gameState = GameStateType.MENU;\r\n    this.isRunning = false;\r\n    \r\n    // 重置游戏状态\r\n    this.lifeSystem.reset();\r\n    this.scoreSystem.reset();\r\n    this.difficultySystem.reset();\r\n    this.bulletManager.clear();\r\n    this.enemyManager.clear();\r\n    this.powerUpManager.clear();\r\n    this.enemyManager.resetBossSpawn();\r\n    \r\n    // 开始菜单循环\r\n    this.startMenuLoop();\r\n  }\r\n\r\n  /**\r\n   * 游戏主循环\r\n   */\r\n  private gameLoop(currentTime: number): void {\r\n    if (!this.isRunning) return;\r\n\r\n    const deltaTime = currentTime - this.lastTime;\r\n    this.lastTime = currentTime;\r\n\r\n    // 只在游戏进行时更新\r\n    if (this.gameState === GameStateType.PLAYING) {\r\n      this.update(deltaTime);\r\n    }\r\n\r\n    this.render();\r\n\r\n    // 继续循环\r\n    if (this.isRunning) {\r\n      requestAnimationFrame(this.gameLoop);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新游戏状态\r\n   */\r\n  private update(deltaTime: number): void {\r\n    // 更新难度系统\r\n    this.difficultySystem.update(deltaTime);\r\n    this.updateDifficulty();\r\n    \r\n    // 更新玩家\r\n    this.updatePlayer(deltaTime);\r\n    \r\n    // 更新子弹\r\n    this.bulletManager.update(deltaTime);\r\n    \r\n    // 更新敌人\r\n    this.enemyManager.setCurrentScore(this.scoreSystem.getScore());\r\n    this.enemyManager.update(deltaTime);\r\n    \r\n    // 更新道具\r\n    this.powerUpManager.update(deltaTime, this.scoreSystem.getScore());\r\n    \r\n    // 处理敌人射击\r\n    this.handleEnemyShooting();\r\n    \r\n    // 检测碰撞\r\n    this.handleCollisions();\r\n    \r\n    // 检测道具收集\r\n    this.handlePowerUpCollection();\r\n    \r\n    // 检查游戏结束条件\r\n    this.checkGameOver();\r\n    \r\n    // 更新UI\r\n    this.updateUI();\r\n  }\r\n\r\n  /**\r\n   * 根据难度系统更新游戏参数\r\n   */\r\n  private updateDifficulty(): void {\r\n    const difficulty = this.difficultySystem.getDifficultyInfo();\r\n    \r\n    // 更新敌人管理器的难度参数\r\n    this.enemyManager.setDifficulty(difficulty.spawnRate, difficulty.enemySpeed);\r\n    \r\n    // 更新玩家速度\r\n    this.player.speed = difficulty.playerSpeed;\r\n  }\r\n\r\n  /**\r\n   * 更新玩家\r\n   */\r\n  private updatePlayer(deltaTime: number): void {\r\n    const inputState = this.inputManager.getInputState();\r\n    const movementVector = this.inputManager.getMovementVector();\r\n    \r\n    // 更新玩家移动\r\n    this.player.updateMovement(movementVector, deltaTime);\r\n    this.player.update(deltaTime);\r\n    \r\n    // 处理射击\r\n    if (inputState.shoot && this.player.canShoot()) {\r\n      const bullet = this.player.shoot();\r\n      if (bullet) {\r\n        this.bulletManager.createPlayerBullet(bullet.position);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 处理敌人射击\r\n   */\r\n  private handleEnemyShooting(): void {\r\n    const shootingEnemies = this.enemyManager.getShootingEnemies();\r\n    \r\n    for (const enemy of shootingEnemies) {\r\n      const bullet = enemy.shoot();\r\n      if (bullet) {\r\n        this.bulletManager.createEnemyBullet(bullet.position, bullet.velocity, bullet.bulletType);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 处理碰撞\r\n   */\r\n  private handleCollisions(): void {\r\n    const activeEnemies = this.enemyManager.getActiveEnemies();\r\n    const activeBullets = this.bulletManager.getActiveBullets();\r\n    \r\n    const collisions = this.collisionSystem.checkAllCollisions(\r\n      this.player,\r\n      activeEnemies,\r\n      activeBullets\r\n    );\r\n\r\n    // 处理玩家-敌人碰撞\r\n    for (const enemy of collisions.playerEnemyCollisions) {\r\n      enemy.destroy();\r\n      this.lifeSystem.loseLife();\r\n      this.player.respawn();\r\n    }\r\n\r\n    // 处理子弹-敌人碰撞\r\n    for (const collision of collisions.bulletEnemyCollisions) {\r\n      collision.bullet.destroy();\r\n      \r\n      // 敌人受伤，如果被摧毁则加分\r\n      if (collision.enemy.takeDamage(1)) {\r\n        const scoreValue = this.enemyManager.getEnemyScoreValue(collision.enemy);\r\n        this.scoreSystem.addScore(scoreValue);\r\n      }\r\n    }\r\n\r\n    // 处理敌人子弹-玩家碰撞\r\n    for (const bullet of collisions.bulletPlayerCollisions) {\r\n      bullet.destroy();\r\n      this.lifeSystem.loseLife();\r\n      this.player.respawn();\r\n    }\r\n\r\n    // 检查敌人到达底部\r\n    const enemiesAtBottom = this.enemyManager.getEnemiesAtBottom();\r\n    for (const enemy of enemiesAtBottom) {\r\n      enemy.destroy();\r\n      this.lifeSystem.loseLife();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检查游戏结束\r\n   */\r\n  private checkGameOver(): void {\r\n    if (this.lifeSystem.isGameOver()) {\r\n      this.endGame();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 更新UI\r\n   */\r\n  private updateUI(): void {\r\n    if (this.scoreElement) {\r\n      this.scoreElement.textContent = this.scoreSystem.getScore().toString();\r\n    }\r\n    \r\n    if (this.livesElement) {\r\n      this.livesElement.textContent = this.lifeSystem.getLives().toString();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 渲染游戏UI覆盖层\r\n   */\r\n  private renderGameUI(): void {\r\n    // 显示导弹状态\r\n    if (this.player.hasMissileAbility()) {\r\n      const timeLeft = this.player.getMissileTimeLeft();\r\n      this.renderer.drawText(\r\n        `导弹: ${timeLeft}s`,\r\n        10,\r\n        this.canvas.height - 60,\r\n        COLORS.UI_ACCENT,\r\n        '16px Courier New'\r\n      );\r\n      \r\n      this.renderer.drawText(\r\n        'K - 发射导弹',\r\n        10,\r\n        this.canvas.height - 40,\r\n        COLORS.UI_TEXT,\r\n        '14px Courier New'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 渲染游戏\r\n   */\r\n  private render(): void {\r\n    // 清空画布\r\n    this.renderer.clear();\r\n\r\n    // 如果资源还没加载完成，显示加载界面\r\n    if (!this.assetsLoaded) {\r\n      this.renderLoading();\r\n      return;\r\n    }\r\n\r\n    switch (this.gameState) {\r\n      case GameStateType.MENU:\r\n        this.renderMenu();\r\n        break;\r\n      case GameStateType.PLAYING:\r\n        this.renderGame();\r\n        this.renderGameUI();\r\n        break;\r\n      case GameStateType.PAUSED:\r\n        this.renderGame();\r\n        this.renderGameUI();\r\n        this.renderPauseOverlay();\r\n        break;\r\n      case GameStateType.GAME_OVER:\r\n        this.renderGame();\r\n        this.renderGameOverOverlay();\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 渲染加载界面\r\n   */\r\n  private renderLoading(): void {\r\n    const centerX = this.canvas.width / 2;\r\n    const centerY = this.canvas.height / 2;\r\n\r\n    this.renderer.drawText(\r\n      '加载游戏资源中...',\r\n      centerX - 80,\r\n      centerY,\r\n      COLORS.UI_TEXT,\r\n      '18px Courier New'\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 渲染菜单\r\n   */\r\n  private renderMenu(): void {\r\n    const centerX = this.canvas.width / 2;\r\n    const centerY = this.canvas.height / 2;\r\n\r\n    // 游戏标题\r\n    this.renderer.drawText(\r\n      '像素射击游戏',\r\n      centerX - 80,\r\n      centerY - 100,\r\n      COLORS.UI_ACCENT,\r\n      '28px Courier New'\r\n    );\r\n\r\n    // 副标题\r\n    this.renderer.drawText(\r\n      'PIXEL SHOOTER',\r\n      centerX - 70,\r\n      centerY - 70,\r\n      COLORS.UI_TEXT,\r\n      '16px Courier New'\r\n    );\r\n\r\n    // Play按钮效果\r\n    this.renderer.drawRectOutline(\r\n      centerX - 100,\r\n      centerY - 20,\r\n      200,\r\n      40,\r\n      COLORS.UI_ACCENT,\r\n      2\r\n    );\r\n    \r\n    this.renderer.drawText(\r\n      'PLAY',\r\n      centerX - 20,\r\n      centerY - 5,\r\n      COLORS.UI_ACCENT,\r\n      '20px Courier New'\r\n    );\r\n\r\n    this.renderer.drawText(\r\n      '按 Enter 开始游戏',\r\n      centerX - 80,\r\n      centerY + 40,\r\n      COLORS.UI_TEXT,\r\n      '14px Courier New'\r\n    );\r\n\r\n    // 控制说明\r\n    this.renderer.drawText(\r\n      '游戏控制:',\r\n      centerX - 50,\r\n      centerY + 80,\r\n      COLORS.UI_TEXT,\r\n      '16px Courier New'\r\n    );\r\n\r\n    this.renderer.drawText(\r\n      'WSAD - 移动飞船',\r\n      centerX - 70,\r\n      centerY + 105,\r\n      COLORS.UI_TEXT,\r\n      '14px Courier New'\r\n    );\r\n\r\n    this.renderer.drawText(\r\n      'J - 射击',\r\n      centerX - 30,\r\n      centerY + 125,\r\n      COLORS.UI_TEXT,\r\n      '14px Courier New'\r\n    );\r\n\r\n    this.renderer.drawText(\r\n      'Esc - 暂停游戏',\r\n      centerX - 50,\r\n      centerY + 145,\r\n      COLORS.UI_TEXT,\r\n      '14px Courier New'\r\n    );\r\n\r\n    this.renderer.drawText(\r\n      'K - 导弹发射 (需道具)',\r\n      centerX - 80,\r\n      centerY + 165,\r\n      COLORS.UI_TEXT,\r\n      '14px Courier New'\r\n    );\r\n\r\n    this.renderer.drawText(\r\n      'Q - 退出到菜单',\r\n      centerX - 60,\r\n      centerY + 185,\r\n      COLORS.UI_TEXT,\r\n      '14px Courier New'\r\n    );\r\n\r\n    // 最高分显示\r\n    if (this.scoreSystem.getHighScore() > 0) {\r\n      this.renderer.drawText(\r\n        `最高分: ${this.scoreSystem.getHighScore()}`,\r\n        centerX - 60,\r\n        centerY + 200,\r\n        COLORS.UI_ACCENT,\r\n        '16px Courier New'\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 渲染游戏\r\n   */\r\n  private renderGame(): void {\r\n    // 渲染背景\r\n    this.renderBackground();\r\n    \r\n    // 渲染玩家\r\n    this.player.render(this.renderer);\r\n    \r\n    // 渲染子弹\r\n    this.bulletManager.render(this.renderer);\r\n    \r\n    // 渲染敌人\r\n    this.enemyManager.render(this.renderer);\r\n    \r\n    // 渲染道具\r\n    this.powerUpManager.render(this.renderer);\r\n  }\r\n\r\n  /**\r\n   * 渲染背景\r\n   */\r\n  private renderBackground(): void {\r\n    const backgroundImage = getAsset('background');\r\n    \r\n    if (backgroundImage) {\r\n      this.renderer.drawBackground(backgroundImage, 'stretch');\r\n    }\r\n    // 如果没有背景图片，使用默认的清空画布（已经在render()中调用了clear()）\r\n  }\r\n\r\n  /**\r\n   * 渲染暂停覆盖层\r\n   */\r\n  private renderPauseOverlay(): void {\r\n    const centerX = this.canvas.width / 2;\r\n    const centerY = this.canvas.height / 2;\r\n\r\n    // 半透明背景\r\n    this.renderer.setAlpha(0.8);\r\n    this.renderer.drawRect(0, 0, this.canvas.width, this.canvas.height, '#000000');\r\n    this.renderer.setAlpha(1);\r\n\r\n    // 暂停框\r\n    this.renderer.drawRectOutline(\r\n      centerX - 120,\r\n      centerY - 60,\r\n      240,\r\n      120,\r\n      COLORS.UI_ACCENT,\r\n      2\r\n    );\r\n\r\n    this.renderer.drawText(\r\n      '游戏暂停',\r\n      centerX - 40,\r\n      centerY - 30,\r\n      COLORS.UI_TEXT,\r\n      '20px Courier New'\r\n    );\r\n\r\n    this.renderer.drawText(\r\n      'Esc - 继续游戏',\r\n      centerX - 60,\r\n      centerY + 5,\r\n      COLORS.UI_ACCENT,\r\n      '16px Courier New'\r\n    );\r\n\r\n    this.renderer.drawText(\r\n      'Q - 退出到菜单',\r\n      centerX - 70,\r\n      centerY + 30,\r\n      COLORS.UI_TEXT,\r\n      '16px Courier New'\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 渲染游戏结束覆盖层\r\n   */\r\n  private renderGameOverOverlay(): void {\r\n    const centerX = this.canvas.width / 2;\r\n    const centerY = this.canvas.height / 2;\r\n\r\n    // 半透明背景\r\n    this.renderer.setAlpha(0.9);\r\n    this.renderer.drawRect(0, 0, this.canvas.width, this.canvas.height, '#000000');\r\n    this.renderer.setAlpha(1);\r\n\r\n    // 游戏结束框\r\n    this.renderer.drawRectOutline(\r\n      centerX - 150,\r\n      centerY - 80,\r\n      300,\r\n      160,\r\n      COLORS.UI_ACCENT,\r\n      3\r\n    );\r\n\r\n    this.renderer.drawText(\r\n      'GAME OVER',\r\n      centerX - 60,\r\n      centerY - 60,\r\n      COLORS.UI_ACCENT,\r\n      '24px Courier New'\r\n    );\r\n\r\n    this.renderer.drawText(\r\n      `最终得分: ${this.scoreSystem.getScore()}`,\r\n      centerX - 80,\r\n      centerY - 20,\r\n      COLORS.UI_TEXT,\r\n      '18px Courier New'\r\n    );\r\n\r\n    // 检查是否创造新纪录\r\n    if (this.scoreSystem.getScore() === this.scoreSystem.getHighScore() && this.scoreSystem.getScore() > 0) {\r\n      this.renderer.drawText(\r\n        '🎉 新纪录! 🎉',\r\n        centerX - 60,\r\n        centerY + 5,\r\n        COLORS.UI_ACCENT,\r\n        '16px Courier New'\r\n      );\r\n    } else {\r\n      this.renderer.drawText(\r\n        `最高得分: ${this.scoreSystem.getHighScore()}`,\r\n        centerX - 80,\r\n        centerY + 5,\r\n        COLORS.UI_TEXT,\r\n        '16px Courier New'\r\n      );\r\n    }\r\n\r\n    this.renderer.drawText(\r\n      'Enter - 重新开始',\r\n      centerX - 80,\r\n      centerY + 40,\r\n      COLORS.UI_ACCENT,\r\n      '16px Courier New'\r\n    );\r\n\r\n    this.renderer.drawText(\r\n      'Q - 返回菜单',\r\n      centerX - 60,\r\n      centerY + 60,\r\n      COLORS.UI_TEXT,\r\n      '16px Courier New'\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 处理导弹发射\r\n   */\r\n  private handleMissileShoot(): void {\r\n    const missiles = this.player.shootMissile();\r\n    if (missiles) {\r\n      for (const missile of missiles) {\r\n        this.bulletManager.createPlayerMissile(missile.position, missile.velocity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 处理道具收集\r\n   */\r\n  private handlePowerUpCollection(): void {\r\n    const collectedPowerUps = this.powerUpManager.checkCollisions(\r\n      this.player.position,\r\n      this.player.size\r\n    );\r\n\r\n    for (const powerUp of collectedPowerUps) {\r\n      if (powerUp.powerUpType === PowerUpType.MISSILE) {\r\n        this.player.gainMissiles();\r\n        console.log('获得导弹能力！');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 销毁游戏\r\n   */\r\n  destroy(): void {\r\n    this.isRunning = false;\r\n    this.inputManager.destroy();\r\n  }\r\n}","// 游戏主入口文件\r\nimport { Game } from './game';\r\n\r\nconsole.log('像素射击游戏初始化中...');\r\n\r\n// 创建游戏实例\r\nlet game: Game;\r\n\r\ntry {\r\n  game = new Game('gameCanvas');\r\n  console.log('游戏初始化完成! 正在加载资源...');\r\n  console.log('');\r\n  console.log('🎮 控制说明:');\r\n  console.log('- Enter: 开始游戏');\r\n  console.log('- WSAD: 移动飞船');\r\n  console.log('- 空格: 射击');\r\n  console.log('- Esc: 暂停/继续');\r\n  console.log('- Q: 退出到菜单');\r\n  console.log('');\r\n  console.log('🎨 自定义图片:');\r\n  console.log('将图片放在 public/assets/ 文件夹中:');\r\n  console.log('- player.png (玩家飞船)');\r\n  console.log('- enemy.png (敌人飞船)');\r\n  console.log('- player-bullet.png (玩家子弹)');\r\n  console.log('- enemy-bullet.png (敌人子弹)');\r\n  console.log('- background.png (游戏背景)');\r\n  console.log('如果没有图片，会使用默认的像素艺术风格。');\r\n} catch (error) {\r\n  console.error('游戏初始化失败:', error);\r\n  \r\n  // 显示错误信息\r\n  const canvas = document.getElementById('gameCanvas') as HTMLCanvasElement;\r\n  if (canvas) {\r\n    const ctx = canvas.getContext('2d');\r\n    if (ctx) {\r\n      ctx.fillStyle = '#ff0000';\r\n      ctx.font = '16px Courier New';\r\n      ctx.fillText('游戏初始化失败!', 50, 50);\r\n      ctx.fillText('请检查控制台错误信息', 50, 80);\r\n    }\r\n  }\r\n}\r\n\r\n// 处理页面卸载\r\nwindow.addEventListener('beforeunload', () => {\r\n  if (game) {\r\n    game.destroy();\r\n  }\r\n});"],"names":["EnemyType","BulletType","GameStateType","PowerUpType","DEFAULT_GAME_CONFIG","COLORS","KEYS","SCORING","ENEMY_TYPES","BULLET_TYPES","POWERUP_TYPES","MISSILE_CONFIG","CanvasRenderer","canvas","__publicField","ctx","x","y","width","height","color","text","font","enabled","lineWidth","radius","x1","y1","x2","y2","alpha","image","drawX","drawY","sourceX","sourceY","sourceWidth","sourceHeight","destX","destY","destWidth","destHeight","drawDestX","drawDestY","drawDestWidth","drawDestHeight","rotation","centerX","centerY","mode","pattern","InputManager","event","handler","keyCode","direction","checkAABBCollision","pos1","size1","pos2","size2","checkEntityCollision","entity1","entity2","clampEntityToBounds","entity","boundsWidth","boundsHeight","CollisionSystem","player","enemies","collisions","enemy","bullets","playerBullets","b","bullet","enemyBullets","LifeSystem","ScoreSystem","points","saved","DifficultySystem","deltaTime","newLevel","levelMultiplier","speedMultiplier","createVector2D","clamp","value","min","max","PIXEL_PALETTE","AssetManager","name","src","loadPromise","resolve","reject","img","imageMap","loadPromises","drawFunction","assetManager","DefaultAssets","gradient","i","size","ASSET_PATHS","loadGameAssets","path","error","getAsset","customAsset","defaultAsset","PlayerShipImpl","canvasWidth","canvasHeight","config","renderer","playerImage","topY","vx","vy","movementVector","_deltaTime","normalizedSpeed","currentTime","missiles","angle","speedComponent","speedX","speedY","leftMissile","rightMissile","timeLeft","BulletImpl","position","velocity","owner","damage","bulletType","bulletImageName","bulletImage","BulletFactory","BulletManager","maxBullets","EnemyShipImpl","enemyType","speed","typeConfig","t","horizontal","movePattern","assetName","enemyImage","bottomY","barWidth","barHeight","barX","barY","healthRatio","healthWidth","healthColor","bulletConfig","diagonalAngle","bossAngle","interval","EnemySpawner","currentScore","hasBoss","rate","availableTypes","type","totalWeight","sum","random","EnemyManager","maxEnemies","newEnemy","spawnRate","enemySpeed","score","bossThreshold","boss","PowerUpImpl","powerUpType","_canvasWidth","p","floatOffset","powerUpImage","glowIntensity","glowSize","playerPosition","playerSize","PowerUpManager","powerUp","n","spawnScore","missilePackage","collectedPowerUps","Game","canvasId","difficulty","inputState","shootingEnemies","activeEnemies","activeBullets","collision","scoreValue","enemiesAtBottom","backgroundImage","missile","game"],"mappings":"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"}